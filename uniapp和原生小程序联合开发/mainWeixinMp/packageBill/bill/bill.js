(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageBill/bill/bill"],{"18c5":function(t,e,i){"use strict";i.r(e);var l=i("3d31"),n=i.n(l);for(var o in l)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return l[t]}))}(o);e["default"]=n.a},"3d31":function(t,e,i){"use strict";(function(t,l){var n=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i("2eee")),s=n(i("c973")),a=n(i("7504")),r={components:{sudaBillTop:function(){i.e("components/suda-bill-top/suda-bill-top").then(function(){return resolve(i("a8d0"))}.bind(null,i)).catch(i.oe)},pageEmpty:function(){i.e("components/page-empty/page-empty").then(function(){return resolve(i("1068"))}.bind(null,i)).catch(i.oe)},uniIcons:function(){Promise.all([i.e("common/vendor"),i.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(i("1533"))}.bind(null,i)).catch(i.oe)},sudaLoading:function(){i.e("components/suda-loading/suda-loading").then(function(){return resolve(i("09dd"))}.bind(null,i)).catch(i.oe)},sudaToast:function(){i.e("components/suda-toast/suda-toast").then(function(){return resolve(i("f067"))}.bind(null,i)).catch(i.oe)},customFooter:function(){i.e("components/custom-footer/custom-footer").then(function(){return resolve(i("7d39"))}.bind(null,i)).catch(i.oe)}},data:function(){return{resource:{},bill:{},billArr:[],total:0,listBillIds:[],totalAmount:0,totalActualAmount:0,totalPaidAmount:0,totalLateFee:0,totalSubLateFee:0,totalDiscount:0,totalExempt:0,totalTaxInBillAmount:0,isCheckAll:!0,detailAnimateShow:!1,detailViewShow:!1,detailEnable:!0,isLoading:!1,isTenant:!1,noticeTitle:"还没选择房间或者车位还没选择房间或者车位还没选择房间或者车位还没选择房间或者车位",footerData:null,isContactBill:!1,contractId:"",user:{},userResourceId:null,isFromApp:!1,roomId:null,string:"heheda"}},computed:{displayError:function(){return this.resource?this.bill?void 0:"暂无数据":"还没选择房间或者车位"},isLogin:function(){return!!this.user}},onLoad:function(e){"true"==e.isContactBill?this.isContactBill=!0:this.isContactBill=!1,this.contractId=e.contractId;var i=e.q;if(console.log(i),i){var l=decodeURIComponent(i);"true"==this.getQueryParam(l,"isFromApp")?this.isFromApp=!0:this.isFromApp=!1,this.userResourceId=this.getQueryParam(l,"userResourceId"),this.roomId=this.getQueryParam(l,"roomId")}else"true"==e.isFromApp?this.isFromApp=!0:this.isFromApp=!1,this.userResourceId=e.userResourceId,this.roomId=e.roomId;this.string=JSON.stringify(e),t.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onShow:function(){this.user=l.getStorageSync(this.$config.storageKeys.user),this.bill=null,this.billArr=[],this.isCheckAll=!0,this.billList(),this.getContractBills(),this.getFooterData()},onShareAppMessage:function(t){if("menu"===t.from)return{title:"".concat(this.$config.appName),path:"/pages/index/index",imageUrl:""}},onShareTimeline:function(){return{title:"".concat(this.$config.appName),path:"/pages/index/index",imageUrl:""}},methods:{getQueryParam:function(t,e){if(!e)return!1;var i="",l=t.substring(t.indexOf("?")+1);return l&&l.split("&").forEach((function(t){var l=t.split("=");l[0]==e&&(i=l[1])})),i},exportBill:function(){var e=this;l.showLoading({title:"加载中"});var i=[{ReportType:"合同催费通知单",RegionId:this.bill.regionId,Parameters:{regionId:this.bill.regionId,contractId:this.contractId}}];console.log(i);var n=encodeURIComponent(JSON.stringify(i)),o=l.getStorageSync(a.default.storageKeys.token),s=a.default.apiBaseUrl;l.request({url:"".concat(s,"/wy/api/v1.0/report/export/fee-notice?options=").concat(n),responseType:"arraybuffer",header:{Authorization:o.token_type+" "+o.access_token,"Content-Type":"application/json",responseType:"blob"},success:function(i){if(console.log(i),200===i.statusCode){var n=l.getFileSystemManager(),o=e.bill.name.replace(/[\/\\\|]/g,""),s=t.env.USER_DATA_PATH+"/"+o+".pdf";console.log(s),n.writeFile({filePath:s,data:i.data,encoding:"binary",success:function(t){l.openDocument({showMenu:!0,filePath:s,success:function(t){console.log("打开文档成功")}})}})}},fail:function(t){console.log(t),l.showToast({title:"导出失败，请重试",icon:"none"})},complete:function(t){l.hideLoading()}})},displayDetail:function(){var t=this;this.detailEnable&&(this.detailEnable=!1,this.detailAnimateShow=!this.detailAnimateShow,this.detailViewShow?setTimeout((function(){t.detailViewShow=!t.detailViewShow,t.detailEnable=!0}),300):(setTimeout((function(){t.detailEnable=!0}),300),this.detailViewShow=!this.detailViewShow))},getDisplayDate:function(t){return this.$tool.date.format(t,"MM.dd")},getMoney:function(t){return this.$tool.money.format(t)},formatData:function(t){return t||0==t?t.toFixed(2):"0.00"},checkAll:function(){if(1!==this.bill.selfPaymentMode){this.isCheckAll=!this.isCheckAll;for(var t=0;t<this.billArr.length;t++){var e=this.billArr[t];e.isCheck=e.isPayable&&this.isCheckAll;for(var i=0;i<e.monthItem.length;i++){var l=e.monthItem[i];if(l.isCheck=l.isPayable&&this.isCheckAll,2===this.bill.selfPaymentMode)for(var n=0;n<l.billDetail.length;n++){var o=l.billDetail[n];o.isCheck=o.isPayable&&this.isCheckAll}}}this.getPayTotalMoney()}},toPayMoney:function(){var t=this;if(t.total>0){var e={PaymentMoney:this.total.toFixed(2),PaidType:6,ListBillIds:this.listBillIds},i=JSON.stringify(e);t.$http.request("/api/v2.0/wechat/sub-accounts/billConfirm",i,{headers:{"Content-Type":"application/json"},method:"POST"}).then((function(e){l.navigateTo({url:"./bill-comfirm?listBillIds="+t.listBillIds+"&total="+t.total.toFixed(2)+"&itemType="+t.bill.itemType+"&isContactBill="+t.isContactBill})})).catch((function(t){console.log(t),l.showToast({icon:"none",title:t.message,duration:2500})}))}else l.showToast({icon:"none",title:"请勾选要支付的月份",duration:2e3})},getPayTotalMoney:function(){for(var t=0,e=[],i=0,l=0,n=0,o=0,s=0,a=0,r=0,u=0;u<this.billArr.length;u++)for(var c=this.billArr[u],h=0;h<c.monthItem.length;h++){var m=c.monthItem[h];if(2!==this.bill.selfPaymentMode){if(m.isCheck&&m.isPayable){t+=m.needPayMon,i+=m.amount,l+=m.actualAmount,n+=m.paidAmount,o+=m.lateFee,s+=m.subLateFee,a+=m.discount,r+=m.exempt,m.taxInBillAmount;for(var d=0;d<m.billDetail.length;d++){var f=m.billDetail[d];""!=f.billIds&&e.push(f.billIds)}}}else for(var b=0;b<m.billDetail.length;b++){var g=m.billDetail[b];g.isCheck&&g.isPayable&&(""!=g.billIds&&e.push(g.billIds),t+=g.needPayMon,i+=g.amount,l+=g.actualAmount,n+=g.paidAmount,o+=g.lateFee,s+=g.subLateFee,a+=g.discount,r+=g.exempt,g.taxInBillAmount)}}this.totalAmount=i,this.totalActualAmount=l,this.totalPaidAmount=n,this.totalLateFee=o,this.totalSubLateFee=s,this.totalDiscount=a,this.totalExempt=r,this.listBillIds=e,this.total=t},choseMonth:function(t,e){if(1!==this.bill.selfPaymentMode){if(0===this.bill.selfPaymentMode)if(this.billArr[t].monthItem[e].isCheck){for(var i=0;i<=t;i++)if(t==i)for(var l=0;l<=e;l++)this.billArr[i].monthItem[l].isCheck=!1;else for(var n=0;n<this.billArr[i].monthItem.length;n++)this.billArr[i].monthItem[n].isCheck=!1;this.billArr[t].monthItem[e].isPayable&&(this.isCheckAll=!1)}else{0==e&&0==t&&(this.isCheckAll=!0);for(var o=t;o<this.billArr.length;o++)if(o==t)for(var s=e;s<this.billArr[o].monthItem.length;s++)this.billArr[o].monthItem[s].isCheck=this.billArr[o].monthItem[s].isPayable&&!0;else for(var a=0;a<this.billArr[o].monthItem.length;a++)this.billArr[o].monthItem[a].isCheck=this.billArr[o].monthItem[a].isPayable&&!0}else if(this.billArr[t].monthItem[e].isCheck){this.billArr[t].monthItem[e].isCheck=!1;for(var r=0;r<this.billArr[t].monthItem[e].billDetail.length;r++)this.billArr[t].monthItem[e].billDetail[r].isCheck=!1;this.billArr[t].monthItem.every((function(t){return!t.isCheck}))?this.billArr[t].isCheck=!1:this.billArr[t].isCheck=this.billArr[t].isPayable&&!0,this.isCheckAll=!1}else{this.billArr[t].monthItem[e].isCheck=this.billArr[t].monthItem[e].isPayable&&!0;for(var u=0;u<this.billArr[t].monthItem[e].billDetail.length;u++)this.billArr[t].monthItem[e].billDetail[u].isCheck=this.billArr[t].monthItem[e].billDetail[u].isPayable&&!0;this.billArr[t].monthItem.every((function(t){return t.isCheck&&t.isPayable||!t.isPayable}))?this.billArr[t].isCheck=this.billArr[t].isPayable&&!0:this.billArr[t].isCheck=!1;for(var c=!0,h=0;h<this.billArr.length;h++){var m=this.billArr[h];if(!m.isCheck&&m.isPayable){c=!1;break}for(var d=0;d<m.monthItem.length;d++){var f=m.monthItem[d];if(!f.isCheck&&f.isPayable){c=!1;break}for(var b=0;b<f.billDetail.length;b++){var g=f.billDetail[b];if(!g.isCheck&&g.isPayable){c=!1;break}}}}this.isCheckAll=c}this.getPayTotalMoney()}},choseDetailBill:function(t,e,i){if(this.billArr[t].monthItem[e].billDetail[i].isCheck)this.billArr[t].monthItem[e].billDetail[i].isCheck=!1,this.billArr[t].monthItem[e].billDetail.filter((function(t){return t.isPayable})).some((function(t){return!t.isCheck}))&&(this.billArr[t].monthItem[e].isCheck=!1),this.billArr[t].monthItem.filter((function(t){return t.isPayable})).some((function(t){return!t.isCheck}))&&(this.billArr[t].isCheck=!1),this.billArr[t].monthItem[e].billDetail[i].isPayable&&(this.isCheckAll=!1);else{this.billArr[t].monthItem[e].billDetail[i].isCheck=this.billArr[t].monthItem[e].billDetail[i].isPayable&&!0,this.billArr[t].monthItem[e].billDetail.every((function(t){return t.isCheck&&t.isPayable||!t.isPayable}))&&(this.billArr[t].monthItem[e].isCheck=this.billArr[t].monthItem[e].isPayable&&!0),this.billArr[t].monthItem.every((function(t){return t.isCheck&&t.isPayable||!t.isPayable}))&&(this.billArr[t].isCheck=this.billArr[t].isPayable&&!0);for(var l=!0,n=0;n<this.billArr.length;n++){var o=this.billArr[n];if(!o.isCheck&&o.isPayable){l=!1;break}for(var s=0;s<o.monthItem.length;s++){var a=o.monthItem[s];if(!a.isCheck&&a.isPayable){l=!1;break}for(var r=0;r<a.billDetail.length;r++){var u=a.billDetail[r];if(!u.isCheck&&u.isPayable){l=!1;break}}}}this.isCheckAll=l}this.getPayTotalMoney()},rowDisplay:function(t){t.isShow=!t.isShow},init:function(){},billList:function(){this.isContactBill||(this.resource=l.getStorageSync(this.$config.storageKeys.resource),this.isFromApp?this.checkHasResouce()&&(this.userResourceId?(console.log("this.userResourceId",this.userResourceId),this.getBills(this.userResourceId)):this.getRooms()):this.resource&&(console.log("this.resource.userResourceId",this.resource.userResourceId),this.getBills(this.resource.userResourceId)))},getRooms:function(){var t=this;this.isLoading=!0,t.$http.get("/api/v2.0/weChat/user-resources/me").then((function(e){if(e){var i=e.filter((function(t){return 5==t.itemType}));if(null!=i&&i.length>0){var l=t.getRoomId(i);console.log("房间绑定id",l),null!=l?t.getBills(l):t.getBills(i[0].id)}}t.isLoading=!1})).catch((function(e){t.isLoading=!1}))},getRoomId:function(t){console.log(this.roomId);for(var e=0;e<t.length;e++)if(this.roomId==t[e].resourceId)return t[e].id;return null},getBills:function(t){var e=this,i=this;this.isLoading=!0,i.isTenant=i.resource.isTenant,i.$http.get("/api/v2.0/weChat/bills",{userResourceId:t}).then((function(t){for(var l=[],n=0;n<t.monthBill.length;n++){var o=t.monthBill[n],s=e.getItemInArr(o.year,l);o["isCheck"]=e.isCheckAll&&o.isPayable,o["isShow"]=!0;var a=o.actualAmount-o.paidAmount;if(o["needPayMon"]=a,2===t.selfPaymentMode)for(var r=0;r<o.billDetail.length;r++){var u=o.billDetail[r];u["isCheck"]=e.isCheckAll&&u.isPayable;var c=u.actualAmount-u.paidAmount;u["needPayMon"]=c}if(null!=s)s.monthItem.push(o);else{var h={year:o.year,isCheck:o.isPayable&&e.isCheckAll,monthItem:[],isPayable:o.isPayable};h.monthItem.push(o),l.push(h)}}i.bill=t,i.billArr=l,i.getPayTotalMoney(),i.isLoading=!1})).catch((function(t){console.log(t),e.$refs.sudaToast.show(t.message),i.isLoading=!1}))},getContractBills:function(){var t=this;if(this.isContactBill&&this.contractId){var e=this;e.isLoading=!0,e.$http.get("/api/v2.0/weChat/bills/contract-bills?contractId=".concat(this.contractId)).then((function(i){console.log(i);for(var l=[],n=0;n<i.monthBill.length;n++){var o=i.monthBill[n],s=t.getItemInArr(o.year,l);o["isCheck"]=t.isCheckAll&&o.isPayable,o["isShow"]=!0;var a=o.actualAmount-o.paidAmount;if(o["needPayMon"]=a,2===i.selfPaymentMode)for(var r=0;r<o.billDetail.length;r++){var u=o.billDetail[r];u["isCheck"]=t.isCheckAll&&u.isPayable;var c=u.actualAmount-u.paidAmount;u["needPayMon"]=c}if(null!=s)s.monthItem.push(o);else{var h={year:o.year,isCheck:t.isCheckAll&&o.isPayable,monthItem:[],isPayable:o.isPayable};h.monthItem.push(o),l.push(h)}}e.bill=i,console.log(e.bill),e.billArr=l,e.getPayTotalMoney(),e.isLoading=!1})).catch((function(i){console.log(i),t.$refs.sudaToast.show(i.message),e.isLoading=!1}))}},getItemInArr:function(t,e){for(var i=0;i<e.length;i++)if(e[i].year==t)return e[i];return null},turnToPage:function(t){l.navigateTo({url:"history-bill"===t?"../../pages/me/history-bill/history-bill?hideTop=true&isContactBill=".concat(this.isContactBill,"&contractId=").concat(this.bill.id):"../../pages/me/recharge/recharge?resourceId=".concat(this.resource.resourceId,"&isContactBill=").concat(this.isContactBill)})},getFooterData:function(){var t=this;return(0,s.default)(o.default.mark((function e(){var i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$footerConfig.get();case 2:i=e.sent,t.footerData=i;case 4:case"end":return e.stop()}}),e)})))()},checkHasResouce:function(){if(this.checkBindTelephone()){if(this.user.defaultResourceId)return!0;l.showModal({title:"还没有添加任何房间车位",confirmText:"去添加",success:function(t){t.confirm&&l.navigateTo({url:"/pages/me/room/room"})}})}return!1},checkBindTelephone:function(){if(this.checkIsLogin()){if(this.user.phoneNumber)return!0;l.showModal({title:"需要完善您的个人信息",confirmText:"去完善",success:function(t){t.confirm&&l.navigateTo({url:"/pages/login/check/check"})}})}return!1},checkIsLogin:function(){return console.log(this.isLogin),!!this.isLogin||(l.showModal({title:"请先去授权登录吧",confirmText:"去登录",success:function(t){t.confirm&&l.navigateTo({url:"/pages/login/weixin/weixin"})}}),!1)}}};e.default=r}).call(this,i("bc2e")["default"],i("543d")["default"])},4217:function(t,e,i){},5585:function(t,e,i){"use strict";var l=i("4217"),n=i.n(l);n.a},"769b":function(t,e,i){"use strict";(function(t,e){var l=i("4ea4");i("895d");l(i("66fd"));var n=l(i("9713"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},9713:function(t,e,i){"use strict";i.r(e);var l=i("f236"),n=i("18c5");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("5585");var s=i("f0c5"),a=Object(s["a"])(n["default"],l["b"],l["c"],!1,null,null,null,!1,l["a"],void 0);e["default"]=a.exports},f236:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return l}));var l={sudaLoading:function(){return i.e("components/suda-loading/suda-loading").then(i.bind(null,"09dd"))},sudaBillTop:function(){return i.e("components/suda-bill-top/suda-bill-top").then(i.bind(null,"a8d0"))},uniIcons:function(){return Promise.all([i.e("common/vendor"),i.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(i.bind(null,"cff5"))},pageEmpty:function(){return i.e("components/page-empty/page-empty").then(i.bind(null,"1068"))},sudaToast:function(){return i.e("components/suda-toast/suda-toast").then(i.bind(null,"f067"))}},n=function(){var t=this,e=t.$createElement,i=(t._self._c,t.bill?t.billArr.length:null),l=t.bill&&i>0?t.__map(t.billArr,(function(e,i){var l=t.__get_orig(e),n=t.__map(e.monthItem,(function(e,i){var l=t.__get_orig(e),n=t.getMoney(e.actualAmount-e.paidAmount),o=e.isShow?t.__map(e.billDetail,(function(i,l){var n=t.__get_orig(i),o=e.billDetail.length,s=2===t.bill.selfPaymentMode?t.getDisplayDate(i.startDate):null,a=2===t.bill.selfPaymentMode?t.getDisplayDate(i.endDate):null,r=2!==t.bill.selfPaymentMode?t.getDisplayDate(i.startDate):null,u=2!==t.bill.selfPaymentMode?t.getDisplayDate(i.endDate):null,c=t.getMoney(i.amount);return{$orig:n,g1:o,m1:s,m2:a,m3:r,m4:u,m5:c}})):null,s=e.lateFee>0?t.getMoney(e.lateFee):null,a=e.taxInBillAmount>0?t.getMoney(e.taxInBillAmount):null,r=e.paidAmount>0?t.getMoney(e.paidAmount):null,u=e.discount>0?t.getMoney(e.discount):null,c=e.discount<0?t.getMoney(-e.discount):null,h=e.subLateFee>0?t.getMoney(e.subLateFee):null,m=e.subLateFee<0?t.getMoney(-e.subLateFee):null,d=e.exempt>0?t.getMoney(e.exempt):null;return{$orig:l,m0:n,l0:o,m6:s,m7:a,m8:r,m9:u,m10:c,m11:h,m12:m,m13:d}}));return{$orig:l,l1:n}})):null,n=t.bill?t.billArr.length:null,o=t.bill?t.billArr.length:null,s=t.bill&&o>0?t.getMoney(t.totalAmount):null,a=t.bill&&o>0?t.getMoney(t.total):null,r=!t.bill||o>0?null:t.billArr.length,u=t.getMoney(t.totalAmount),c=t.totalLateFee>0?t.getMoney(t.totalLateFee):null,h=t.totalTaxInBillAmount>0?t.getMoney(t.totalTaxInBillAmount):null,m=t.totalPaidAmount>0?t.getMoney(t.totalPaidAmount):null,d=t.totalDiscount>0?t.getMoney(t.totalDiscount):null,f=t.totalDiscount<0?t.getMoney(-t.totalDiscount):null,b=t.totalSubLateFee>0?t.getMoney(t.totalSubLateFee):null,g=t.totalSubLateFee<0?t.getMoney(-t.totalSubLateFee):null,p=t.totalExempt>0?t.getMoney(t.totalExempt):null,y=t.getMoney(t.total);t.$mp.data=Object.assign({},{$root:{g0:i,l2:l,g2:n,g3:o,m14:s,m15:a,g4:r,m16:u,m17:c,m18:h,m19:m,m20:d,m21:f,m22:b,m23:g,m24:p,m25:y}})},o=[]}},[["769b","common/runtime","common/vendor"]]]);