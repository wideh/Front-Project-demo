(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageBill/view-invoice/view-invoice"],{1311:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return i}));var i={sudaLoading:function(){return t.e("components/suda-loading/suda-loading").then(t.bind(null,"09dd"))},mpHtml:function(){return Promise.all([t.e("common/vendor"),t.e("components/mp-html/mp-html")]).then(t.bind(null,"6551"))},uModal:function(){return t.e("components/u-modal/u-modal").then(t.bind(null,"2d8b"))},userPrivacy:function(){return t.e("components/userPrivacy/userPrivacy").then(t.bind(null,"594f"))}},o=function(){var e=this.$createElement;this._self._c},a=[]},2662:function(e,n,t){"use strict";t.r(n);var i=t("53ae"),o=t.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(a);n["default"]=o.a},"53ae":function(e,n,t){"use strict";(function(e,i){var o=t("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=o(t("7504")),c={name:"view-invoice",components:{pageStatusBar:function(){t.e("components/page-status-bar/page-status-bar").then(function(){return resolve(t("9cf9"))}.bind(null,t)).catch(t.oe)},mpHtml:function(){Promise.all([t.e("common/vendor"),t.e("components/mp-html/mp-html")]).then(function(){return resolve(t("6551"))}.bind(null,t)).catch(t.oe)},NoData:function(){t.e("components/NoData").then(function(){return resolve(t("d1f5"))}.bind(null,t)).catch(t.oe)},userPrivacy:function(){t.e("components/userPrivacy/userPrivacy").then(function(){return resolve(t("594f"))}.bind(null,t)).catch(t.oe)}},data:function(){return{isLoading:!0,showPreview:!0,paymentId:"",outTradeNo:"",pdfUrl:"",email:"",content:"",paymentTicketId:"",sendMailVisible:!1,showPrivacy:!1}},onLoad:function(n){var t=this;this.paymentId="null"!=n.paymentId?n.paymentId:"",this.outTradeNo="null"!=n.outTradeNo?n.outTradeNo:"",this.getDetail(),e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,n){t.showPrivacy=!0,t.resolvePrivacyAuthorization=e}))},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},errTost:function(e){i.showToast({title:e,icon:"none"})},sendEmail:function(){this.email="",this.sendMailVisible=!0},confirm:function(){var e=this;if(this.email){/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(this.email)?(i.showLoading({title:"邮件发送中",mask:!0}),e.$http.request("/api/v2.0/weChat/invoices/send-email",{paymentTicketId:e.paymentTicketId,email:e.email},{headers:{"Content-Type":"application/json"},method:"POST"}).then((function(n){i.hideLoading(),e.submitBtnDisabled=!1,e.sendMailVisible=!1,i.navigateBack({delta:1})})).catch((function(n){i.hideLoading(),e.submitBtnDisabled=!1,e.sendMailVisible=!1,console.log(n),e.errorText=n.message,i.showToast({title:n.message,icon:"none"})}))):this.errTost("请输入正确的邮箱地址")}else this.errTost("请输入邮箱")},downLoadFile:function(){var n=this;e.getSetting({success:function(t){t.authSetting["scope.writePhotosAlbum"]?(console.log("已获取授权"),n.save()):(console.log("没有获取授权"),e.authorize({scope:"scope.writePhotosAlbum",success:function(e){n.save()}}))}})},save:function(){var n=this;i.downloadFile({url:n.pdfUrl,success:function(t){if(200===t.statusCode){var i=e.env.USER_DATA_PATH+"/"+(new Date).getTime()+".pdf.png";e.getFileSystemManager().saveFile({tempFilePath:t.tempFilePath,filePath:i,success:function(t){e.saveImageToPhotosAlbum({filePath:i,success:function(t){n.isShowMore=!1,e.showModal({title:"文件已保存到手机相册",content:"请进入手机文件管理 \r\n将保存的文件重命名改为[ .pdf ]后缀即可",confirmColor:"#0bc183",confirmText:"知道了",showCancel:!1})},fail:function(e){console.log(e)}})},fail:function(e){console.log(e)}})}},fail:function(e){console.log("下载失败",e),i.showToast({icon:"none",mask:!0,title:"失败请重新下载"})}})},gennarateUrl:function(e){var n=i.getStorageSync(a.default.storageKeys.token);if(e)return a.default.apiWYBaseUrl+e+"?access_token="+n.access_token},getDetail:function(){var e=this;e.$http.get("/api/v2.0/weChat/payment-histories/detail?paymentId="+e.paymentId).then((function(n){var t;e.isLoading=!1;var i=n,o=null;if((null===i||void 0===i||null===(t=i.invoices)||void 0===t?void 0:t.length)>0){var a,c;o=i.invoices[0];var s="";if(o.imgPath&&(null===(a=o.imgPath)||void 0===a?void 0:a.length)>0)for(var r=0;r<o.imgPath.length;r++){var l=o.imgPath[r],u=e.gennarateUrl(l);s+='<img src="'.concat(u,'"></img><br/>')}e.content=s,e.pdfUrl=o.pdfUrl,e.paymentTicketId=null===(c=o)||void 0===c?void 0:c.paymentTicketId}})).catch((function(n){e.isLoading=!1,console.log("catch:"+n)}))}}};n.default=c}).call(this,t("bc2e")["default"],t("543d")["default"])},"5ac1":function(e,n,t){"use strict";t.r(n);var i=t("1311"),o=t("2662");for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);t("d432");var c=t("f0c5"),s=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,"b7791702",null,!1,i["a"],void 0);n["default"]=s.exports},7983:function(e,n,t){"use strict";(function(e,n){var i=t("4ea4");t("895d");i(t("66fd"));var o=i(t("5ac1"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(o.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},9968:function(e,n,t){},d432:function(e,n,t){"use strict";var i=t("9968"),o=t.n(i);o.a}},[["7983","common/runtime","common/vendor"]]]);