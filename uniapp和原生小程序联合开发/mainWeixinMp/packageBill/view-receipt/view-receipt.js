(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageBill/view-receipt/view-receipt"],{"1b3c":function(e,n,t){"use strict";t.r(n);var o=t("b85e"),a=t("ba8c");for(var i in a)["default"].indexOf(i)<0&&function(e){t.d(n,e,(function(){return a[e]}))}(i);t("cf26");var c=t("f0c5"),r=Object(c["a"])(a["default"],o["b"],o["c"],!1,null,"7bfbf74d",null,!1,o["a"],void 0);n["default"]=r.exports},a6a1:function(e,n,t){"use strict";(function(e,o){var a=t("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=a(t("7504")),c={name:"view-receipt",components:{pageStatusBar:function(){t.e("components/page-status-bar/page-status-bar").then(function(){return resolve(t("9cf9"))}.bind(null,t)).catch(t.oe)},mpHtml:function(){Promise.all([t.e("common/vendor"),t.e("components/mp-html/mp-html")]).then(function(){return resolve(t("6551"))}.bind(null,t)).catch(t.oe)},NoData:function(){t.e("components/NoData").then(function(){return resolve(t("d1f5"))}.bind(null,t)).catch(t.oe)},userPrivacy:function(){t.e("components/userPrivacy/userPrivacy").then(function(){return resolve(t("594f"))}.bind(null,t)).catch(t.oe)}},data:function(){return{isLoading:!0,showPreview:!0,paymentId:"",outTradeNo:"",pdfUrl:"",content:"",showPrivacy:!1}},onLoad:function(n){var t=this;this.paymentId="null"!=n.paymentId?n.paymentId:"",this.outTradeNo="null"!=n.outTradeNo?n.outTradeNo:"",this.getDetail(),e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,n){t.showPrivacy=!0,t.resolvePrivacyAuthorization=e}))},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},downLoadFile:function(){var n=this;e.getSetting({success:function(t){t.authSetting["scope.writePhotosAlbum"]?(console.log("已获取授权"),n.save()):(console.log("没有获取授权"),e.authorize({scope:"scope.writePhotosAlbum",success:function(e){n.save()}}))}})},save:function(){var n=this;o.downloadFile({url:n.pdfUrl,success:function(t){if(200===t.statusCode){var o=e.env.USER_DATA_PATH+"/"+(new Date).getTime()+".pdf.png";e.getFileSystemManager().saveFile({tempFilePath:t.tempFilePath,filePath:o,success:function(t){e.saveImageToPhotosAlbum({filePath:o,success:function(t){n.isShowMore=!1,e.showModal({title:"文件已保存到手机相册",content:"请进入手机文件管理 \r\n将保存的文件重命名改为[ .pdf ]后缀即可",confirmColor:"#0bc183",confirmText:"知道了",showCancel:!1})},fail:function(e){console.log(e)}})},fail:function(e){console.log(e)}})}},fail:function(e){console.log("下载失败",e),o.showToast({icon:"none",mask:!0,title:"失败请重新下载"})}})},gennarateUrl:function(e){var n=o.getStorageSync(i.default.storageKeys.token);if(e)return i.default.apiWYBaseUrl+e+"?access_token="+n.access_token},getDetail:function(){var e=this,n=this;n.$httpCommon.post("/wy/api/v1.0/report/viewAsPDF",{paymentId:n.paymentId,outTradeNo:n.outTradeNo}).then((function(t){if(console.log("获取收据",t),n.isLoading=!1,null!==t&&void 0!==t&&t.success){var a,i=t.result;i.pdfPath&&(n.pdfUrl=n.gennarateUrl(i.pdfPath));var c="";if(i.imgPath&&(null===(a=i.imgPath)||void 0===a?void 0:a.length)>0){for(var r=0;r<i.imgPath.length;r++){var u=i.imgPath[r],s=n.gennarateUrl(u);c+='<img src="'.concat(s,'"></img><br/>')}e.content=c}}else{var l,f;o.showModal({title:"申请收据失败",content:null!==t&&void 0!==t&&null!==(l=t.error)&&void 0!==l&&l.message?null===t||void 0===t||null===(f=t.error)||void 0===f?void 0:f.message:"获取收据失败",showCancel:!1,confirmText:"确定",success:function(e){}})}})).catch((function(e){n.isLoading=!1,console.log("catch:"+e)}))}}};n.default=c}).call(this,t("bc2e")["default"],t("543d")["default"])},b85e:function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return i})),t.d(n,"a",(function(){return o}));var o={sudaLoading:function(){return t.e("components/suda-loading/suda-loading").then(t.bind(null,"09dd"))},mpHtml:function(){return Promise.all([t.e("common/vendor"),t.e("components/mp-html/mp-html")]).then(t.bind(null,"6551"))},userPrivacy:function(){return t.e("components/userPrivacy/userPrivacy").then(t.bind(null,"594f"))}},a=function(){var e=this.$createElement;this._self._c},i=[]},ba8c:function(e,n,t){"use strict";t.r(n);var o=t("a6a1"),a=t.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(i);n["default"]=a.a},cf26:function(e,n,t){"use strict";var o=t("d8e4"),a=t.n(o);a.a},d8e4:function(e,n,t){},eaf5:function(e,n,t){"use strict";(function(e,n){var o=t("4ea4");t("895d");o(t("66fd"));var a=o(t("1b3c"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(a.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])}},[["eaf5","common/runtime","common/vendor"]]]);