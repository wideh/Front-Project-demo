require('./common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageEC/pay-way"],{2410:function(e,t,r){"use strict";(function(e,n){var a=r("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(r("2eee")),i=a(r("9523")),s=a(r("c973")),c=a(r("7504"));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p={data:function(){return{orderNumbers:"",actualTotal:0,payType:0,payList:[{value:"1",name:"微信支付"},{value:"2",name:"线下支付"}],current:0,timer:"",endTime:"",countDown:!1,hou:"",min:"",sec:"",showModal:!1,modalContent:"",dvyType:"",params:{tenantId:c.default.tenantId,appCode:"",channelCode:"",goodsList:[],orderDescribe:"",goodsTotalFee:null,sourceBiz:"NOVA_MAIL",bizOrderNo:"",bizNotifyUrl:"",userName:""},orderType:"",payGuid:""}},onLoad:function(e){this.orderNumbers=e.orderNumbers,this.getOrderDetail(),this.getEndTime(),this.payGuid=e.payGuid||"",this.getAppCode()},methods:{getAppCode:function(){var t=this;return(0,s.default)(o.default.mark((function r(){var n,a;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=t,a=e.getStorageSync("token"),e.request({url:c.default.apiBaseUrl+"/iam/hzero/v1/users/self",method:"get",header:{Authorization:a.token_type+" "+a.access_token},success:function(t){if(t.data&&t.data.tenantId){var r=t.data,o=r.tenantName,i=r.tenantId;e.request({url:c.default.apiBaseUrl+"/npay/v1/app/page",method:"get",data:{__tenantName:o,tenantName:o,tenantId:i,page:1,size:1},header:{Authorization:a.token_type+" "+a.access_token},success:function(e){200===e.statusCode&&e.data&&e.data.totalElements>0&&(n.params.appCode=e.data.content[0].appCode)}})}},fail:function(){}});case 3:case"end":return r.stop()}}),r)})))()},radioChange:function(e){for(var t=0;t<this.payList.length;t++)if(this.payList[t].value===e.target.value){this.current=t;break}},getOrderDetail:function(){console.log("zhoux");var e=this;e.$httpOrder.get("/p/myOrder/orderDetail",{orderNumber:e.orderNumbers}).then((function(t){e.actualTotal=t.actualTotal,e.payType=t.payType,e.dvyType=t.dvyType,console.log("orderNumbersdetail",t),e.orderType=t.orderType;var r="",n=t.orderItemDtos.map((function(e){return r+=e.prodName,{goodsName:e.prodName,goodsCode:e.prodId,goodsFee:100*e.price,goodsCount:e.prodCount}}));e.params=d(d({},e.params),{},{goodsList:n,goodsTotalFee:100*t.actualTotal,userName:t.userAddrDto.receiver,orderDescribe:r.slice(0,127)})})).catch((function(e){console.log(e)}))},handleSubmit:function(){11==this.payType?this.offlineOrder():this.toNovaPay(this.orderNumbers,this.orderType)},toNovaPay:function(t,r){var n=this;return(0,s.default)(o.default.mark((function r(){var a;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=n,n.$httpOrder.post("/p/order/before/pay",{payType:1,orderNumbers:t,openId:e.getStorageSync("openId")}).then(function(){var e=(0,s.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a.params=d(d({},a.params),{},{channelCode:a.getCodeByType(t.payType),bizNotifyUrl:c.default.apiOrderBaseUrl+t.apiNoticeUrl,bizOrderNo:t.payNo}),e.next=3,a.handePay();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){t.data&&t.data.includes("过期")?e.showToast({title:t.data,icon:"none"}):e.showToast({title:"支付请求失败",icon:"error"})}));case 2:case"end":return r.stop()}}),r)})))()},handePay:function(){var t=this;return(0,s.default)(o.default.mark((function r(){var n;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=t,t.$httpHd.post("/npay/v1/unifiedOrder",n.params).then((function(r){e.requestPayment({timeStamp:r.params.timeStamp,nonceStr:r.params.nonceStr,package:r.params.package,signType:r.params.signType,paySign:r.params.paySign,success:function(e){t.saveOrderNo(r.goodsOrder.bizOrderNo,r.goodsOrder.orderNo)},fail:function(r){console.log("hjx-失败"),e.redirectTo({url:"/packageEC/pay-result?sts=0&orderNumbers=".concat(t.orderNumbers)})}})})).catch((function(){}));case 2:case"end":return r.stop()}}),r)})))()},saveOrderNo:function(t,r){var n=this;return(0,s.default)(o.default.mark((function a(){var i;return o.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:i=n,n.$httpOrder.post("/p/order/pay/success/".concat(i.payGuid,"/savePayOrderNoByPayGuid/").concat(t,"/").concat(r)).then((function(t){console.log("保存汉得的订单号到数据库",t),e.redirectTo({url:"/packageEC/pay-result?sts=1&orderNumbers=".concat(i.orderNumbers)})})).catch((function(){e.redirectTo({url:"/packageEC/pay-result?sts=0&orderNumbers=".concat(i.orderNumbers)})}));case 2:case"end":return a.stop()}}),a)})))()},getCodeByType:function(e){return 1==e?"WECHAT_MP":2==e?"ALIPAY_WAP":void 0},toPay:function(){var t=this,r=this;this.$httpOrder.post("/p/order/pay",{payType:1,orderNumbers:this.orderNumbers,openId:e.getStorageSync("openId"),isScore:5==this.dvyType?1:0}).then((function(a){console.log(a,"sssssss"),5==r.dvyType?e.redirectTo({url:"/packageEC/pay-result?sts=1&orderNumbers=".concat(t.orderNumbers)}):n.requestPayment({timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.packageValue,signType:a.signType,paySign:a.paySign,success:function(r){e.redirectTo({url:"/packageEC/pay-result?sts=1&orderNumbers=".concat(t.orderNumbers)})},fail:function(r){e.redirectTo({url:"/packageEC/pay-result?sts=0&orderNumbers=".concat(t.orderNumbers)})}})})).catch((function(e){console.log(e)}))},offlineOrder:function(){var t=this;e.showLoading({mask:!0,title:"请稍后..."}),this.$httpOrder.get("/sys/pconfig/info").then((function(r){t.showModal=!0,e.hideLoading(),t.modalContent=r.content})).catch((function(t){e.hideLoading(),t.data&&e.showToast({icon:"none",title:t.data})}))},modalConfirm:function(){e.redirectTo({url:"/packageEC/my-order"})},getEndTime:function(){var t=this;e.showLoading({mask:!0}),this.$httpOrder.get("/p/order/getOrderPayInfoByOrderNumber",{orderNumbers:this.orderNumbers}).then((function(r){t.endTime=r.endTime,t.actualTotal=r.totalFee,t.orderScore=r.totalScore,e.hideLoading(),t.getCountDown()})).catch((function(t){e.hideLoading()}))},getCountDown:function(){var e=(new Date).getTime(),t=new Date(this.endTime.replace(/\-/g,"/")).getTime(),r=(t-e)/1e3,n=parseInt(r%86400/3600),a=parseInt(r%86400%3600/60),o=parseInt(r%86400%3600%60);n=this.timeFormin(n),a=this.timeFormin(a),o=this.timeFormin(o),this.hou=this.timeFormat(n),this.min=this.timeFormat(a),this.sec=this.timeFormat(o),r>0?(this.countDown=!0,this.timer=setTimeout(this.getCountDown,1e3)):this.countDown=!1},timeFormat:function(e){return e<10?"0"+e:e},timeFormin:function(e){return e<0?0:e}}};t.default=p}).call(this,r("543d")["default"],r("bc2e")["default"])},3519:function(e,t,r){"use strict";var n=r("87de"),a=r.n(n);a.a},3762:function(e,t,r){"use strict";r.r(t);var n=r("2410"),a=r.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(o);t["default"]=a.a},"3e78":function(e,t,r){},"7f50":function(e,t,r){"use strict";var n=r("3e78"),a=r.n(n);a.a},"87de":function(e,t,r){},"9ad3":function(e,t,r){"use strict";t["a"]=function(e){e.options.wxsCallMethods||(e.options.wxsCallMethods=[])}},e5f0:function(e,t,r){"use strict";r.r(t);var n=r("ee91"),a=r("3762");for(var o in a)["default"].indexOf(o)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(o);r("7f50"),r("3519");var i=r("f0c5"),s=r("9ad3"),c=Object(i["a"])(a["default"],n["b"],n["c"],!1,null,"026ed230",null,!1,n["a"],void 0);"function"===typeof s["a"]&&Object(s["a"])(c),t["default"]=c.exports},ea09:function(e,t,r){"use strict";(function(e,t){var n=r("4ea4");r("895d");n(r("66fd"));var a=n(r("e5f0"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(a.default)}).call(this,r("bc2e")["default"],r("543d")["createPage"])},ee91:function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return n}));var n={uModal:function(){return r.e("components/u-modal/u-modal").then(r.bind(null,"2d8b"))}},a=function(){var e=this.$createElement;this._self._c},o=[]}},[["ea09","common/runtime","common/vendor"]]]);