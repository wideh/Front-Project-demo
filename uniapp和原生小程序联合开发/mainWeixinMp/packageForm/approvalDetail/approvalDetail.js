(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageForm/approvalDetail/approvalDetail"],{1088:function(e,t,o){},2435:function(e,t,o){"use strict";o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}));var n={userPrivacy:function(){return o.e("components/userPrivacy/userPrivacy").then(o.bind(null,"594f"))}},a=function(){var e=this,t=e.$createElement,o=(e._self._c,"自定义"==e.sourceTypeStr?e.__map(e.formItemList,(function(t,o){var n=e.__get_orig(t),a="Expenditure"==t.componentType?e.feeNormalData.total.toFixed(2):null,i="Expenditure"==t.componentType?e.__map(e.feeData,(function(t,o){var n=e.__get_orig(t),a=t.attachments.length;return{$orig:n,g1:a}})):null,r="Expenditure"!=t.componentType&&"LinkRequest"==t.componentType?e.linkRequstList.length:null;return{$orig:n,g0:a,l0:i,g2:r}})):null);e._isMounted||(e.e0=function(t){var o=[],n=arguments.length-1;while(n-- >0)o[n]=arguments[n+1];var a=o[o.length-1].currentTarget.dataset,i=a.eventParams||a["event-params"];t=i.file;return e.downloadFile(t)}),e.$mp.data=Object.assign({},{$root:{l1:o}})},i=[]},2552:function(e,t,o){"use strict";o.r(t);var n=o("b499"),a=o.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a},"5c54":function(e,t,o){"use strict";(function(e,t){var n=o("4ea4");o("895d");n(o("66fd"));var a=n(o("5f4d"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(a.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},"5f4d":function(e,t,o){"use strict";o.r(t);var n=o("2435"),a=o("2552");for(var i in a)["default"].indexOf(i)<0&&function(e){o.d(t,e,(function(){return a[e]}))}(i);o("76c3");var r=o("f0c5"),s=Object(r["a"])(a["default"],n["b"],n["c"],!1,null,"21dadad8",null,!1,n["a"],void 0);t["default"]=s.exports},"76c3":function(e,t,o){"use strict";var n=o("1088"),a=o.n(n);a.a},b499:function(e,t,o){"use strict";(function(e,n){var a=o("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(o("9523")),r=a(o("448a")),s=a(o("7037"));function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(Object(o),!0).forEach((function(t){(0,i.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var l=function(e){if("string"!=typeof e)return!1;try{var t=JSON.parse(e);return!("object"!=(0,s.default)(t)||!t)}catch(o){return!1}},p={name:"approvalDetail",components:{approvalHistory:function(){o.e("packageForm/components/approvalHistory").then(function(){return resolve(o("d087"))}.bind(null,o)).catch(o.oe)},userPrivacy:function(){o.e("components/userPrivacy/userPrivacy").then(function(){return resolve(o("594f"))}.bind(null,o)).catch(o.oe)}},data:function(){return{id:"",active:"",businessId:"",sourceTypeStr:"",isCanApproval:!1,baseInfo:{},appRovalList:[],historyList:[],timeId:null,formItemList:[],formData:{},formDisplayData:{},showExpenditure:!1,regionList:[],feeCatageList:[],feeNormalData:{regionName:"",region:"",remark:"",total:0},feeData:[{amount:"",category:"",categoryName:"",description:"",attachments:[]}],showLinkRequest:!1,linkRequstList:[],showPrivacy:!1}},onLoad:function(t){var o=this;console.log("审批申请详情",t),this.id=t.id,this.active=t.active,this.businessId=t.businessId,this.sourceTypeStr=t.sourceTypeStr;this.checkIsCanApproval(),this.getDetail(),this.getHistory(),this.getFormDesignAndData(),e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,t){o.showPrivacy=!0,o.resolvePrivacyAuthorization=e}))},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},debounceFn:function(e){this.timeId&&clearTimeout(this.timeId),this.timeId=setTimeout(e,500)},checkIsCanApproval:function(){var e=this;this.$httpWorkflow.get("/approval/canApproval/".concat(this.id),{isMiniProgram:1}).then((function(t){t&&t.success&&t.result?e.isCanApproval=!0:e.isCanApproval=!1})).catch((function(e){console.log(e)}))},getDetail:function(){var e=this;this.$httpWorkflow.get("/approval/detail/".concat(this.id)).then((function(t){t&&t.success&&(e.baseInfo=t.result)})).catch((function(e){console.log(e)}))},getFormDesignAndData:function(){if("自定义"===this.sourceTypeStr){var e=this;this.$httpWorkflow.get("/approval_custom_application/detail_view/".concat(this.businessId)).then((function(t){if(t&&t.success){console.log(t);var o,n,a=t.result;l(a.formDesign)&&(o=JSON.parse(a.formDesign)),l(a.formData)&&(n=JSON.parse(a.formData)),console.log("formDesignData",o.schema),console.log("formData",n),o.schema.properties&&Object.keys(o.schema.properties).map((function(t){var a=o.schema.properties["".concat(t)];if("Expenditure"==a["x-component"]){e.showExpenditure=!0;var c=n["".concat(t)];console.log("报销费用data",c),e.formItemList.push({componentType:a["x-component"]}),e.feeNormalData={region:c.values&&c.values.region?c.values.region:"",regionName:c.values&&c.values.regionName?c.values.regionName:"",remark:c.values&&c.values.remark?c.values.remark:"",total:c.approvals&&c.approvals.total?c.approvals.total:0},e.feeData=(0,r.default)(c.values.fees)}else if("LinkRequest"==a["x-component"]){e.showLinkRequest=!0;var l=n["".concat(t)];e.formItemList.push({componentType:a["x-component"]});var p=l.values.map((function(e){return"object"==(0,s.default)(e)?e.id:e}));p&&p.length>0&&e.$httpWorkflow.post("/approval_custom_type/link_requests",p).then((function(t){if(t&&t.success){var o=t.result;e.linkRequstList=o}})).catch((function(e){console.log(e)}))}else{if(e.formItemList.push({title:a.title,componentType:a["x-component"],valueName:t}),a.enum&&a.enum.length>0){var f=a.enum,h=f.find((function(e){return e.value==n["".concat(t)]}));h&&(e.formDisplayData=u(u({},e.formDisplayData),{},(0,i.default)({},"".concat(t),h.label)))}e.formData["".concat(t)]=n["".concat(t)]}}))}})).catch((function(e){console.log(e)}))}},getHistory:function(){var e=this;this.$httpWorkflow.get("/approval/history/".concat(this.id)).then((function(t){t&&t.success?e.historyList=t.result:e.historyList=[]})).catch((function(e){console.log(e)}))},downloadFile:function(t){n.downloadFile({url:t.url,success:function(o){if(200===o.statusCode){var a=t.name.split("."),i=["jpg","jpeg","png","webp","bmp"].indexOf(a[a.length-1]);if(i>-1){var r=e.env.USER_DATA_PATH+"/"+t.name;e.getFileSystemManager().saveFile({tempFilePath:o.tempFilePath,filePath:r,success:function(t){e.saveImageToPhotosAlbum({filePath:r,success:function(t){e.showModal({title:"文件已保存到手机相册",confirmColor:"#0bc183",confirmText:"知道了",showCancel:!1})},fail:function(e){console.log(e)}})},fail:function(e){console.log(e)}})}else n.saveFile({tempFilePath:o.tempFilePath,success:function(e){console.log("savedFilePath",e.savedFilePath),n.showToast({icon:"none",mask:!0,title:"请点击右上角的..., 下载文件到本地",duration:3e3}),setTimeout((function(){n.openDocument({filePath:e.savedFilePath,showMenu:!0,success:function(e){}})}),1e3)}})}},fail:function(e){console.log("下载失败",e),n.showToast({icon:"none",mask:!0,title:"失败请重新下载"})}})},agreeApproval:function(){var e=this;this.debounceFn((function(){console.log("触发审批同意",e.id),e.$httpWorkflow.put("/approval/approveProcess?isMiniProgram=1",{approvalIds:[e.id],comment:"同意"}).then((function(e){e&&e.success&&n.navigateBack()})).catch((function(e){console.log(e)}))}))},refuseApproval:function(){var e=this;this.debounceFn((function(){console.log("触发审批拒绝",e.id),e.$httpWorkflow.put("/approval/rejectProcess?isMiniProgram=1",{approvalIds:[e.id],comment:"拒绝"}).then((function(e){e&&e.success&&n.navigateBack()})).catch((function(e){console.log(e)}))}))},withdrawProcess:function(){var e=this;this.debounceFn((function(){console.log("触发撤销",e.id),e.$httpWorkflow.put("/approval/withdrawProcess?isMiniProgram=1",[e.id]).then((function(e){e&&e.success&&n.navigateBack()})).catch((function(e){console.log(e)}))}))},gotoVisitorResult:function(){n.navigateTo({url:"/pages/door/open/apply/result?visitorId=".concat(this.baseInfo.businessId)})},gotoComplaintResult:function(){n.navigateTo({url:"/pages/complaints/complaints-desc?id=".concat(this.baseInfo.businessId)})}}};t.default=p}).call(this,o("bc2e")["default"],o("543d")["default"])}},[["5c54","common/runtime","common/vendor"]]]);