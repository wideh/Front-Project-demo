(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageMeet/meet-lease-detail"],{"04da":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return r}));var r={uIcon:function(){return i.e("components/u-icon/u-icon").then(i.bind(null,"9ed9"))},hLoading:function(){return i.e("components/h-loading/h-loading").then(i.bind(null,"e62d"))},uPopup:function(){return i.e("components/u-popup/u-popup").then(i.bind(null,"f766"))}},o=function(){var e=this.$createElement;this._self._c},n=[]},"7e55":function(e,t,i){"use strict";(function(e,t){var r=i("4ea4");i("895d");r(i("66fd"));var o=r(i("84fa"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(o.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},"84fa":function(e,t,i){"use strict";i.r(t);var r=i("04da"),o=i("ba34");for(var n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(n);i("b037");var a=i("f0c5"),s=i("cac9"),m=Object(a["a"])(o["default"],r["b"],r["c"],!1,null,"45b97b0d",null,!1,r["a"],void 0);"function"===typeof s["a"]&&Object(s["a"])(m),t["default"]=m.exports},b037:function(e,t,i){"use strict";var r=i("c775"),o=i.n(r);o.a},ba34:function(e,t,i){"use strict";i.r(t);var r=i("cac8"),o=i.n(r);for(var n in r)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(n);t["default"]=o.a},c775:function(e,t,i){},cac8:function(e,t,i){"use strict";(function(e){var r=i("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(i("448a")),n=r(i("4082")),a=r(i("278c")),s=r(i("9523")),m=r(i("cfcb")),d=r(i("9d84")),c=["rentalCount"];function h(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function u(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?h(Object(i),!0).forEach((function(t){(0,s.default)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var l={components:{RoomCardDetail:function(){i.e("packageMeet/components/room-card-detail").then(function(){return resolve(i("22ab"))}.bind(null,i)).catch(i.oe)},SelectServe:function(){i.e("packageMeet/components/select-serve").then(function(){return resolve(i("a1e3"))}.bind(null,i)).catch(i.oe)},TimeLine:function(){i.e("packageMeet/components/time-line").then(function(){return resolve(i("77c5"))}.bind(null,i)).catch(i.oe)},ServeProdCard:function(){i.e("packageMeet/components/serve-prod-card").then(function(){return resolve(i("e64c"))}.bind(null,i)).catch(i.oe)},SelectTime:function(){i.e("packageMeet/components/select-time").then(function(){return resolve(i("d445"))}.bind(null,i)).catch(i.oe)}},data:function(){var e;return e={startDate:"",pageLoading:!0,roomId:void 0,prodId:void 0,roomDate:"",categoryId:0,settingObj:{},roomInfo:{},isPeriodOrder:!1,meetUsageTime:["06:00","18:00"],meetUsageGap:30,meetUsageDay:3,meetUsageList:[],rentalStartTime:{},rentalEndTime:{},meetForm:{periodStartDate:"",periodEndDate:"",periodStartTime:"",periodEndTime:"",rentalCount:0},skuList:[],defaultSku:void 0,propKeys:[],selectedPropObj:{},skuGroup:{},allProperties:[],selectedProp:[],selectedProperties:"",relateProds:[],findSku:!0,serveArr:[],isFromOrderDetail:!1,orderNum:null},(0,s.default)(e,"rentalStartTime",""),(0,s.default)(e,"rentalEndTime",""),(0,s.default)(e,"rentalRange",0),(0,s.default)(e,"showConfirmChange",!1),(0,s.default)(e,"selectTimeArray",[]),(0,s.default)(e,"categoryInfo",{}),e},computed:{getTotalPrice:function(){var e=this.serveArr.filter((function(e){return e})),t=e.reduce((function(e,t){return e+t.prodCount*t.prodPrice}),0);return this.defaultSku&&this.defaultSku.price?this.defaultSku.price*this.submitForm.rentalCount+t:0},meetTimeGap:function(){return this.meetUsageTime.length?this.meetUsageTime.map((function(e){var t=e.split(":"),i=(0,a.default)(t,1),r=i[0];return parseInt(r)})):[]},submitForm:function(){if(this.isPeriodOrder){var e=this.meetForm,t=e.rentalCount,i=(0,n.default)(e,c);if(this.meetForm.periodStartDate&&this.meetForm.periodEndDate){var r=new Date(this.meetForm.periodStartDate.replace(/-/g,"/")).getTime(),o=new Date(this.meetForm.periodEndDate.replace(/-/g,"/")).getTime(),a=parseInt((o-r)/1e3/60/60/24)+1;return u(u({},i),{},{rentalCount:a*t})}return this.meetForm}return{rentalStartTime:this.meetForm.periodStartTime?this.roomDate+" "+this.meetForm.periodStartTime+":00":"",rentalEndTime:this.meetForm.periodEndTime?this.roomDate+" "+this.meetForm.periodEndTime+":00":"",rentalCount:this.meetForm.rentalCount}},meetCanUseDay:function(){var e=new Date,t=(new Date).setDate(e.getDate()+this.meetUsageDay);return[this.$timeFormat(e.getTime(),"yyyy-mm-dd"),this.$timeFormat(t,"yyyy-mm-dd")]},meetTimeUsageList:function(){return this.meetUsageList.length?this.meetUsageList.map((function(e){return{start:new Date(e.startTime.replace(/-/g,"/")).getTime(),end:new Date(e.endTime.replace(/-/g,"/")).getTime()}})):[]},chooseMeetTime:function(){if(this.isPeriodOrder)return this.submitForm.periodStartDate?"".concat(this.submitForm.periodStartDate," ~ ").concat(this.submitForm.periodEndDate," ").concat(this.submitForm.periodStartTime," ~ ").concat(this.submitForm.periodEndTime):"";if(!this.submitForm.rentalStartTime)return"";var e=this.submitForm.rentalStartTime.split(" "),t=this.submitForm.rentalEndTime.split(" ");return"".concat(e[0]," ").concat(e[1]," ~ ").concat(t[1])},periodOrderText:function(){return this.isPeriodOrder?this.meetForm.periodEndDate:"不重复"}},onLoad:function(e){this.roomId=e.roomId,this.prodId=e.prodId,this.categoryId=e.categoryId,this.orderNum=e.orderNum,this.orderNum?(this.isFromOrderDetail=!0,this.rentalStartTime=e.rentalStartTime,this.rentalEndTime=e.rentalEndTime,this.rentalRange=this.setTimeRange(this.rentalStartTime,this.rentalEndTime,this.meetUsageGap),this.meetForm.periodStartTime=this.$timeFormat(this.rentalStartTime,"hh:MM"),this.meetForm.periodEndTime=this.$timeFormat(this.rentalEndTime,"hh:MM"),this.meetForm.rentalCount=this.setTimeRange(this.rentalStartTime,this.rentalEndTime,this.meetUsageGap),this.roomDate=this.$timeFormat(this.rentalStartTime,"yyyy-mm-dd"),this.showTimeSelect(),this.selectTimeArray.push(this.meetForm.periodStartTime),this.selectTimeArray.push(this.meetForm.periodEndTime)):this.roomDate=e.date,this.meetForm.periodStartDate=this.roomDate},onShow:function(e){e&&e.isFromPeriodDate?(this.meetForm.periodEndDate=e.periodEndDate,this.isPeriodOrder=e.isPeriodOrder):(this.getRoomBasicInfo(),this.initMeetTimeLine())},methods:{$timeFormat:m.default,getRoomBasicInfo:function(){var e=this;this.$httpMeet.get("/api/meeting/room/"+this.roomId).then((function(t){var i=t.data;return e.getProdBasicInfo().then((function(t){var r=t.price,o=t.brief,n=t.pic,a=t.imgs,s=t.unit,m=t.labelList,d=t.skuList,c=t.relateProds;console.log("relateProds",c);var h={price:r,unit:s,pic:n,imgs:a,brief:o,labelList:m};return h&&(i.prodInfo=h),e.relateProds=c,e.setServeData("skuList",d),e.groupSkuProp(d,r),i}))})).then((function(t){e.roomInfo=t,console.log("this.roomInfo",e.roomInfo),e.pageLoading=!1,console.log(e.roomInfo)})).catch((function(e){console.log(e)}))},initMeetTimeLine:function(){var e=this;this.getMeetUseTime().then((function(t){e.meetUsageTime=[t["MEETING_RESERVATION_DURATION_START"],t["MEETING_RESERVATION_DURATION_END"]],e.meetUsageGap=parseInt(t["MEETING_RESERVATION_INTERVAL"]),e.meetUsageDay=parseInt(t["MEETING_ROOM_RESERVATION"]),e.getMeetUseage(),e.isFromOrderDetail&&(e.meetForm.rentalCount=e.setTimeRange(e.rentalStartTime,e.rentalEndTime,e.meetUsageGap))}))},getMeetUseage:function(){var e=this;this.$httpMeet.get("/api/meeting-room-occupation",{startTime:this.roomDate+" 00:00:00",endTime:this.roomDate+" 23:59:59",roomId:this.roomId}).then((function(t){var i=t.data.map((function(t){return{start:e.$timeFormat(new Date(t.startTime.replace(/-/g,"/")).getTime(),"hh:MM"),end:e.$timeFormat(new Date(t.endTime.replace(/-/g,"/")).getTime(),"hh:MM")}}));e.isFromOrderDetail?e.meetUsageList=t.data.filter((function(t){if(t.startTime!=e.rentalStartTime||t.endTime!=e.rentalEndTime)return{start:new Date(t.startTime.replace(/-/g,"/")).getTime(),end:new Date(t.endTime.replace(/-/g,"/")).getTime()}})):e.meetUsageList=t.data,e.$nextTick((function(){e.$refs.timeLine.draw({start:e.meetTimeGap[0],end:e.meetTimeGap[1],datas:i})}))})).catch((function(e){console.log(e)}))},getMeetUseTime:function(){var e=this;return this.$httpOrder.get("/category/".concat(this.categoryId)).then((function(t){var i={MEETING_ROOM_RESERVATION:t.reservationDays,MEETING_RESERVATION_DURATION_START:t.reservationStart,MEETING_RESERVATION_DURATION_END:t.reservationEnd,MEETING_RESERVATION_INTERVAL:30};return e.settingObj=i,e.categoryInfo=t,i}))},getProdBasicInfo:function(){return this.$httpOrder.get("/prod/prodInfo",{prodId:this.prodId})},groupSkuProp:function(e,t){if(1==e.length&&""==e[0].properties)return this.setServeData("defaultSku",e[0]),void console.log("defaultSku",this.defaultSku);for(var i={},r=[],o=[],n={},a=null,s=0;s<e.length;s++){var m=!1;a||e[s].price!=t||(a=e[s],m=!0);var d=e[s].properties;r.push(d);for(var c=d.split(";"),h=0;h<c.length;h++){var u=c[h].split(":"),l=i[u[0]];m&&(o.push(u[0]),n[u[0]]=u[1]),void 0==l?(l=[],l.push(u[1])):-1===l.indexOf(u[1])&&l.push(u[1]),i[u[0]]=l}}console.log("skuGroup",i),console.log("allProperties",r),console.log("propKeys",o),console.log("selectedPropObj",n),console.log("defaultSku",a),this.setServeData("defaultSku",a),this.setServeData("propKeys",o),this.setServeData("selectedPropObj",n),this.parseSelectedObjToVals(e),this.setServeData("skuGroup",i),this.setServeData("allProperties",r)},toChooseItem:function(e){var t=e.skuLineItem,i=e.key;this.setServeData("selectedPropObj",t,i),this.parseSelectedObjToVals(this.skuList),this.roomInfo.prodInfo.price=this.defaultSku.price},parseSelectedObjToVals:function(e){var t=this.selectedPropObj,i="",r=[];for(var o in t)r.push(t[o]),i+=o+":"+t[o]+";";i=i.substring(0,i.length-1),this.setServeData("selectedProp",r),this.setServeData("selectedProperties",i),this.setServeData("selectedPropObj",t);for(var n=!1,a=0;a<e.length;a++)if(e[a].properties==i){n=!0,this.setServeData("defaultSku",e[a]);break}this.setServeData("findSku",n)},setServeData:function(e,t,i){i?(this.$refs.selectServe[e][i]=t,this[e][i]=t):(this.$refs.selectServe[e]=t,this[e]=t)},serveChange:function(e){var t=e.index,i=e.params,r=u(u({},i),{},{primaryItemId:this.prodId});this.$set(this.serveArr,t,r)},handleShowTimePopup:function(t){if("start"===t)this.$refs.selectStartTimePopup.show();else{if(!this.rentalStartTime.date)return void e.showToast({icon:"none",title:"请选择开始时间"});this.$refs.selectEndTimePopup.show()}},getStartTimePopup:function(e){this.rentalStartTime=e},getEndTimePopup:function(t){this.rentalStartTime.timeStamp>=t.timeStamp?e.showToast({icon:"none",title:"结束时间不能小于开始时间，请重新选择！"}):this.rentalEndTime=t},submitBefore:function(){var t=this;if(this.isPeriodOrder){if(!this.submitForm.periodStartDate)return e.showToast({icon:"none",title:"请选择预定日期"}),this.$refs.selectTime.show(),void this.onModalShow();if(!this.submitForm.periodStartTime)return e.showToast({icon:"none",title:"请选择预定时间"}),this.$refs.selectTime.show(),void this.onModalShow()}else if(!this.submitForm.rentalEndTime)return e.showToast({icon:"none",title:"请选择预定时间"}),this.$refs.selectTime.show(),void this.onModalShow();this.checkRoomIsUsed().then((function(e){e&&t.handleSubmit()})).catch((function(t){e.showModal({title:"提示",content:t,showCancel:!1,confirmText:"确定"})}))},checkRoomIsUsed:function(){var t={};return this.isPeriodOrder?t=this.submitForm:(t.startTime=this.submitForm.rentalStartTime,t.endTime=this.submitForm.rentalEndTime),this.isFromOrderDetail&&(t.orderNo=this.orderNum),this.$httpMeet.get("/api/meeting-room-occupation/usable",u({roomId:this.roomId,reservationEarlyDays:this.settingObj.MEETING_ROOM_RESERVATION,isPeriodOrder:this.isPeriodOrder},t)).then((function(t){return t.data||e.showToast({icon:"none",title:t.message}),t.data})).catch((function(e){console.log(e)}))},selectTimeChange:function(t){var i=this;if(this.meetForm.periodStartTime=t.start,this.meetForm.periodEndTime=t.end,this.meetForm.rentalCount=t.range,console.log(t),this.isFromOrderDetail){if(this.rentalRange!=this.getRangeByHour(t.start,t.end,this.meetUsageGap))return void e.showToast({title:"变更后的会议时长和变更前不一致，请重新选择。",icon:"none"});this.checkRoomIsUsed().then((function(e){e&&(i.showConfirmChange=!0)})).catch((function(t){e.showModal({title:"提示",content:t,showCancel:!1,confirmText:"确定"})}))}},confirmChange:function(){var t={orderNumber:this.orderNum,rentalStartTime:this.meetForm.periodStartTime?this.roomDate+" "+this.meetForm.periodStartTime+":00":"",rentalEndTime:this.meetForm.periodEndTime?this.roomDate+" "+this.meetForm.periodEndTime+":00":""};e.showLoading({title:"请稍后...",mask:!0}),d.default.post("/p/myOrder/meetingOrder/change",t).then((function(t){e.hideLoading(),e.showToast({title:"修改成功",icon:"none"}),e.navigateBack({delta:2})}))},handleSubmit:function(){var t=Math.ceil((this.rentalEndTime.timeStamp-this.rentalStartTime.timeStamp)/1e3/60/60),i=e.getStorageSync(this.$config.storageKeys.shopId),r=this.serveArr.filter((function(e){return e&&e.prodCount})).map((function(e){return u(u({},e),{},{shopId:i})})),n={addrId:0,orderItems:[u({prodId:parseInt(this.prodId),skuId:this.defaultSku.skuId,prodCount:1,shopId:i,distributionCardNo:"",primaryItemId:"",isPeriodOrder:this.isPeriodOrder?1:0,unitHourCount:t,rentalCount:t},this.submitForm)].concat((0,o.default)(r)),couponIds:[],userChangeCoupon:0,isScorePay:0,userUseScore:null,dvyType:3,isMeetingRoomRenting:!0};console.log("hjx-params",JSON.parse(JSON.stringify(n))),e.showLoading({title:"请稍后...",mask:!0}),this.$store.dispatch("submitConfirm",n).then((function(t){e.redirectTo({url:"/packageEC/confirm-order",complete:function(t){setTimeout((function(){e.$emit("comfirm-order-param",n)}),1e3)}}),e.hideLoading()}))},handleDateChange:function(t){var i=new Date(this.roomDate.replace(/-/g,"/"));if("minus"===t){var r=i.setDate(i.getDate()-1),o=(new Date).setHours(0,0,0,0);r<o?e.showToast({title:"预定时间不能小于当前时间！",icon:"none"}):this.roomDate=this.$timeFormat(r,"yyyy-mm-dd")}else{var n=new Date,a=(new Date).setDate(n.getDate()+this.meetUsageDay),s=i.setDate(i.getDate()+1);s>=a?e.showToast({title:"只能预定".concat(this.meetUsageDay,"天内的时间"),icon:"none"}):this.roomDate=this.$timeFormat(s,"yyyy-mm-dd")}this.meetForm.periodStartDate=this.roomDate,this.getMeetUseage()},showSelectTime:function(){this.$refs.selectTime.show(),this.onModalShow()},onModalShow:function(){this.$refs.timeLine.transformImage()},setIsPeriodOrder:function(){e.navigateTo({url:"/packageMeet/meet-lease-period?periodStartDate="+this.roomDate+"&isPeriodOrder="+this.isPeriodOrder+"&minDate="+this.meetCanUseDay[0]+"&maxDate="+this.meetCanUseDay[1]+"&periodEndDate="+this.meetForm.periodEndDate})},datePickerChange:function(t){var i=t.detail.value,r=new Date(i.replace(/-/g,"/")),o=(new Date).setHours(0,0,0,0);if(r<o)e.showToast({title:"预定时间不能小于当前时间！",icon:"none"});else{var n=new Date,a=(new Date).setDate(n.getDate()+this.meetUsageDay);r>=a?e.showToast({title:"只能预定".concat(this.meetUsageDay,"天内的时间"),icon:"none"}):(this.roomDate=this.$timeFormat(r,"yyyy-mm-dd"),this.meetForm.periodStartDate=this.roomDate,this.getMeetUseage())}},setTimeRange:function(e,t,i){var r=new Date(e).getTime(),o=new Date(t).getTime(),n=Math.ceil((o-r)/1e3/60/i);return n},getRangeByHour:function(e,t,i){var r=new Date(this.$timeFormat(new Date,"yyyy-mm-dd")+" "+e).getTime(),o=new Date(this.$timeFormat(new Date,"yyyy-mm-dd")+" "+t).getTime(),n=Math.ceil((o-r)/1e3/60/i);return n},showTimeSelect:function(){var e=this;setTimeout((function(){e.showSelectTime()}),1e3)}}};t.default=l}).call(this,i("543d")["default"])},cac9:function(e,t,i){"use strict";t["a"]=function(e){e.options.wxsCallMethods||(e.options.wxsCallMethods=[])}}},[["7e55","common/runtime","common/vendor"]]]);