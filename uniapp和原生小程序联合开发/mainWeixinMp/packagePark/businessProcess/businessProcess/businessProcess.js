require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packagePark/businessProcess/businessProcess/businessProcess"],{1392:function(e,t,a){"use strict";a.r(t);var i=a("7fe2"),r=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t["default"]=r.a},"1d19":function(e,t,a){"use strict";(function(e,t){var i=a("4ea4");a("895d");i(a("66fd"));var r=i(a("8b60"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(r.default)}).call(this,a("bc2e")["default"],a("543d")["createPage"])},"7fe2":function(e,t,a){"use strict";(function(e){var i=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(a("60e9")),n={onShow:function(){if("1"==this.status)this.getDetail(this.cardId);else{var t=e.getStorageSync(this.$config.storageKeys.user);this.phoneNumber=t.phoneNumber,this.carPlate="",this.address="",this.plateColorIndex=-1,this.carPlateIndex=-1,this.plateColorId="",this.vehicleTypeIndex=-1,this.vehicleTypeId="",this.remark="",this.parkinglotIndex=-1,this.parkingLotId="",this.startDate=this.getNowDate(),this.endDate="",this.timePeriodIndex=-1,this.endSelectEnable=!1}},onLoad:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.status,i=t.cardId;this.status=a,this.cardId=i,this.$httpPark.get("/parkingLot/list",{size:-1}).then((function(t){t&&(e.parkinglotList=t)})),this.$httpPark.get("/dict/item/plate_color",{size:-1}).then((function(t){t&&(e.plateColorArr=t)})),this.$httpPark.get("/vehicleType/page?size=-1").then((function(t){e.vehicleTypeArr=t.records})),this.$httpPark.get("/vehicle/app").then((function(t){var a=t;a.reverse(),e.carPlateArr=a}))},components:{},data:function(){return{cardId:"",carPlate:"",carPlateIndex:-1,carPlateArr:[],address:"",phoneNumber:"",plateColorIndex:-1,plateColorArr:[],plateColorId:"",vehicleTypeIndex:-1,vehicleTypeId:"",vehicleTypeArr:[],remark:"",parkinglotIndex:-1,parkingLotId:"",parkinglotList:[],startDate:this.getNowDate(),endDate:"",startPeriodStartDate:"2000-01-01",startPeriodEndDate:"2030-12-31",endPeriodStartDate:"2000-01-01",endPeriodEndDate:"2030-12-31",timePeriodIndex:-1,endSelectEnable:!1,timePeriod:[{label:"1个月",value:1},{label:"3个月",value:3},{label:"半年",value:6},{label:"1年",value:12},{label:"自定义",value:"-0"}]}},computed:{getEndDateStr:function(){return this.endSelectEnable?this.endDate||"请选择结束日期":this.endDate||"-"},carPlateName:function(){var e=this;if(!this.carPlate)return"";var t=this.carPlateArr.find((function(t){return t==e.carPlate}));return console.log("name",t),t||""},parkName:function(){var e=this;if(!this.parkingLotId)return"";var t=this.parkinglotList.find((function(t){return t.parkingLotId==e.parkingLotId}));return t&&t.parkName},plateColor:function(){var e=this;if(!this.plateColorId)return"";var t=this.plateColorArr.find((function(t){return t.value==e.plateColorId+""}));return t&&t.label},vehicleTypeName:function(){var e=this;if(!this.vehicleTypeId)return"";var t=this.vehicleTypeArr.find((function(t){return t.vehicleTypeId==e.vehicleTypeId}));return t&&t.vehicleTypeName}},methods:{getDetail:function(t){var a=this;e.showLoading(),this.$httpPark.get("/parkWorkflow/"+t).then((function(e){var t=e.applyPhone,i=e.endDate,n=e.id,s=e.parkingLotId,l=e.startDate,o=e.vehicles,d=e.remark;a.cardId=n,a.phoneNumber=t,a.endSelectEnable=!0,a.timePeriodIndex=4,a.parkingLotId=s,a.plateColorId=o[0]&&o[0].plateColor,a.vehicleTypeId=o[0]&&o[0].vehicleTypeId,a.carPlate=o[0]&&o[0].plateNumber,a.remark=d,a.startDate=(0,r.default)(l).format("YYYY-MM-DD"),a.endDate=(0,r.default)(i).format("YYYY-MM-DD")})).finally((function(){return e.hideLoading()}))},handleTimePeriodChange:function(e){var t=e.detail.value,a=this.timePeriod[t];this.timePeriodIndex=t,"-0"===a.value?(this.endSelectEnable=!0,this.endDate="",this.endPeriodStartDate=this.startDate):(this.endSelectEnable=!1,this.calEndDate())},carPlateChange:function(e){var t=e.detail.value;this.carPlateIndex=t,this.carPlate=this.carPlateArr[t]},calEndDate:function(){var e=this.timePeriod[this.timePeriodIndex];if("-0"!==e.value){var t=this.startDate.replace(/-/g,"/");t=(0,r.default)(t).startOf("day");var a=t.add(e.value,"months").add(-1,"days").endOf("day");this.endDate=a.format("YYYY-MM-DD")}},handlePlateColorChange:function(e){if(e){var t=e.detail.value;this.plateColorIndex=t,this.plateColorId=this.plateColorArr[t].value}},handlePlateVehicleTypeChange:function(e){if(e){var t=e.detail.value;this.vehicleTypeIndex=t,this.vehicleTypeId=this.vehicleTypeArr[t].vehicleTypeId}},getNowDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,i=e.getDate();return a=a>9?a:"0"+a,i=i>9?i:"0"+i,"".concat(t,"-").concat(a,"-").concat(i)},bindStartDateChange:function(e){var t=this.timePeriod[this.timePeriodIndex];if(this.startDate=e.detail.value,"-0"!==t.value)this.calEndDate();else{if(!this.endDate)return;this.checkStartAndEnd()}},bindEndDateChange:function(e){this.endDate=e.detail.value,this.checkStartAndEnd()},confirm:function(){this.dateStartInfo=this.dateInfo1,this.dateEndInfo=this.dateInfo2},parkinglotChange:function(e){if(e){var t=e.detail.value;this.parkingLotId=this.parkinglotList[t].parkingLotId,this.parkinglotIndex=t}},error:function(t){e.showToast({title:t,icon:"none"})},checkStartAndEnd:function(){var e=this.startDate,t=this.endDate,a=(0,r.default)(e.replace(/-/g,"/")),i=(0,r.default)(t.replace(/-/g,"/"));if((0,r.default)(a).diff(i,"seconds")>0)return this.error("开始日期应早于结束日期"),!1;var n=this.getNowDate().replace(/-/g,"/");return!((0,r.default)(i).diff(n,"seconds")<0)||(this.error("结束日期应晚于当前日期"),!1)},toGetPhone:function(){e.showModal({title:"当前未绑定手机号, 是否绑定?"})},submit:function(){var t=this,a=this.error,i=this.parkName;if(!i)return a("请选择停车场");if(!this.carPlateName.length)return a("请输入车牌号");if(-1==this.timePeriodIndex)return a("请选择有效期");if(!this.endDate)return a("请选择结束日期");if(this.checkStartAndEnd()){if(!this.phoneNumber)return a("当前未授权手机号");var n={id:this.cardId,parkingLotId:this.parkingLotId,applyAddress:this.address,startDate:(0,r.default)(this.startDate.replace(/-/g,"/")).startOf("day").format("YYYY-MM-DD HH:mm:ss"),endDate:(0,r.default)(this.endDate.replace(/-/g,"/")).endOf("day").format("YYYY-MM-DD HH:mm:ss"),plateColor:this.plateColorId,vehicleTypeId:this.vehicleTypeId,plateNumbers:[this.carPlateName],applyPhone:this.phoneNumber,remark:this.remark};e.showLoading({title:"加载中"}),this.$httpPark.post("/parkWorkflow/app-apply",n).then((function(i){console.log("res: ",i);var r=JSON.stringify(i);i&&1==i.failed?a(i.message):r.includes("error")?a(i.data.exception):(r.includes("成功")||r.includes("true")||r.includes("完成"))&&("1"==t.status?e.redirectTo({url:"../success/success?success=1"}):e.navigateTo({url:"../success/success?success=1"}),e.hideLoading())})).catch((function(t){console.log("err: ",t),e.hideLoading()})).finally()}}},watch:{carPlateIndex:function(e){var t=this;console.log("v: ",e),this.carPlateName&&this.$httpPark.get("/vehicle/list",{plateNumber:this.carPlateName}).then((function(e){if(e&&e.length>=1){var a=e[0];t.vehicleTypeId=a.vehicleTypeId,t.plateColorId=a.value}}))}}};t.default=n}).call(this,a("543d")["default"])},"8b60":function(e,t,a){"use strict";a.r(t);var i=a("f32c5"),r=a("1392");for(var n in r)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(n);a("8f0f");var s=a("f0c5"),l=Object(s["a"])(r["default"],i["b"],i["c"],!1,null,"283c42aa",null,!1,i["a"],void 0);t["default"]=l.exports},"8f0f":function(e,t,a){"use strict";var i=a("c16a"),r=a.n(i);r.a},c16a:function(e,t,a){},f32c5:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){}));var i=function(){var e=this.$createElement,t=(this._self._c,this.remark.length);this.$mp.data=Object.assign({},{$root:{g0:t}})},r=[]}},[["1d19","common/runtime","common/vendor","packagePark/common/vendor"]]]);