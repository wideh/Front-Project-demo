(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packagePlace/prod-info/prod-info"],{"2ee1":function(t,e,r){},"644f":function(t,e,r){"use strict";r.r(e);var o=r("c139"),n=r("d02a");for(var i in n)["default"].indexOf(i)<0&&function(t){r.d(e,t,(function(){return n[t]}))}(i);r("e70c");var s=r("f0c5"),u=Object(s["a"])(n["default"],o["b"],o["c"],!1,null,"f2a76b0e",null,!1,o["a"],void 0);e["default"]=u.exports},b658:function(t,e,r){"use strict";(function(t,e){var o=r("4ea4");r("895d");o(r("66fd"));var n=o(r("644f"));t.__webpack_require_UNI_MP_PLUGIN__=r,e(n.default)}).call(this,r("bc2e")["default"],r("543d")["createPage"])},c139:function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return o}));var o={pageStatusBar:function(){return r.e("components/page-status-bar/page-status-bar").then(r.bind(null,"9cf9"))},uIcon:function(){return r.e("components/u-icon/u-icon").then(r.bind(null,"9ed9"))}},n=function(){var t=this.$createElement;this._self._c},i=[]},c29b:function(t,e,r){"use strict";(function(t){var o=r("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(r("448a")),i=o(r("9523")),s=o(r("4082")),u=["num","hours","unitHours"];function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function c(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){(0,i.default)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var d={name:"prodInfo",components:{TimeLine:function(){r.e("packagePlace/components/time-line").then(function(){return resolve(r("33c9"))}.bind(null,r)).catch(r.oe)},SkuSelect:function(){r.e("packagePlace/components/sku-select").then(function(){return resolve(r("36e04"))}.bind(null,r)).catch(r.oe)},ServeProdCard:function(){r.e("packagePlace/components/serve-prod-card").then(function(){return resolve(r("d574"))}.bind(null,r)).catch(r.oe)}},data:function(){return{option:{},prodId:0,roomInfo:{},prodInfo:{},orderInfo:{},labelList:[],relateProds:[],skuList:[],skuGroup:{},skuSelect:{},skuId:0,skuImg:"",priceInfo:{skuPrice:0,relatePrice:0,roomPrice:0},categoryInfo:{},titleContainerHeight:0,navigationBarTitle:"场所预约",startDate:"2023-09-25",roomDate:"2023-09-25"}},computed:{totalPrice:function(){var t=0,e=this.option,r=e.personCount,o=e.unitHours,n=e.hours;return this.priceInfo.roomPrice=this.priceInfo.skuPrice*r*(n/o),t=(this.priceInfo.roomPrice+this.priceInfo.relatePrice)/100,t.toFixed(2)},attrStr:function(){return this.skuSelect?Object.values(this.skuSelect).join("，"):""}},onLoad:function(e){var r=t.getSystemInfoSync();"android"==r.platform?this.titleContainerHeight=48:this.titleContainerHeight=44;var o=e.num,n=e.hours,i=e.unitHours,a=(0,s.default)(e,u);this.option=e,this.orderInfo={num:o,hours:n,unitHours:i,startTime:a.appointmentTimeStart.slice(10,16)},this.roomDate=a.appointmentTimeStart.slice(0,10),this.getRoomInfo(a)},methods:{getCategoryInfo:function(t){var e=this;this.$httpOrder.get("/category/".concat(this.option.categoryId)).then((function(r){e.$nextTick((function(){var o=[];t&&(o=t.map((function(t){return{start:t.occupationTimeStart.slice(10,16),end:t.occupationTimeEnd.slice(10,16)}}))),e.$refs.timeLine.draw({start:Number(r.reservationStart.split(":")[0]),end:Number(r.reservationEnd.split(":")[0]),datas:o}),setTimeout((function(){e.$refs.timeLine.transformImage()}),300)}))}))},getProdInfo:function(t){var e=this;this.$httpOrder.get("/prod/prodInfo?prodId=".concat(t)).then((function(t){e.prodInfo=t;var r=t.labelList,o=void 0===r?[]:r,n=t.relateProds,i=void 0===n?[]:n,s=t.skuList,u=void 0===s?[]:s;if(e.labelList=o.map((function(t){return{labelId:t.labelId,title:t.title}})),e.relateProds=i,e.skuList=u,1===u.length&&""===u[0].properties)e.skuGroup={},e.skuImg="",e.priceInfo.skuPrice=100*u[0].price,e.skuSelect={},e.skuId=u[0].skuId;else if(u.length>1){var a={};a=1===u.length?u[0]:u.find((function(e){return e.price===t.price}));for(var c={},d=[],p=0;p<u.length;p++){var f=u[p].properties;d.push(f);for(var l=f.split(";"),h=function(t){var e=l[t].split(":"),r=c[e[0]];void 0==r?(r=[],r.push({attr:e[1],selected:a.skuName.split(" ").some((function(t){return t===e[1]}))})):r.find((function(t){return t.attr===e[1]}))||r.push({attr:e[1],selected:a.skuName.split(" ").some((function(t){return t===e[1]}))}),c[e[0]]=r},m=0;m<l.length;m++)h(m)}e.skuGroup=c,console.log("hjx-skuGroup",c);var I={};a.properties&&(e.skuImg=a.pic,e.priceInfo.skuPrice=100*a.price,e.skuId=a.skuId,a.properties.split(";").forEach((function(t){var e=t.split(":");I[e[0]]=e[1]}))),e.skuSelect=I}}))},changeAttr:function(t){var e=this,r=t.item,o=t.key;this.skuSelect[o]=r.attr,this.skuGroup[o]=this.skuGroup[o].map((function(t){return c(c({},t),{},{selected:r.attr===t.attr})}));var n=this.skuList.find((function(t){return t.skuName===Object.values(e.skuSelect).join(" ")+" "}));n&&(this.skuId=n.skuId,this.skuImg=n.pic,this.priceInfo.skuPrice=100*n.price)},getRoomInfo:function(t){var e=this;this.$httpOrder.post("/prod/getAvailableRoomProd",t).then((function(t){e.roomInfo=t,e.prodId=t.prodId,e.getProdInfo(t.prodId),e.getCategoryInfo(t.occupationDTOS)}))},recommendChange:function(t){var e=t.index,r=t.params;this.relateProds[e]=c(c({},this.relateProds[e]),r),this.priceInfo.relatePrice=this.relateProds.reduce((function(t,e){return t+(e.prodCount||0)*(e.prodPrice||0)*100}),0)},onClickBack:function(){t.navigateBack()},setSkuModalData:function(t,e){this.$refs.skuSelect[t]=e},showSkuModal:function(){this.setSkuModalData("visible",!0)},submitConfirm:function(){var e=this,r=this.option,o=r.appointmentTimeStart,i=r.appointmentTimeEnd,s=r.unitHours,u=r.hours,a=r.personCount,c=t.getStorageSync(this.$config.storageKeys.shopId),d=this.relateProds.filter((function(t){return t&&t.prodCount})).map((function(t){return{shopId:c,prodId:t.prodId,skuId:t.skuId,prodPrice:t.prodPrice,prodCount:t.prodCount,distributionCardNo:"",primaryItemId:e.prodId}})),p={addrId:0,orderItems:[{prodId:parseInt(this.prodId),skuId:this.skuId,prodCount:1,shopId:c,distributionCardNo:"",primaryItemId:"",isPeriodOrder:this.isPeriodOrder?1:0,rentalStartTime:o,rentalEndTime:i,unitHourCount:u/s,personCount:a,rentalCount:u/s*a}].concat((0,n.default)(d)),couponIds:[],userChangeCoupon:0,isScorePay:0,userUseScore:null,dvyType:3,isMeetingRoomRenting:!0};console.log("hjx-params",JSON.parse(JSON.stringify(p))),t.showLoading({title:"请稍后...",mask:!0}),this.$store.dispatch("submitConfirm",p).then((function(r){t.redirectTo({url:"/packageEC/confirm-order"+"?type=place&prodId=".concat(e.prodId,"&personCount=").concat(a,"&unitHours=").concat(s,"&hours=").concat(u),complete:function(e){setTimeout((function(){t.$emit("comfirm-order-param",p)}),1e3)}}),t.hideLoading()}))},submitBefore:function(){var e=this,r={roomId:this.prodInfo.roomId,startTime:this.option.appointmentTimeStart,endTime:this.option.appointmentTimeEnd,isPeriodOrder:!1,orderNo:null,reservationEarlyDays:this.option.earlyDays};this.$httpMeet.get("/api/meeting-room-occupation/usable",r).then((function(r){r.data?e.submitConfirm():t.showToast({icon:"none",title:r.message})}))}}};e.default=d}).call(this,r("543d")["default"])},d02a:function(t,e,r){"use strict";r.r(e);var o=r("c29b"),n=r.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){r.d(e,t,(function(){return o[t]}))}(i);e["default"]=n.a},e70c:function(t,e,r){"use strict";var o=r("2ee1"),n=r.n(o);n.a}},[["b658","common/runtime","common/vendor"]]]);