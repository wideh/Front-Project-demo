require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageRepair/flowRepair/detail/detail"],{"1f82":function(e,t,n){"use strict";n.r(t);var o=n("b76e"),a=n("b463");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("3ce2");var i=n("f0c5"),c=Object(i["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=c.exports},"3ce2":function(e,t,n){"use strict";var o=n("5230"),a=n.n(o);a.a},5230:function(e,t,n){},6669:function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("895d");o(n("66fd"));var a=o(n("1f82"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},b463:function(e,t,n){"use strict";n.r(t);var o=n("ec09"),a=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=a.a},b76e:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));var o={sudaPopup:function(){return n.e("components/suda-popup/suda-popup").then(n.bind(null,"7271"))},uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.imgs.length),o=e.getColor(e.status),a=e.hasComment?null:e.__map(e.processHistorys,(function(t,n){var o=e.__get_orig(t),a=e.processHistorys.length,r=n==a-1?e.getTimeStr(t.creationDate):null,i=n==a-1?e.getDateStr(t.creationDate):null,c=n!=a-1?e.getTimeStr(t.creationDate):null,s=n!=a-1?e.getDateStr(t.creationDate):null;return{$orig:o,g1:a,m1:r,m2:i,m3:c,m4:s}}));e.$mp.data=Object.assign({},{$root:{g0:n,m0:o,l0:a}})},r=[]},ec09:function(e,t,n){"use strict";(function(e){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("2eee")),r=o(n("c973")),i=n("dfda"),c={components:{uniTag:function(){n.e("node-modules/@dcloudio/uni-ui/lib/uni-tag/uni-tag").then(function(){return resolve(n("f7b5"))}.bind(null,n)).catch(n.oe)},customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)},sxRate:function(){Promise.all([n.e("packageRepair/common/vendor"),n.e("packageRepair/components/sx-rate/index")]).then(function(){return resolve(n("9b89"))}.bind(null,n)).catch(n.oe)}},data:function(){return{question:"",voucherNo:"",areaStr:"",place:"",customerName:"",phone:"",contactPhone:"",appointmentTime:"",status:1,statusStr:"",isExpand:!1,imgs:[],hasComment:!1,commentContent:"",workOrderId:0,processHistorys:[],footerData:null,commentStar:5,evaluates:{},evaluateTypes:[],showWithdrawPop:!1,withdrawReasons:[{name:"信息填错了",check:!0},{name:"问题已经解决了，不需要维修了",check:!1},{name:"价格不合适，不修了",check:!1}],revokeAllowed:!1}},onLoad:function(t){console.log(t);var n=this;t&&t.id&&(n.workOrderId=t.id,n.getDetailDataBy(t.id),n.getHistoryList(t.id),n.getRevokeAllowed());var o=e.getStorageSync(n.$config.storageKeys.community);n.$http.get("/api/v2.0/weChat/regions/".concat(o.id,"/phone")).then((function(e){n.contactPhone=e}))},onShow:function(){this.getFooterData()},methods:{onItemClick:function(e){this.withdrawReasons.forEach((function(e){return e.check=!1})),this.withdrawReasons[e].check=!0},withdraw:function(){this.$refs["select-withdraw"].open()},cancel:function(){this.$refs["select-withdraw"].close()},confirmWithdraw:function(){this.$refs["select-withdraw"].close(),this.revokeOrder()},callPhone:function(){var t=this;return new Promise((function(n,o){e.showModal({title:"确认拨打该电话吗？",content:t.contactPhone,success:function(e){e.confirm?n(!0):n(!1)}})}))},contact:function(){var t=this;return(0,r.default)(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.contactPhone){n.next=7;break}return n.next=3,t.callPhone();case 3:if(!n.sent){n.next=5;break}e.makePhoneCall({phoneNumber:t.contactPhone});case 5:n.next=8;break;case 7:e.showToast({icon:"none",title:"亲爱的业主：电话号码修改中，暂时无法显示，请耐心等待！",duration:2e3});case 8:case"end":return n.stop()}}),n)})))()},actionSheetTap:function(t){var n=t,o=this;e.showActionSheet({itemList:["预览"],success:function(t){if(0==t.tapIndex){var a=[];o.imgs.forEach((function(e){e.filePath&&a.push(e.filePath)})),e.previewImage({current:n,urls:a})}}})},getDateStr:function(e){if(e)return this.$formatmyDate(e).split(" ")[0]},getTimeStr:function(e){if(e)return this.$formatmyDate(e).split(" ")[1]},reminder:function(){this.$http.request("/api/v2.0/weChat/repairs/".concat(this.workOrderId,"/urge"),null,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"PUT"}).then((function(t){console.log(t),e.showToast({title:"催单成功！",icon:"none"})})).catch((function(t){console.log(t),e.showToast({title:t.message,icon:"none"})}))},getEnum:function(){var e=this,t=this;t.$httpCommon.get("".concat(i.PRE_FIX,"/repair/evaluate-types/enable-list")).then((function(n){if(console.log(n),n&&n.success){var o={},a=n.result.map((function(e){return o["".concat(e.id)]=5,e}));t.evaluateTypes=a,t.evaluates=o,e.getCommentDetail()}})).catch((function(e){console.log(e)}))},getDetailDataBy:function(t){var n=this;this.$httpCommon.get("".concat(i.PRE_FIX,"/repair/records/").concat(t)).then((function(e){if(null!==e&&void 0!==e&&e.success){var t=e.result;n.phone=t.phone,n.question=t.details,n.voucherNo=t.code,n.areaStr=t.address,n.place=t.place?t.place:"",n.customerName=t.customerName,n.appointmentTime=n.appointmentTime?n.appointmentTime:"",n.imgs=t.attachments,n.status=t.repairStatus,n.statusStr=t.repairStatusStr}})).catch((function(t){console.log(t),e.showToast({title:t.message,icon:"none"})}))},getHistoryList:function(t){var n=this,o=this;this.$httpCommon.get("".concat(i.PRE_FIX,"/repair/histories/byrepair/").concat(t)).then((function(e){if(null!==e&&void 0!==e&&e.success){var t=e.result;o.hasComment=t.findIndex((function(e){return"评价"==e.operationType}))>-1,o.hasComment&&n.getEnum(),o.processHistorys=t&&t.length?t.reverse():[]}})).catch((function(t){console.log(t),e.showToast({title:t.message,icon:"none"})}))},getCommentDetail:function(t){var n=this,o=this;this.$httpCommon.get("".concat(i.PRE_FIX,"/repair/histories/return-visit/byrepair/").concat(this.workOrderId)).then((function(e){if(null!==e&&void 0!==e&&e.success){var t=e.result,a=t.filter((function(e){return"评价"===e.source}));if((null===a||void 0===a?void 0:a.length)>0){var r=a[0];o.commentStar=r.commentStar,o.commentContent=r.commentContent;var i={};n.evaluateTypes.map((function(e){var t=r.evaluates.find((function(t){return t.evaluateTypeId===e.id}));t&&(i["".concat(e.id)]=t.commentStar)})),o.evaluates=i}}})).catch((function(t){console.log(t),e.showToast({title:t.message,icon:"none"})}))},getRevokeAllowed:function(){var t=this;this.$httpCommon.post("".concat(i.PRE_FIX,"/repair/records/revoke/check"),{repairId:t.workOrderId}).then((function(e){if(null!==e&&void 0!==e&&e.success){var n=e.result;t.revokeAllowed=n.revokeAllowed}})).catch((function(t){console.log(t),e.showToast({title:t.message,icon:"none"})}))},revokeOrder:function(){var t=this;e.showLoading({mask:!0});var n=t.withdrawReasons.find((function(e){return 1==e.check}));t.$httpCommon.post("".concat(i.PRE_FIX,"/repair/records/revoke"),{repairId:t.workOrderId,remark:n.name}).then((function(n){n&&n.success?(e.hideLoading(),t.getRevokeAllowed(),t.getDetailDataBy(t.workOrderId),t.getHistoryList(t.workOrderId)):e.showToast({title:n.error.message||"撤回失败，请稍后重试",duration:2500,icon:"none"})})).catch((function(t){console.log(res),e.hideLoading(),e.showToast({title:"撤回失败，请重试",duration:1500,icon:"none"})}))},getFooterData:function(){var e=this;return(0,r.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$footerConfig.get();case 2:n=t.sent,console.log(n),e.footerData=n;case 5:case"end":return t.stop()}}),t)})))()},getColor:function(e){return null==e?"#cccccc":7==e?"#de8c84":"#34A853"}}};t.default=c}).call(this,n("543d")["default"])}},[["6669","common/runtime","common/vendor","packageRepair/common/vendor"]]]);