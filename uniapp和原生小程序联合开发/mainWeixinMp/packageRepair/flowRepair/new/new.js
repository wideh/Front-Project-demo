require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageRepair/flowRepair/new/new"],{"5e67":function(e,t,n){"use strict";(function(e,t){var i=n("4ea4");n("895d");i(n("66fd"));var a=i(n("d8f2"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"69fa":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i}));var i={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))},userPrivacy:function(){return n.e("components/userPrivacy/userPrivacy").then(n.bind(null,"594f"))}},a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.imgs.length),i=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/7b77b4e20b024965a0dfbfee0c99daa6@new_address.svg"),a=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/e64bb061ed564352aa73f98fce669eaf@new_name.svg"),r=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/1b0b61cea54d4a7c928c1d366bed08bd@new_phone.svg"),o=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/2a66604e3d724667a97c662ecb01d649@new_repairType.svg"),s=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/2a66604e3d724667a97c662ecb01d649@new_repairType.svg"),c=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/11b6eeca5d8b430d93c7ae3a1f508eb9@new_time.svg"),u=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/11b6eeca5d8b430d93c7ae3a1f508eb9@new_time.svg");e.$mp.data=Object.assign({},{$root:{g0:n,m0:i,m1:a,m2:r,m3:o,m4:s,m5:c,m6:u}})},r=[]},"6dc5":function(e,t,n){"use strict";var i=n("b076"),a=n.n(i);a.a},b076:function(e,t,n){},b44f:function(e,t,n){"use strict";n.r(t);var i=n("c00a"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},c00a:function(e,t,n){"use strict";(function(e,i){var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("7504")),o="/nova-customer-service/v1/".concat(r.default.tenantId),s={components:{uniSegmentedControl:function(){n.e("node-modules/@dcloudio/uni-ui/lib/uni-segmented-control/uni-segmented-control").then(function(){return resolve(n("3f52"))}.bind(null,n)).catch(n.oe)},uniIcons:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(n("1533"))}.bind(null,n)).catch(n.oe)},SelectPicker:function(){n.e("packageRepair/components/select-picker/index").then(function(){return resolve(n("04ef"))}.bind(null,n)).catch(n.oe)},userPrivacy:function(){n.e("components/userPrivacy/userPrivacy").then(function(){return resolve(n("594f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{imgs:[],content:"",name:"",phone:"",textareaMaxLength:800,textareaWordCount:0,maxUploadImgLength:1,isPublicArea:!1,repairArea:"",repairPubArea:"",startDate:"",endDate:"",startTime:"",date:"",time:"",resourceId:null,resourcePubId:null,footerData:null,enableHouseRepair:!1,dispatchTypes:[],repairParentTypeName:"",repairParentTypeId:null,dispatchChildTypes:[],repairTypeName:"",repairTypeId:null,showRepairParentType:!1,showDispatchChildTypes:!1,enableAnonymousRepair:!1,showPrivacy:!1}},onLoad:function(t){var n=this;e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,t){n.showPrivacy=!0,n.resolvePrivacyAuthorization=e}));var a=this;a.startDate=a.getDate("start"),a.endDate=a.getDate("end"),a.startTime=a.getStartTime(),a.enableHouseRepair="true"==t.enableHouseRepair,a.isPublicArea=!a.enableHouseRepair,a.enableAnonymousRepair="true"==t.enableAnonymousRepair,a.enableAnonymousRepair&&i.removeStorageSync("resource")},onShow:function(){var e=this,t=i.getStorageSync(e.$config.storageKeys.user);if(t)if(e.isPublicArea){var n=i.getStorageSync(this.$config.positionKeys.building),a=i.getStorageSync(this.$config.positionKeys.unit);if(a)e.resourcePubId=a.id,e.repairPubArea=n.text+a.text;else if(n){n=i.getStorageSync(this.$config.positionKeys.building);e.resourcePubId=n.id,e.repairPubArea=n.text}else e.resourcePubId="",e.repairPubArea="";this.$http.get("/api/v2.0/wechat/authorized-users/me").then((function(t){t&&(e.name=t.customerName||"",e.phone=t.phoneNumber||"")}))}else{var r=i.getStorageSync("resource");r?(e.resourceId=r.resourceId,e.repairArea=r.text,e.textareaWordCount=0,e.$http.get("/api/v1.0/PropertyMgmt/BasicResourceManagement/House/Detail/".concat(r.resourceId)).then((function(t){e.name=t.customerName,e.phone=t.phone}))):(e.resourceId="",e.repairArea="",e.textareaWordCount=0,e.name="",e.phone="",this.initAutoWrite())}else i.showModal({title:"提示",content:"请先登录",showCancel:!1,success:function(e){i.switchTab({url:"../../../pages/me/me"})}});this.getDispatchTypes()},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},openShowRepairParentType:function(){this.showRepairParentType=!0},openShowDispatchChildTypes:function(){this.showDispatchChildTypes=!0},error:function(e){i.hideLoading(),i.showToast({icon:"none",title:e||"系统繁忙，请稍候重试",duration:2500})},clearInfomartion:function(){this.imgs=[],this.content="",this.name="",this.phone="",this.date="",this.time="",this.repairArea="",this.resourceId=null,this.repairParentTypeName="",this.repairParentTypeId=null,this.repairTypeName="",this.repairTypeId=null},initAutoWrite:function(){var e=this;this.isPublicArea||this.$http.get("/api/v2.0/weChat/user-resources/me").then((function(t){if(t){var n=t.filter((function(e){return 5==e.itemType}));if(n&&1==n.length){var i=n[0],a=(i.city?i.city:"")+(i.regionName?"/"+i.regionName:"")+(i.groupName?"/"+i.groupName:"")+(i.buildingName?"/"+i.buildingName:"")+(i.unitName?"/"+i.unitName:"")+(i.resourceCode?"/"+i.resourceCode:"");e.resourceId=i.resourceId,e.repairArea=a,e.name=i.customerName,e.phone=i.customerPhone}}})).catch((function(e){console.log(e)}))},getDispatchTypes:function(){var e=this;this.$httpCommon.post("".concat(o,"/repair/types/all"),{page:1,pageSize:999}).then((function(t){if(t&&t.success){var n=t.result.records||[];e.dispatchTypes=n;var i=n.find((function(e){return e.isDefault}));i&&(e.repairParentTypeName=i.name,e.repairParentTypeId=i.id,e.getDispatchChildTypes(i.id))}}))},getDispatchChildTypes:function(e){var t=this;this.$httpCommon.post("".concat(o,"/repair/types/all"),{page:1,pageSize:999,parentId:e}).then((function(e){if(e&&e.success){var n=e.result.records||[];t.dispatchChildTypes=n;var i=n.find((function(e){return e.isDefault}));i?(t.repairTypeName=i.name,t.repairTypeId=i.id):(t.repairTypeName="",t.repairTypeId=null)}}))},onRepairParentType:function(e){var t=this.dispatchTypes[e];this.repairParentTypeName=t.name,this.repairParentTypeId=t.id,this.getDispatchChildTypes(t.id)},onRepairType:function(e){var t=this.dispatchChildTypes[e];this.repairTypeName=t.name,this.repairTypeId=t.id},goTohistory:function(){i.navigateTo({url:"/packageRepair/flowRepair/history/history"})},descInput:function(){this.textareaWordCount=this.content.length},uploadImg:function(){var e=this,t=e.maxUploadImgLength-e.imgs.length,n=["img","jpg","png","gif","jpeg","BMP","svg","TIFF","bmp","JPG","JPEG","GIF","PNG","IMG","SVG","rar","zip","doc","docx","pdf"];i.chooseImage({count:t,sizeType:["original","compressed"],success:function(t){var a,o=t.tempFiles[0].path;if(-1!==n.indexOf(o.split(".")[(null===(a=o.split("."))||void 0===a?void 0:a.length)-1]))if(t.tempFiles[0].size>2097152)e.error("上传文件大小不得超过2M！");else{var s=o.substring(o.lastIndexOf("/")+1);console.log("fileName",s);var c=s,u=i.getStorageSync(r.default.storageKeys.token);i.uploadFile({url:e.$config.apiBaseUrl+"/hfle/v1/files/multipart",filePath:o,name:"file",formData:{filename:s,bucketName:"public",directory:"hpfm05"},header:{"Content-Type":"multipart/form-data",Authorization:u.token_type+" "+u.access_token},success:function(t){if(console.log("上传文件成功",t),200===t.statusCode){var n={fileName:c,filePath:t.data};e.imgs=[n]}500===t.statusCode&&e.error("上传文件失败，请重新上传")},fail:function(t){return e.error("上传文件失败，请重新上传"),!1}})}else{var p="只能上传".concat(n.map((function(e){return".".concat(e)})).join(","),"类型图片或文件!");e.error(p)}}})},actionSheetTap:function(e){var t=e,n=this;i.showActionSheet({itemList:["删除","预览"],success:function(e){0==e.tapIndex&&n.deleteImg(t),1==e.tapIndex&&i.previewImage({current:t,urls:[n.imgs[0].filePath]})}})},deleteImg:function(e){this.imgs.splice(e,1)},selectArea:function(e){this.isPublicArea=1==e},selectResource:function(){this.isPublicArea?(i.removeStorageSync(this.$config.positionKeys.area),i.removeStorageSync(this.$config.positionKeys.building),i.removeStorageSync(this.$config.positionKeys.unit),i.navigateTo({url:"../../../pages/position/position?targetKey="+this.$config.positionKeys.buildingLot})):i.navigateTo({url:"../../../pages/me/select/room-and-parking/room-and-parking?selectType=room&enableAnonymousRepair="+this.enableAnonymousRepair})},getDate:function(e){var t=new Date;return"end"===e&&t.setFullYear(t.getFullYear()+1),t.format("yyyy-MM-dd")},getStartTime:function(){var e=new Date,t=new Date(this.date);return t.getFullYear()>e.getFullYear()||t.getMonth()>e.getMonth()||t.getDate()>e.getDate()?"":e.format("hh:mm")},bindDateChange:function(e){this.date=e.target.value,this.time="",this.startTime=this.getStartTime()},bindTimeChange:function(e){this.date?this.time=e.target.value:this.error("请先选择上门日期")},validate:function(){var e=this;return e.content?e.resourceId||e.resourcePubId?e.name?isNaN(e.phone)||e.phone<1e10||e.phone>19999999999?(e.error("手机号码格式错误"),!1):e.repairParentTypeId?e.repairTypeId?!(e.date&&!e.time)||(e.error("请设置时间"),!1):(e.error("请选择工单子类"),!1):(e.error("请选择工单大类"),!1):(e.error("请输入您的姓名"),!1):(e.error("请选择服务位置"),!1):(e.error("请输入报修需求"),!1)},submit:function(){var e=this,t=this;if(i.showLoading({mask:!0}),t.validate()){var n=t.$formatDate(t.date+" "+t.time);t.$httpCommon.post("".concat(o,"/repair/records"),{organizationItemId:t.isPublicArea?t.resourcePubId:t.resourceId,details:t.content,customerName:t.name,phone:t.phone,appointmentTime:n,repairParentTypeId:t.repairParentTypeId,repairTypeId:t.repairTypeId,fromMobile:!0,isCompleted:!1,sourceType:3,attachments:t.imgs,sourceMini:1}).then((function(n){n&&n.success?(i.hideLoading(),t.clearInfomartion(),i.navigateTo({url:"../new-success/new-success"})):e.error(n.error.message||"新建失败，请稍后重试")})).catch((function(e){console.log(res),i.hideLoading(),i.showToast({title:"创建失败，请重试",duration:1500,icon:"none"})}))}},getstaticOssUrl:function(e){return e?this.$tool.image.getstaticOssUrl(e):""}}};t.default=s}).call(this,n("bc2e")["default"],n("543d")["default"])},d8f2:function(e,t,n){"use strict";n.r(t);var i=n("69fa"),a=n("b44f");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("6dc5");var o=n("f0c5"),s=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=s.exports}},[["5e67","common/runtime","common/vendor"]]]);