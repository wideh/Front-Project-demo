require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageRepair/flowRepair/rework/rework"],{"02b0":function(e,t,n){},"19d2":function(e,t,n){"use strict";(function(e,a){var i=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("2eee")),r=i(n("c973")),s=i(n("7504")),c=n("dfda"),u={components:{uniSegmentedControl:function(){n.e("node-modules/@dcloudio/uni-ui/lib/uni-segmented-control/uni-segmented-control").then(function(){return resolve(n("3f52"))}.bind(null,n)).catch(n.oe)},uniIcons:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(n("1533"))}.bind(null,n)).catch(n.oe)},customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)},userPrivacy:function(){n.e("components/userPrivacy/userPrivacy").then(function(){return resolve(n("594f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{id:"",imgs:[],order:"",area:"",content:"",address:"",name:"",phone:"",repairParentTypeName:"",repairParentTypeId:null,repairTypeName:"",repairTypeId:null,textareaMaxLength:800,textareaWordCount:0,maxUploadImgLength:1,startDate:"",endDate:"",startTime:"",date:"",time:"",footerData:null,showPrivacy:!1}},onLoad:function(t){var n=this;e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,t){n.showPrivacy=!0,n.resolvePrivacyAuthorization=e}));var a=this;a.startDate=a.getDate("start"),a.endDate=a.getDate("end"),a.startTime=a.getStartTime(),t&&t.id&&(this.id=t.id,this.getDetailDataBy(t.id))},onShow:function(){this.getFooterData()},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},getDetailDataBy:function(e){var t=this,n=this;this.$httpCommon.get("".concat(c.PRE_FIX,"/repair/records/").concat(e)).then((function(e){if(null!==e&&void 0!==e&&e.success){var a,i=e.result;t.getDispatchChildTypes(i.repairParentTypeId,i.repairTypeId),n.phone=i.phone,n.content=i.details,n.textareaWordCount=null===i||void 0===i||null===(a=i.details)||void 0===a?void 0:a.length,n.order=i.code,n.area=i.isPublic?"公共":"户内",n.address=i.address,n.place=i.place?i.place:"",n.name=i.customerName,n.appointmentTime=n.appointmentTime?n.appointmentTime:"",n.imgs=i.attachments,n.repairParentTypeId=i.repairParentTypeId,n.repairParentTypeName=i.repairParentTypeName,n.organizationItemId=i.organizationItemId}})).catch((function(e){console.log(e),a.showToast({title:e.message,icon:"none"})}))},getDispatchChildTypes:function(e,t){var n=this;this.$httpCommon.post("".concat(c.PRE_FIX,"/repair/types/all"),{page:1,pageSize:999,parentId:e}).then((function(e){if(e&&e.success){var a=e.result.records||[],i=a.find((function(e){return e.id==t}));i&&(n.repairTypeName=i.name,n.repairTypeId=i.id)}}))},descInput:function(){this.textareaWordCount=this.content.length},uploadImg:function(){var e=this,t=e.maxUploadImgLength-e.imgs.length,n=["img","jpg","png","gif","jpeg","BMP","svg","TIFF","bmp","JPG","JPEG","GIF","PNG","IMG","SVG","rar","zip","doc","docx","pdf"];a.chooseImage({count:t,sizeType:["original","compressed"],success:function(t){var i;console.log("选择文件临时",t),console.log("选取图片路径",t.tempFiles[0].path),console.log("选取图片大小",t.tempFiles[0].size);var o=t.tempFiles[0].path;if(-1!==n.indexOf(o.split(".")[(null===(i=o.split("."))||void 0===i?void 0:i.length)-1]))if(t.tempFiles[0].size>2097152)e.error("上传文件大小不得超过2M！");else{var r=o.substring(o.lastIndexOf("/")+1);console.log("fileName",r);var c=r,u=a.getStorageSync(s.default.storageKeys.token);a.uploadFile({url:e.$config.apiBaseUrl+"/hfle/v1/files/multipart",filePath:o,name:"file",formData:{filename:r,bucketName:"public",directory:"hpfm05"},header:{"Content-Type":"multipart/form-data",Authorization:u.token_type+" "+u.access_token},success:function(t){console.log("上传文件成功",t);var n={fileName:c,filePath:t.data};e.imgs=[n]},fail:function(t){return e.error("上传文件失败，请重新上传"),!1}})}else{var l="只能上传".concat(n.map((function(e){return".".concat(e)})).join(","),"类型图片或文件!");e.error(l)}}})},actionSheetTap:function(e){var t=e,n=this;a.showActionSheet({itemList:["删除","预览"],success:function(e){0==e.tapIndex&&n.deleteImg(t),1==e.tapIndex&&a.previewImage({current:t,urls:[n.imgs[0].filePath]})}})},onClickItem:function(e){this.current!==e&&(this.current=e)},deleteImg:function(e){this.imgs.splice(e,1)},getDate:function(e){var t=new Date;return"end"===e&&t.setFullYear(t.getFullYear()+1),t.format("yyyy-MM-dd")},getStartTime:function(){var e=new Date,t=new Date(this.date);return t.getFullYear()>e.getFullYear()||t.getMonth()>e.getMonth()||t.getDate()>e.getDate()?"":e.format("hh:mm")},bindDateChange:function(e){this.date=e.target.value,this.time="",this.startTime=this.getStartTime()},bindTimeChange:function(e){this.time=e.target.value},validate:function(){return""!=this.date||""!=this.time||(a.showToast({title:"请先选择上门时间",icon:"none"}),!1)},submit:function(){var e=this,t=this;if(t.validate()){a.showLoading({mask:!0});var n=t.$formatDate(t.date+" "+t.time);t.$httpCommon.put("".concat(c.PRE_FIX,"/repair/records"),{id:t.id,organizationItemId:t.organizationItemId,details:t.content,customerName:t.name,phone:t.phone,appointmentTime:n,repairParentTypeId:t.repairParentTypeId,repairTypeId:t.repairTypeId,fromMobile:!0,isCompleted:!1,sourceType:3,attachments:t.imgs}).then((function(n){n&&n.success&&e.$httpCommon.post("".concat(c.PRE_FIX,"/repair_mine/reset"),{repairId:t.id,remark:"没有修好"}).then((function(e){e&&e.success&&(a.hideLoading(),a.navigateTo({url:"../rework-success/rework-success?delta=2"}))}))})).catch((function(e){console.log(res),a.showToast({title:"创建失败，请重试",duration:1500,icon:"none"})}))}},downloadImage:function(e){console.log(e);for(var t=[],n=0;n<e.length;n++){var i=e[n].url;console.log(i),a.downloadFile({url:this.$config.apiWYBaseUrl+i,success:function(e){console.log(e),t.push(e.tempFilePath)}})}return t},getFooterData:function(){var e=this;return(0,r.default)(o.default.mark((function t(){var n;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$footerConfig.get();case 2:n=t.sent,e.footerData=n;case 4:case"end":return t.stop()}}),t)})))()},getstaticOssUrl:function(e){return e?this.$tool.image.getstaticOssUrl(e):""}}};t.default=u}).call(this,n("bc2e")["default"],n("543d")["default"])},"7b19":function(e,t,n){"use strict";n.r(t);var a=n("90bd"),i=n("9b57");for(var o in i)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(o);n("a471");var r=n("f0c5"),s=Object(r["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=s.exports},"90bd":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return a}));var a={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))},userPrivacy:function(){return n.e("components/userPrivacy/userPrivacy").then(n.bind(null,"594f"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.imgs.length),a=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/e64bb061ed564352aa73f98fce669eaf@new_name.svg"),i=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/e64bb061ed564352aa73f98fce669eaf@new_name.svg"),o=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/7b77b4e20b024965a0dfbfee0c99daa6@new_address.svg"),r=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/e64bb061ed564352aa73f98fce669eaf@new_name.svg"),s=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/1b0b61cea54d4a7c928c1d366bed08bd@new_phone.svg"),c=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/2a66604e3d724667a97c662ecb01d649@new_repairType.svg"),u=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/2a66604e3d724667a97c662ecb01d649@new_repairType.svg"),l=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/11b6eeca5d8b430d93c7ae3a1f508eb9@new_time.svg"),d=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/11b6eeca5d8b430d93c7ae3a1f508eb9@new_time.svg");e.$mp.data=Object.assign({},{$root:{g0:n,m0:a,m1:i,m2:o,m3:r,m4:s,m5:c,m6:u,m7:l,m8:d}})},o=[]},"9b57":function(e,t,n){"use strict";n.r(t);var a=n("19d2"),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);t["default"]=i.a},a471:function(e,t,n){"use strict";var a=n("02b0"),i=n.n(a);i.a},f312:function(e,t,n){"use strict";(function(e,t){var a=n("4ea4");n("895d");a(n("66fd"));var i=a(n("7b19"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])}},[["f312","common/runtime","common/vendor","packageRepair/common/vendor"]]]);