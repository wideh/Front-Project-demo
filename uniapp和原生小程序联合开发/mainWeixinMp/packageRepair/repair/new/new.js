require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageRepair/repair/new/new"],{"1c81":function(e,t,n){"use strict";(function(e,t){var i=n("4ea4");n("895d");i(n("66fd"));var o=i(n("e31d"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"2c7f":function(e,t,n){"use strict";n.r(t);var i=n("af5e"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=o.a},"5f58":function(e,t,n){"use strict";var i=n("62ed"),o=n.n(i);o.a},"62ed":function(e,t,n){},af5e:function(e,t,n){"use strict";(function(e,i){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("2eee")),r=o(n("c973")),s=o(n("7504")),c={components:{uniSegmentedControl:function(){n.e("node-modules/@dcloudio/uni-ui/lib/uni-segmented-control/uni-segmented-control").then(function(){return resolve(n("3f52"))}.bind(null,n)).catch(n.oe)},uniIcons:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(n("1533"))}.bind(null,n)).catch(n.oe)},customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)},userPrivacy:function(){n.e("components/userPrivacy/userPrivacy").then(function(){return resolve(n("594f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{imgs:[],content:"",name:"",phone:"",textareaMaxLength:800,textareaWordCount:0,maxUploadImgLength:1,isPublicArea:!1,repairArea:"",startDate:"",endDate:"",startTime:"",date:"",time:"",resourceId:null,footerData:null,showPrivacy:!1}},onLoad:function(){var t=this;e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,n){t.showPrivacy=!0,t.resolvePrivacyAuthorization=e}));var n=this;n.startDate=n.getDate("start"),n.endDate=n.getDate("end"),n.startTime=n.getStartTime(),i.removeStorageSync("resource"),this.setDefaultCustomerInfo()},onShow:function(){var e=this,t=i.getStorageSync(e.$config.storageKeys.user);if(t)if(e.isPublicArea){var n=i.getStorageSync(this.$config.positionKeys.building),o=i.getStorageSync(this.$config.positionKeys.unit);if(o)e.resourceId=o.id,e.repairArea=n.text+o.text;else if(n){n=i.getStorageSync(this.$config.positionKeys.building);e.resourceId=n.id,e.repairArea=n.text}else e.resourceId="",e.repairArea=""}else{var a=i.getStorageSync("resource");a?(e.resourceId=a.resourceId,e.repairArea=a.text,e.name=a.houseOwnerName,e.phone=a.houseOwnerPhone):(e.resourceId="",e.repairArea="")}else i.showModal({title:"提示",content:"请先登录",showCancel:!1,success:function(e){i.switchTab({url:"../../../pages/me/me"})}});this.getFooterData()},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},clearInfomartion:function(){this.imgs=[],this.content="",this.name="",this.phone="",this.date="",this.time="",this.repairArea="",this.resourceId=null},goTohistory:function(){i.navigateTo({url:"/packageRepair/repair/history/history"})},descInput:function(){this.textareaWordCount=this.content.length},uploadImg:function(){var e=this,t=e.maxUploadImgLength-e.imgs.length;t>0&&i.chooseImage({count:t,sizeType:["original","compressed"],success:function(t){var n=e.imgs.concat(t.tempFilePaths);e.imgs=n}})},actionSheetTap:function(e){var t=e,n=this;i.showActionSheet({itemList:["删除","预览"],success:function(e){0==e.tapIndex&&n.deleteImg(t),1==e.tapIndex&&i.previewImage({current:t,urls:n.imgs})}})},deleteImg:function(e){this.imgs.splice(e,1)},selectArea:function(e){this.isPublicArea=1==e,this.resourceId=null,this.repairArea="",this.setDefaultCustomerInfo()},selectResource:function(){this.isPublicArea?(i.removeStorageSync(this.$config.positionKeys.area),i.removeStorageSync(this.$config.positionKeys.building),i.removeStorageSync(this.$config.positionKeys.unit),i.navigateTo({url:"../../../pages/position/position?targetKey="+this.$config.positionKeys.buildingLot})):i.navigateTo({url:"../../../pages/me/select/room-and-parking/room-and-parking?selectType=room"})},getDate:function(e){var t=new Date;return"end"===e&&t.setFullYear(t.getFullYear()+1),t.format("yyyy-MM-dd")},getStartTime:function(){var e=new Date,t=new Date(this.date);return t.getFullYear()>e.getFullYear()||t.getMonth()>e.getMonth()||t.getDate()>e.getDate()?"":e.format("hh:mm")},bindDateChange:function(e){this.date=e.target.value,this.time="",this.startTime=this.getStartTime()},bindTimeChange:function(e){this.date?this.time=e.target.value:this.error("请先选择上门日期")},error:function(e){i.showToast({title:e||"异常",icon:"none"})},validate:function(){var e=this;return e.content?e.resourceId?e.name?!(isNaN(e.phone)||e.phone<1e10||e.phone>19999999999)||(e.error("手机号码格式错误"),!1):(e.error("请输入您的姓名"),!1):(e.error("请选择报修位置"),!1):(e.error("请输入报事需求"),!1)},submit:function(){var e=this;if(i.showLoading({mask:!0}),e.validate()){var t=e.date+" "+e.time,n=i.getStorageSync(s.default.storageKeys.token);e.imgs.length>0?i.uploadFile({url:this.$config.apiWYBaseUrl+"/api/v2.0/weChat/repairs",filePath:e.imgs[0],name:"files",formData:{houseId:e.resourceId,customerName:e.name,appointmentTime:t,details:e.content,phone:e.phone,isReturn:!1,serviceSource:3},header:{Authorization:n.token_type+" "+n.access_token},success:function(t){i.hideLoading();var n=JSON.parse(t.data);n.success&&(e.clearInfomartion(),i.navigateTo({url:"../new-success/new-success"})),console.log(t.data)},fail:function(e){console.log(e),i.showToast({title:"创建失败，请重试",duration:1500,icon:"none"})}}):e.$http.request("/api/v2.0/weChat/repairs",{houseId:e.resourceId,customerName:e.name,appointmentTime:t,details:e.content,phone:e.phone,isReturn:!1,serviceSource:3},{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){i.hideLoading(),e.clearInfomartion(),i.navigateTo({url:"../new-success/new-success"})})).catch((function(e){console.log(res),i.showToast({title:"创建失败，请重试",duration:1500,icon:"none"})}))}},getFooterData:function(){var e=this;return(0,r.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$footerConfig.get();case 2:n=t.sent,e.footerData=n;case 4:case"end":return t.stop()}}),t)})))()},setDefaultCustomerInfo:function(){var e=this,t=this.isPublicArea;if(t){var n=i.getStorageSync(this.$config.storageKeys.user);this.name=n.customerName,this.phone=n.phoneNumber}else this.$http.get("/api/v2.0/weChat/user-resources/me").then((function(t){if(t&&1===t.length){var n=t[0],i=e.displayAddress(n,3);e.name=n.houseOwnerName,e.phone=n.houseOwnerPhone,e.resourceId=n.resourceId,e.repairArea=i}else e.name="",e.phone="",e.resourceId="",e.repairArea=""}))},displayAddress:function(e,t){return 1==t?(e.buildingName?e.buildingName:"")+(e.regionAddress?"/"+e.regionAddress:"")+(e.unitName?"/"+e.unitName:"")+(e.resourceCode?"/"+e.resourceCode:""):2==t?(e.regionName?e.regionName:"")+(e.groupName?"/"+e.groupName:"")+(e.buildingName?"/"+e.buildingName:"")+(e.unitName?"/"+e.unitName:""):3==t?(e.city?e.city:"")+(e.regionName?"/"+e.regionName:"")+(e.groupName?"/"+e.groupName:"")+(e.buildingName?"/"+e.buildingName:"")+(e.unitName?"/"+e.unitName:"")+(e.resourceCode?"/"+e.resourceCode:""):void 0},getstaticOssUrl:function(e){return e?this.$tool.image.getstaticOssUrl(e):""}}};t.default=c}).call(this,n("bc2e")["default"],n("543d")["default"])},bc52:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var i={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))},userPrivacy:function(){return n.e("components/userPrivacy/userPrivacy").then(n.bind(null,"594f"))}},o=function(){var e=this.$createElement,t=(this._self._c,this.imgs.length),n=this.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/7b77b4e20b024965a0dfbfee0c99daa6@new_address.svg"),i=this.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/e64bb061ed564352aa73f98fce669eaf@new_name.svg"),o=this.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/1b0b61cea54d4a7c928c1d366bed08bd@new_phone.svg"),a=this.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/11b6eeca5d8b430d93c7ae3a1f508eb9@new_time.svg"),r=this.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/11b6eeca5d8b430d93c7ae3a1f508eb9@new_time.svg");this.$mp.data=Object.assign({},{$root:{g0:t,m0:n,m1:i,m2:o,m3:a,m4:r}})},a=[]},e31d:function(e,t,n){"use strict";n.r(t);var i=n("bc52"),o=n("2c7f");for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("5f58");var r=n("f0c5"),s=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=s.exports}},[["1c81","common/runtime","common/vendor"]]]);