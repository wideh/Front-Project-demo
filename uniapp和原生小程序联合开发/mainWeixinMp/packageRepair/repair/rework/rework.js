require('../../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageRepair/repair/rework/rework"],{"2f83":function(e,t,n){"use strict";(function(e,a){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("2eee")),s=o(n("c973")),c=o(n("7504")),r={components:{uniSegmentedControl:function(){n.e("node-modules/@dcloudio/uni-ui/lib/uni-segmented-control/uni-segmented-control").then(function(){return resolve(n("3f52"))}.bind(null,n)).catch(n.oe)},uniIcons:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(n("1533"))}.bind(null,n)).catch(n.oe)},customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)},userPrivacy:function(){n.e("components/userPrivacy/userPrivacy").then(function(){return resolve(n("594f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{apiHeader:c.default.apiWYStaticResUrl,imgs:[],order:"",area:"",content:"",address:"",name:"",phone:"",textareaMaxLength:800,textareaWordCount:0,maxUploadImgLength:1,startDate:"",endDate:"",startTime:"",date:"",time:"",footerData:null,isReUploadImage:!1,showPrivacy:!1}},onLoad:function(t){var n=this;e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,t){n.showPrivacy=!0,n.resolvePrivacyAuthorization=e}));var a=this;a.startDate=a.getDate("start"),a.endDate=a.getDate("end"),a.startTime=a.getStartTime(),t&&t.id&&this.getDetailDataBy(t.id)},onShow:function(){this.getFooterData()},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},getDetailDataBy:function(e){var t=this;t.$http.get("/api/v2.0/weChat/repairs/".concat(e,"/isReturn")).then((function(e){e&&(console.log(e),t.phone=e.phone,t.content=e.detail,t.textareaWordCount=e.detail.length,t.order=e.voucherNo,t.area=e.areaStr,t.name=e.customerName,t.address=e.place,t.resourceId=e.organizationItemId,t.imgs=e.attachments)})).catch((function(e){console.log(e),a.showToast({title:e.message,icon:"none"})}))},descInput:function(){this.textareaWordCount=this.content.length},uploadImg:function(){var e=this,t=e.maxUploadImgLength-e.imgs.length;t>0&&a.chooseImage({count:t,sizeType:["original","compressed"],success:function(t){e.isReUploadImage=!0,e.imgs=e.imgs.concat(t.tempFilePaths)}})},actionSheetTap:function(e){var t=e,n=this;a.showActionSheet({itemList:["删除","预览"],success:function(e){if(console.log(e.tapIndex),0==e.tapIndex)n.deleteImg(t);else if(1==e.tapIndex){var o=[];n.isReUploadImage?o=n.imgs:n.imgs.forEach((function(e){o.push(n.$tool.image.getHttpUrl(e.url))})),console.log(o),a.previewImage({current:t,urls:o})}}})},onClickItem:function(e){this.current!==e&&(this.current=e)},deleteImg:function(e){this.imgs.splice(e,1)},getDate:function(e){var t=new Date;return"end"===e&&t.setFullYear(t.getFullYear()+1),t.format("yyyy-MM-dd")},getStartTime:function(){var e=new Date,t=new Date(this.date);return t.getFullYear()>e.getFullYear()||t.getMonth()>e.getMonth()||t.getDate()>e.getDate()?"":e.format("hh:mm")},bindDateChange:function(e){this.date=e.target.value,this.time="",this.startTime=this.getStartTime()},bindTimeChange:function(e){this.time=e.target.value},validate:function(){return""!=this.date||""!=this.time||(a.showToast({title:"请先选择上门时间",icon:"none"}),!1)},submit:function(){var e=this,t=this;if(t.validate()){var n=t.date+" "+t.time,o=a.getStorageSync(c.default.storageKeys.token);if(a.showLoading({mask:!0}),t.imgs.length>0){var i="";i=t.isReUploadImage?t.imgs[0]:t.$tool.image.getHttpUrl(t.imgs[0].url),a.getImageInfo({src:i,success:function(i){a.uploadFile({url:e.$config.apiWYBaseUrl+"/api/v2.0/weChat/repairs",filePath:i.path,name:"files",formData:{houseId:t.resourceId,customerName:t.name,appointmentTime:n,details:t.content,phone:t.phone,isReturn:!1,serviceSource:3},header:{Authorization:o.token_type+" "+o.access_token},success:function(e){a.hideLoading();var t=JSON.parse(e.data);t.success&&a.navigateTo({url:"../rework-success/rework-success?delta=2"}),console.log(e.data)},fail:function(e){console.log(e),a.showToast({title:"创建失败，请重试",duration:1500})}})}})}else t.$http.request("/api/v2.0/weChat/repairs",{houseId:t.resourceId,customerName:t.name,appointmentTime:n,details:t.content,phone:t.phone,isReturn:!1,serviceSource:3},{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){a.hideLoading(),a.navigateTo({url:"../rework-success/rework-success?delta=2"})})).catch((function(e){console.log(e),a.showToast({title:"创建失败，请重试",duration:1500,icon:"none"})}))}},getFooterData:function(){var e=this;return(0,s.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$footerConfig.get();case 2:n=t.sent,e.footerData=n;case 4:case"end":return t.stop()}}),t)})))()},getstaticOssUrl:function(e){return e?this.$tool.image.getstaticOssUrl(e):""}}};t.default=r}).call(this,n("bc2e")["default"],n("543d")["default"])},"45a7":function(e,t,n){"use strict";n.r(t);var a=n("4922"),o=n("fc49");for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("4fa5");var s=n("f0c5"),c=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=c.exports},4922:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var a={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))},userPrivacy:function(){return n.e("components/userPrivacy/userPrivacy").then(n.bind(null,"594f"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.imgs.length),a=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/e64bb061ed564352aa73f98fce669eaf@new_name.svg"),o=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/e64bb061ed564352aa73f98fce669eaf@new_name.svg"),i=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/7b77b4e20b024965a0dfbfee0c99daa6@new_address.svg"),s=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/e64bb061ed564352aa73f98fce669eaf@new_name.svg"),c=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/1b0b61cea54d4a7c928c1d366bed08bd@new_phone.svg"),r=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/11b6eeca5d8b430d93c7ae3a1f508eb9@new_time.svg"),u=e.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/11b6eeca5d8b430d93c7ae3a1f508eb9@new_time.svg");e.$mp.data=Object.assign({},{$root:{g0:n,m0:a,m1:o,m2:i,m3:s,m4:c,m5:r,m6:u}})},i=[]},"4fa5":function(e,t,n){"use strict";var a=n("75aa"),o=n.n(a);o.a},"75aa":function(e,t,n){},"911a":function(e,t,n){"use strict";(function(e,t){var a=n("4ea4");n("895d");a(n("66fd"));var o=a(n("45a7"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},fc49:function(e,t,n){"use strict";n.r(t);var a=n("2f83"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a}},[["911a","common/runtime","common/vendor"]]]);