(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageVisitor/visitor/add/add"],{"0276":function(e,t,o){"use strict";var r=o("d4ff"),n=o.n(r);n.a},"22fc":function(e,t,o){"use strict";(function(e,r){var n=o("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(o("2eee")),s=n(o("c973")),a=n(o("9523")),c=(n(o("2f31")),n(o("7504")));function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){(0,a.default)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var d={components:{uniIcons:function(){Promise.all([o.e("common/vendor"),o.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(o("1533"))}.bind(null,o)).catch(o.oe)},uniNumberBox:function(){o.e("node-modules/@dcloudio/uni-ui/lib/uni-number-box/uni-number-box").then(function(){return resolve(o("ed58"))}.bind(null,o)).catch(o.oe)},uniPopup:function(){o.e("node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup").then(function(){return resolve(o("9730"))}.bind(null,o)).catch(o.oe)},customFooter:function(){o.e("components/custom-footer/custom-footer").then(function(){return resolve(o("7d39"))}.bind(null,o)).catch(o.oe)},userPrivacy:function(){o.e("components/userPrivacy/userPrivacy").then(function(){return resolve(o("594f"))}.bind(null,o)).catch(o.oe)}},data:function(){return{name:"",telephone:"",resource:{},count:1,reason:{},time:"",date:"",startDate:"",endDate:"",reasonList:[],show:!1,footerData:null,timeList:[],cardTypeId:"",cardTypeStr:"",cardTypeList:["居民身份证"],IDCardNo:"",companyId:"",companyStr:"",companyList:[],imgUrl:"",isCanApproval:!1,companyOrCustomerList:[],roomList:[],customerType:"",showPrivacy:!1}},onLoad:function(){var t=this;e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,o){t.showPrivacy=!0,t.resolvePrivacyAuthorization=e})),r.removeStorageSync(this.$config.storageKeys.resource);var o=this;o.startDate=o.getDate("start"),o.endDate=o.getDate("end"),o.startTime=o.getStartTime(),o.$http.get("/api/v2.0/wechat/enum-visit-causes").then((function(e){o.reasonList=e})).catch((function(e){console.log(e)})),o.$httpVisitor.get("/visitation/should_approval").then((function(e){if(e&&e.success){var t=e.result;t&&t.newVisitor?o.isCanApproval=!0:(o.isCanApproval=!1,r.showModal({title:"审批禁用提醒",content:"本功能需要办公审批中的访客申请流程支持。当前此流程被禁用，请联系物业处理。",showCancel:!1,success:function(e){}}))}else o.isCanApproval=!1,r.showModal({title:"审批禁用提醒",content:"本功能需要办公审批中的访客申请流程支持。当前此流程被禁用，请联系物业处理。",showCancel:!1,success:function(e){}})})).catch((function(e){o.isCanApproval=!1,r.showModal({title:"审批禁用提醒",content:"本功能需要办公审批中的访客申请流程支持。当前此流程被禁用，请联系物业处理。",showCancel:!1,success:function(e){}}),console.log(e)}))},onShow:function(){var e=this;this.getFooterData();for(var t=r.getStorageSync(this.$config.storageKeys.resource),o=0;o<24;o++)o>9?this.timeList.push({id:o+"",text:o+"",label:o+"时"}):this.timeList.push({id:o+"",text:"0"+o,label:"0"+o+"时"});if(t)this.resource=t,console.log(t),this.$http.get("/api/v1.0/PropertyMgmt/BasicResourceManagement/House/Detail/".concat(t.resourceId)).then((function(t){e.resource=h(h(h({},e.resource),t),{},{resourceId:t.id}),e.$http.get("/api/v1.0/PROP/houseTenant/currentListByHouse?houseId=".concat(t.id)).then((function(t){e.companyOrCustomerList=t,t&&t.length>0&&(e.companyId=t[0].customerId,e.companyStr=t[0].customerName,e.customerType=t[0].customerType)}))}));else{var n=r.getStorageSync(this.$config.storageKeys.user);n&&n.defaultHouseResourceId&&(this.resource={resourceId:n.defaultHouseResourceId,text:n.defaultHouseResourceName},this.$http.get("/api/v1.0/PropertyMgmt/BasicResourceManagement/House/Detail/".concat(n.defaultHouseResourceId)).then((function(t){e.resource=h(h(h({},e.resource),t),{},{resourceId:t.id}),e.$http.get("/api/v1.0/PROP/houseTenant/currentListByHouse?houseId=".concat(t.id)).then((function(t){e.companyOrCustomerList=t,t&&t.length>0&&(e.companyId=t[0].customerId,e.companyStr=t[0].customerName,e.customerType=t[0].customerType)}))})))}this.getRoomList()},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},error:function(e){r.hideLoading(),r.showToast({icon:"none",title:e||"系统繁忙，请稍候重试",duration:2500})},getDate:function(e){var t=new Date;return"end"===e&&t.setFullYear(t.getFullYear()+1),t.format("yyyy-MM-dd")},getRoomList:function(){var e=this;this.$http.get("/api/v2.0/weChat/user-resources/house",{page:1,pageSize:999}).then((function(t){t.data.map((function(e){return e.text=(e.regionName?e.regionName+"/":"")+(e.groupName?e.groupName+"/":"")+(e.buildingName?e.buildingName+"/":"")+(e.unitName?e.unitName+"/":"")+(e.resourceCode||""),e}));e.roomList=t.data})).catch((function(e){console.log(e.Message)}))},roomListChange:function(e){var t=this,o=this.roomList[e.target.value];this.resource={resourceId:o.resourceId,text:o.text},o.resourceId&&this.$http.get("/api/v1.0/PropertyMgmt/BasicResourceManagement/House/Detail/".concat(o.resourceId)).then((function(e){t.resource=h(h(h({},t.resource),e),{},{resourceId:e.id}),t.$http.get("/api/v1.0/PROP/houseTenant/currentListByHouse?houseId=".concat(e.id)).then((function(e){t.companyOrCustomerList=e,e&&e.length>0&&(t.companyId=e[0].customerId,t.companyStr=e[0].customerName,t.customerType=e[0].customerType)}))}))},resetFileds:function(){var e=this;e.name="",e.telephone="",e.count=1,e.reason={},e.resource={},e.date="",e.time="",e.cardTypeId="",e.cardTypeStr="",e.IDCardNo="",e.imgUrl="",e.companyId="",e.companyStr="",e.customerType=""},uploadImg:function(){var e=this,t=["img","jpg","png","gif","jpeg","BMP","svg","TIFF","bmp","JPG","JPEG","GIF","PNG","IMG","SVG"];r.chooseImage({count:1,sizeType:["original","compressed"],success:function(o){var n;console.log("选取图片路径",o.tempFiles[0].path),console.log("选取图片大小",o.tempFiles[0].size);var i=o.tempFiles[0].path;if(-1!==t.indexOf(i.split(".")[(null===(n=i.split("."))||void 0===n?void 0:n.length)-1]))if(o.tempFiles[0].size>2097152)e.error("上传文件大小不得超过2M！");else{e.fileName=i.substring(i.lastIndexOf("/")+1);var s=r.getStorageSync(c.default.storageKeys.token);r.uploadFile({url:e.$config.apiBaseUrl+"/hfle/v1/files/multipart",filePath:o.tempFilePaths[0],name:"file",formData:{filename:e.fileName,bucketName:"public",directory:"hpfm05"},header:{"Content-Type":"multipart/form-data",Authorization:s.token_type+" "+s.access_token},success:function(t){console.log("上传图片",t.data),e.imgUrl=t.data},fail:function(t){return e.error("上传图片失败，请重新上传"),!1}})}else{var a="只能上传".concat(t.map((function(e){return".".concat(e)})).join(","),"类型图片!");e.error(a)}}})},actionSheetTap:function(e){r.previewImage({current:0,urls:[this.imgUrl]})},cardTypeChange:function(e){this.cardTypeId=e.target.value,this.cardTypeStr=this.cardTypeList[e.target.value],this.IDCardNo=""},deleteCardType:function(){this.cardTypeId="",this.cardTypeStr="",this.IDCardNo=""},companyChange:function(e){this.companyId=this.companyOrCustomerList[e.target.value].customerId,this.companyStr=this.companyOrCustomerList[e.target.value].customerName,this.customerType=this.companyOrCustomerList[e.target.value].customerType},onResourceClick:function(){r.navigateTo({url:"pages/me/select/room-and-parking/room-and-parking?selectType=room"})},onCountNumBoxChange:function(e){this.count=e},onReasonChange:function(e){this.reason=this.reasonList[1*e.detail.value]},onTimeChange:function(e){this.time=this.timeList[1*e.detail.value]},getStartTime:function(){var e=new Date,t=new Date(this.date);return t.getFullYear()>e.getFullYear()||t.getMonth()>e.getMonth()||t.getDate()>e.getDate()?"":e.format("hh:mm")},bindDateChange:function(e){this.date=e.target.value,this.time="",this.startTime=this.getStartTime()},toEnsureinvite:function(){if(this.companyStr)if(this.name){if(this.telephone){return/^(((0\d{2,3}-)?\d{7,8})|(1\d{10}))$/gi.test(this.telephone)?"单位"!=this.customerType||this.cardTypeStr?this.cardTypeStr&&!this.IDCardNo?(this.error("请输入访客证件号码"),!1):this.count?void(this.time&&!this.time.text||!this.time?this.error("截止时间不能为空"):this.date?new Date(this.$tool.date.format(new Date,"yyyy-MM-dd")).getTime()>new Date(this.date).getTime()?this.error("截止日期不能小于当天"):this.date===this.$tool.date.format(new Date,"yyyy-MM-dd")&&new Date(this.date+" "+this.time.text+":00:00").getHours()<(new Date).getHours()?this.error("来访截止时间不能小于当前时间"):this.$refs.popup.open():this.error("截止日期不能为空")):(this.error("请输入来访人数"),!1):(this.error("请选择访客证件类型"),!1):(this.error("手机号码格式错误"),!1)}this.error("输入访客联系电话")}else this.error("输入访客姓名");else this.error("请选择被访客户/单位")},alertCancel:function(e){e||this.onInviteBtnClick(),this.$refs.popup.close()},onInviteBtnClick:function(){r.showLoading({mask:!0,title:"邀请中"});var e=r.getStorageSync(this.$config.storageKeys.openId);if(this.resource&&this.resource.resourceId){this.$tool.date.format(new Date,"yyyy-MM-dd"),(new Date).getHours();var t=this;this.$httpVisitor.post("/visitation/save",{regionId:this.resource.regionId,type:1,customerId:this.companyId,resourceId:this.resource.resourceId,customerName:this.companyStr,visitorName:this.name,visitorPhone:this.telephone,visitorNum:this.count,visitorReason:this.reason.text,visitorIdType:""!==this.cardTypeId?this.cardTypeId:void 0,visitorIdNo:this.IDCardNo,visitorPhoto:this.imgUrl,endDate:this.date+" "+this.time.text+":00:00",openId:e}).then((function(e){e&&e.success?(r.hideLoading(),r.navigateTo({url:"../item/item?visitorId=".concat(e.result)}),t.resetFileds()):t.error(e.message||"邀请失败")})).catch((function(e){console.log(e),t.error(e.message)}))}else this.error("还没有选择房间")},onListBtnClick:function(){this.resource&&this.resource.resourceId?(r.navigateTo({url:"../list/list?customerId="+this.resource.customerId}),this.resetFileds()):this.error("还没有选择房间")},getFooterData:function(){var e=this;return(0,s.default)(i.default.mark((function t(){var o;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$footerConfig.get();case 2:o=t.sent,e.footerData=o;case 4:case"end":return t.stop()}}),t)})))()},getstaticOssUrl:function(e){return e?this.$tool.image.getstaticOssUrl(e):""}}};t.default=d}).call(this,o("bc2e")["default"],o("543d")["default"])},"3a0e":function(e,t,o){"use strict";o.r(t);var r=o("fc63"),n=o("7765");for(var i in n)["default"].indexOf(i)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(i);o("0276");var s=o("f0c5"),a=Object(s["a"])(n["default"],r["b"],r["c"],!1,null,"6bb016ce",null,!1,r["a"],void 0);t["default"]=a.exports},7765:function(e,t,o){"use strict";o.r(t);var r=o("22fc"),n=o.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){o.d(t,e,(function(){return r[e]}))}(i);t["default"]=n.a},d4ff:function(e,t,o){},efd8:function(e,t,o){"use strict";(function(e,t){var r=o("4ea4");o("895d");r(o("66fd"));var n=r(o("3a0e"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(n.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},fc63:function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return r}));var r={uniIcons:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(o.bind(null,"cff5"))},userPrivacy:function(){return o.e("components/userPrivacy/userPrivacy").then(o.bind(null,"594f"))}},n=function(){var e=this.$createElement,t=(this._self._c,this.roomList&&this.roomList.length>1);this.$mp.data=Object.assign({},{$root:{g0:t}})},i=[]}},[["efd8","common/runtime","common/vendor"]]]);