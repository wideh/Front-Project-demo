(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageWM/paywhite/paywhite"],{"5a4e":function(e,t,r){"use strict";r.r(t);var a=r("d3aa"),o=r.n(a);for(var n in a)["default"].indexOf(n)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(n);t["default"]=o.a},"604a":function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){}));var a=function(){var e=this.$createElement;this._self._c},o=[]},bc85:function(e,t,r){"use strict";r.r(t);var a=r("604a"),o=r("5a4e");for(var n in o)["default"].indexOf(n)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(n);var s=r("f0c5"),c=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);t["default"]=c.exports},c8dd:function(e,t,r){"use strict";(function(e,t){var a=r("4ea4");r("895d");a(r("66fd"));var o=a(r("bc85"));e.__webpack_require_UNI_MP_PLUGIN__=r,t(o.default)}).call(this,r("bc2e")["default"],r("543d")["createPage"])},d3aa:function(e,t,r){"use strict";(function(e){var a=r("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(r("2eee")),n=a(r("9523")),s=a(r("c973")),c=a(r("7504"));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var i={data:function(){return{params:{tenantId:c.default.tenantId,appCode:"",channelCode:"",goodsList:[],orderDescribe:"",goodsTotalFee:null,sourceBiz:"NOVA_MAIL",bizOrderNo:"",bizNotifyUrl:"",userName:""},opt:null,payGuid:""}},onLoad:function(e){this.opt=e,this.payGuid=e.payGuid||"",this.getOrderDetailNew(e.orderNumbers),this.getAppCode()},methods:{getAppCode:function(){var t=this;return(0,s.default)(o.default.mark((function r(){var a,n;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=t,n=e.getStorageSync("token"),e.request({url:c.default.apiBaseUrl+"/iam/hzero/v1/users/self",method:"get",header:{Authorization:n.token_type+" "+n.access_token},success:function(t){if(t.data&&t.data.tenantId){var r=t.data,o=r.tenantName,s=r.tenantId;e.request({url:c.default.apiBaseUrl+"/npay/v1/app/page",method:"get",data:{__tenantName:o,tenantName:o,tenantId:s,page:1,size:1},header:{Authorization:n.token_type+" "+n.access_token},success:function(e){200===e.statusCode&&e.data&&e.data.totalElements>0&&(a.params.appCode=e.data.content[0].appCode)}})}},fail:function(){}});case 3:case"end":return r.stop()}}),r)})))()},getOrderDetailNew:function(t){var r=this;return(0,s.default)(o.default.mark((function a(){var n;return o.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=r,r.$httpHd.get("/nova-mall-api/p/myOrder/orderDetailList?orderNumbers="+t).then(function(){var e=(0,s.default)(o.default.mark((function e(t){var r,a,s,c;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("orderNumbersdetail",t),r="",a=0,s=t[0].userAddrDto.receiver,c=[],t.map((function(e){a+=e.actualTotal,e.orderItemDtos.map((function(e){r+=e.prodName,c.push({goodsName:e.prodName,goodsCode:e.prodId,goodsFee:100*e.price,goodsCount:e.prodCount})}))})),n.params=d(d({},n.params),{},{goodsList:c,goodsTotalFee:100*a,userName:s,orderDescribe:r.slice(0,127)}),e.next=9,n.toNovaPay(n.opt.orderNumbers,n.opt.orderType);case 9:console.log("params",n.params);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){e.showToast({title:"支付请求失败",icon:"error"})}));case 2:case"end":return a.stop()}}),a)})))()},getOrderDetail:function(t){var r=this;return(0,s.default)(o.default.mark((function a(){var n;return o.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=r,r.$httpHd.get("/nova-mall-api/p/myOrder/orderDetail?orderNumber="+t).then((function(e){console.log("orderNumbersdetail",e);var t="",r=e.orderItemDtos.map((function(e){return t+=e.prodName,{goodsName:e.prodName,goodsCode:e.prodId,goodsFee:100*e.price,goodsCount:e.prodCount}}));n.params=d(d({},n.params),{},{goodsList:r,goodsTotalFee:100*e.actualTotal,userName:e.userAddrDto.receiver,orderDescribe:t.slice(0,40)}),n.toNovaPay(n.opt.orderNumbers,n.opt.orderType),console.log("params",n.params)})).catch((function(){e.showToast({title:"支付请求失败",icon:"error"})}));case 2:case"end":return a.stop()}}),a)})))()},toNovaPay:function(t,r){var a=this;return(0,s.default)(o.default.mark((function r(){var n;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=a,a.$httpOrder.post("/p/order/before/pay",{payType:1,orderNumbers:t,openId:e.getStorageSync("openId")}).then(function(){var e=(0,s.default)(o.default.mark((function e(t){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n.params=d(d({},n.params),{},{channelCode:n.getCodeByType(t.payType),bizNotifyUrl:c.default.apiOrderBaseUrl+t.apiNoticeUrl,bizOrderNo:t.payNo}),e.next=3,n.handePay();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){e.showToast({title:"支付请求失败",icon:"error"})}));case 2:case"end":return r.stop()}}),r)})))()},handePay:function(){var t=this;return(0,s.default)(o.default.mark((function r(){var a;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=t,t.$httpHd.post("/npay/v1/unifiedOrder",a.params).then((function(r){console.log(r,"sssssssssssssssssss"),e.requestPayment({timeStamp:r.params.timeStamp,nonceStr:r.params.nonceStr,package:r.params.package,signType:r.params.signType,paySign:r.params.paySign,success:function(e){console.log("eeeeeeeeeeeeee",e),t.saveOrderNo(r.goodsOrder.bizOrderNo,r.goodsOrder.orderNo)},fail:function(t){var r=encodeURIComponent("sts=0&orderNumbers=".concat(a.opt.orderNumbers,"&orderType=").concat(a.opt.orderType));e.redirectTo({url:"/packageWM/pay-result-webview/pay-result-webview?result=2&params=".concat(r)})}})})).catch((function(){}));case 2:case"end":return r.stop()}}),r)})))()},saveOrderNo:function(t,r){var a=this;return(0,s.default)(o.default.mark((function n(){var s;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:s=a,console.log("_this.payGuid",s.payGuid),a.$httpOrder.post("/p/order/pay/success/".concat(s.payGuid,"/savePayOrderNoByPayGuid/").concat(t,"/").concat(r)).then((function(t){console.log("保存汉得的订单号到数据库",t);var r=encodeURIComponent("sts=1&orderNumbers=".concat(s.opt.orderNumbers,"&orderType=").concat(s.opt.orderType));e.redirectTo({url:"/packageWM/pay-result-webview/pay-result-webview?result=1&params=".concat(r)})})).catch((function(){var t=encodeURIComponent("sts=0&orderNumbers=".concat(s.opt.orderNumbers,"&orderType=").concat(s.opt.orderType));e.redirectTo({url:"/packageWM/pay-result-webview/pay-result-webview?result=2&params=".concat(t)})}));case 3:case"end":return o.stop()}}),n)})))()},getCodeByType:function(e){return 1==e?"WECHAT_MP":2==e?"ALIPAY_WAP":void 0},toPay:function(t,r){this.$httpOrder.post("/p/order/pay",{payType:1,orderNumbers:t,openId:e.getStorageSync("openId")}).then((function(a){e.requestPayment({timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.packageValue,signType:a.signType,paySign:a.paySign,success:function(a){var o=encodeURIComponent("sts=1&orderNumbers=".concat(t,"&orderType=").concat(r));e.redirectTo({url:"/packageWM/pay-result-webview/pay-result-webview?result=1&params=".concat(o)})},fail:function(a){var o=encodeURIComponent("sts=0&orderNumbers=".concat(t,"&orderType=").concat(r));e.redirectTo({url:"/packageWM/pay-result-webview/pay-result-webview?result=2&params=".concat(o)})}})}))}}};t.default=i}).call(this,r("543d")["default"])}},[["c8dd","common/runtime","common/vendor"]]]);