(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["packageWM/sale-activity/sale-activity-detail"],{"0449":function(t,n,i){"use strict";var o=i("26bc"),e=i.n(o);e.a},"26bc":function(t,n,i){},"59de":function(t,n,i){"use strict";i.r(n);var o=i("aa31"),e=i.n(o);for(var s in o)["default"].indexOf(s)<0&&function(t){i.d(n,t,(function(){return o[t]}))}(s);n["default"]=e.a},"81ad":function(t,n,i){"use strict";i.r(n);var o=i("c41d"),e=i("59de");for(var s in e)["default"].indexOf(s)<0&&function(t){i.d(n,t,(function(){return e[t]}))}(s);i("0449");var a=i("f0c5"),c=Object(a["a"])(e["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=c.exports},"88d6":function(t,n,i){"use strict";(function(t,n){var o=i("4ea4");i("895d");o(i("66fd"));var e=o(i("81ad"));t.__webpack_require_UNI_MP_PLUGIN__=i,n(e.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},aa31:function(t,n,i){"use strict";(function(t,o){var e=i("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e(i("2eee")),a=e(i("c973")),c={data:function(){return{activityId:null,type:0,skip:0,take:10,dishesTypes:[],dishes:[],totalAmount:0,featch:!0,selectedDishes:[],phoneNumber:"",computedNum:[],Bookings:[],nickNames:"",RealBookings:[],footerData:null}},onLoad:function(n){this.activityId=n.activityId,this.onClickSearch(this.type),this.phoneNumber=t.getStorageSync("phoneNumber")},onPullDownRefresh:function(){this.dishes=[],this.onClickSearch(),o.stopPullDownRefresh()},onReachBottom:function(){this.featch&&(this.skip+=10,this.onClickSearch())},onShow:function(){this.getFooterData()},methods:{getFooterData:function(){var t=this;return(0,a.default)(s.default.mark((function n(){var i;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.$footerConfig.get();case 2:i=n.sent,t.footerData=i;case 4:case"end":return n.stop()}}),n)})))()},onClickSearch:function(){var n=this;this.$http.get("/api/v2.0/WeChat/Campaigns/".concat(n.activityId,"/Dishes?dishesTypeId=").concat(n.type,"&skip=").concat(n.skip,"&take=").concat(n.take)).then((function(i){i.data.dishes.length<n.take&&(n.featch=!1),n.dishesTypes=i.data.dishesTypes;var o=n.dishes.concat(i.data.dishes),e={},s=o.reduce((function(t,n){return!e[n.cmpaignDishesId]&&(e[n.cmpaignDishesId]=t.push(n)),t}),[]);n.dishes=s,t.hideNavigationBarLoading()})).catch((function(){t.hideNavigationBarLoading()}))},onChangeType:function(t){var n,i=this;this.dishes.forEach((function(t){if(i.computedNum[t.dishesInfoId]>0){var n={campaignDishesId:t.cmpaignDishesId,quantity:t.count};i.Bookings.push(n)}})),n=this.Bookings,this.type=t,this.skip=0,this.dishes=[],this.onClickSearch(),this.Bookings=n,console.log("检查数组"),console.log(this.Bookings)},addOrDecNum:function(t,n,i){var o=this;for(var e in this.dishes.forEach((function(n){n.dishesInfoId==t&&(o.totalAmount+=i)})),this.computedNum[t]=n,this.dishes){var s=this.dishes[e];s.dishesInfoId==t&&(this.dishes[e].count=n,this.RealBookings[t]={count:n,campaignDishesId:s.cmpaignDishesId})}},userInfo:function(){var n=this;this.dishes.forEach((function(t){if(n.computedNum[t.dishesInfoId]>0){var i={campaignDishesId:t.cmpaignDishesId,quantity:t.count};n.Bookings.push(i)}}));var i=t.getStorageSync("phoneNumber"),o=this.Bookings;t.showModal({content:"确认要提交您的订单吗?",success:function(e){e.confirm&&n.$http.post("/api/v2.0/WeChat/Bookings",{bookings:o,phoneNum:i}).then((function(i){var e=JSON.stringify(o);t.navigateTo({url:"./sale-activity-order?totalAmount="+n.totalAmount+"&bookings="+e+"&activityId="+n.activityId}),n.computedNum=[],n.Bookings=[],n.totalAmount=0})).catch((function(i){t.showModal({title:"提示",content:"".concat(i.message),success:function(t){}}),n.computedNum=[],n.Bookings=[],n.totalAmount=0}))}})},submit:function(){var n=this;if(0!=this.totalAmount){this.Bookings=[],this.RealBookings.forEach((function(t){if(t.count>0){var i={campaignDishesId:t.campaignDishesId,quantity:t.count};n.Bookings.push(i)}}));var i=this.Bookings,o=JSON.stringify(i);t.navigateTo({url:"./sale-activity-order?totalAmount="+this.totalAmount+"&bookings="+o+"&activityId="+this.activityId}),this.computedNum=[],this.Bookings=[],this.totalAmount=0,this.RealBookings=[]}else t.showModal({content:"请选择商品后再提交"})}},components:{saleActivityDetailList:function(){i.e("packageWM/components/sale-activity/sale-activity-detal-list").then(function(){return resolve(i("a189"))}.bind(null,i)).catch(i.oe)},returnHome:function(){i.e("components/return-home/return-home").then(function(){return resolve(i("4821"))}.bind(null,i)).catch(i.oe)},customFooter:function(){i.e("components/custom-footer/custom-footer").then(function(){return resolve(i("7d39"))}.bind(null,i)).catch(i.oe)}}};n.default=c}).call(this,i("543d")["default"],i("bc2e")["default"])},c41d:function(t,n,i){"use strict";i.d(n,"b",(function(){return o})),i.d(n,"c",(function(){return e})),i.d(n,"a",(function(){}));var o=function(){var t=this.$createElement,n=(this._self._c,this.totalAmount.toFixed(2));this.$mp.data=Object.assign({},{$root:{g0:n}})},e=[]}},[["88d6","common/runtime","common/vendor"]]]);