(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bill/empty-pay"],{1600:function(t,e,n){"use strict";(function(t,e){var a=n("4ea4");n("895d");a(n("66fd"));var o=a(n("3164"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},3164:function(t,e,n){"use strict";n.r(e);var a=n("e5d1"),o=n("3c24");for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);n("55cd");var s=n("f0c5"),c=Object(s["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],void 0);e["default"]=c.exports},"3bb0":function(t,e,n){},"3c24":function(t,e,n){"use strict";n.r(e);var a=n("79c4"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=o.a},"55cd":function(t,e,n){"use strict";var a=n("3bb0"),o=n.n(a);o.a},"79c4":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={data:function(){return{payStr:"",motto:"等待支付中...",wechat:"fail",isShow:!1,imagePath:""}},onLoad:function(e){t.showLoading({title:"数据加载中",mask:!0});if(e&&e.payStr){this.payStr=e.payStr;var n=t.getStorageSync(this.$config.storageKeys.token);n?this.init():setTimeout(this.init,2500)}else this.showPayFailed("跳转微信小程序缴费失败。参数有误")},methods:{init:function(){var e=this,n=e.$config;t.login({provider:"weixin",success:function(a){console.log("微信获取code",a),t.request({url:n.apiBaseUrl+"/api/v2.0/wechat-mini-program-oauth/callback",data:{code:a.code},success:function(a){if(null!=a.data&&null!=a.data.access_token){t.setStorageSync(n.storageKeys.token,a.data);var o=new Date;o.setDate(o.getDate()+6),t.setStorageSync(n.storageKeys.expires,o.getTime()),console.log("微信登录成功"),e.toPayMoney()}else console.log("then 微信登录失败"),e.showPayFailed("支付跳转失败..")},fail:function(){console.log("fail 微信登录失败"),e.showPayFailed("支付跳转失败...")}})}})},toPayMoney:function(){var e=this,n=JSON.parse(decodeURIComponent(e.payStr));e.$http.post("/api/v2.0/weChat/unified-orders/h5-app",n).then((function(n){console.log("下单返回>>",n);var a=JSON.parse(n.jsPayParameter);t.requestPayment({provider:"wxpay",timeStamp:a.timeStamp,nonceStr:a.nonceStr,package:a.package,signType:a.signType,paySign:a.paySign,success:function(t){e.showPaySuccess()},fail:function(t){console.log("支付失败>>",t),e.showPayFailed("支付失败");var a=n.outTradeNo;e.$http.request("/api/v2.0/weChat/unified-orders/".concat(a,"/cancelOrder"),null,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"PUT"}).then((function(){}))}})})).catch((function(t){console.log("下单失败>>",t),e.showPayFailed(t.message)}))},showPaySuccess:function(){t.hideLoading(),this.wechat="success",this.motto="支付成功",this.isShow=!0,this.imagePath="https://pms-statics.oss-cn-shenzhen.aliyuncs.com/wechat-static/success.png"},showPayFailed:function(e){t.hideLoading(),this.motto=e,this.isShow=!0,this.imagePath="https://pms-statics.oss-cn-shenzhen.aliyuncs.com/wechat-static/error.png"},launchAppError:function(t){console.log(t)},launchAppSuccess:function(t){console.log(t)}}};e.default=n}).call(this,n("543d")["default"])},e5d1:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){}));var a=function(){var t=this.$createElement;this._self._c},o=[]}},[["1600","common/runtime","common/vendor"]]]);