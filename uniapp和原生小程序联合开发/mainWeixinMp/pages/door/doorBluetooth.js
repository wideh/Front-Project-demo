(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/door/doorBluetooth"],{"0b29":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))},pageEmpty:function(){return n.e("components/page-empty/page-empty").then(n.bind(null,"1068"))},userPrivacy:function(){return n.e("components/userPrivacy/userPrivacy").then(n.bind(null,"594f"))}},i=function(){var t=this.$createElement;this._self._c},r=[]},"12dd":function(t,e,n){"use strict";var o=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("2eee")),r=o(n("c973")),s={components:{pageSuccess:function(){n.e("components/page-success/page-success").then(function(){return resolve(n("46e8"))}.bind(null,n)).catch(n.oe)},customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)}},prop:{isOpen:{type:Boolean,default:!1}},data:function(){return{footerData:null}},mounted:function(){this.getFooterData()},methods:{getFooterData:function(){var t=this;return(0,r.default)(i.default.mark((function e(){var n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$footerConfig.get();case 2:n=e.sent,t.footerData=n;case 4:case"end":return e.stop()}}),e)})))()},onBtnClick:function(){this.$emit("changeOpen",!1)}}};e.default=s},"14e4":function(t,e,n){"use strict";n.r(e);var o=n("5439"),i=n("eb51");for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);n("488e");var s=n("f0c5"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=c.exports},"21d9":function(t,e,n){},"488e":function(t,e,n){"use strict";var o=n("f7fc"),i=n.n(o);i.a},5439:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}));var o={pageSuccess:function(){return n.e("components/page-success/page-success").then(n.bind(null,"46e8"))}},i=function(){var t=this.$createElement;this._self._c},r=[]},c89a:function(t,e,n){"use strict";var o=n("21d9"),i=n.n(o);i.a},c9c4:function(t,e,n){"use strict";(function(t,o){var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(n("2eee")),s=i(n("c973")),c=i(n("3f26")),u=i(n("14e4")),a={components:{uniIcons:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(n("1533"))}.bind(null,n)).catch(n.oe)},pageEmpty:function(){n.e("components/page-empty/page-empty").then(function(){return resolve(n("1068"))}.bind(null,n)).catch(n.oe)},customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)},success:u.default,userPrivacy:function(){n.e("components/userPrivacy/userPrivacy").then(function(){return resolve(n("594f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{isLoading:!1,hasBluetoothAccess:!0,logText:"",community:{},user:{},deviceId:"",password:"",statusText:"正在开门...",errorText:"",footerData:null,isOpen:!1,showPrivacy:!1,hasPrivacy:!1}},computed:{hasLogin:function(){return this.user&&this.user.avatarUrl},hasRoom:function(){return this.user&&this.user.defaultHouseResourceId},displayTitle:function(){return this.errorText?"开门失败，请重试":this.isLoading?"正在开门...":"点击开门"},displayNote:function(){return this.errorText?this.errorText:(this.isLoading,"请靠近需要开启的通闸或门禁")},errorTitle:function(){return this.hasLogin?this.hasRoom?this.hasBluetoothAccess?"":"还没有打开蓝牙":"您的名下暂无房间":"还没登录"},errorNote:function(){return this.hasLogin?this.hasRoom?this.hasBluetoothAccess?"":"请先去手机设置中打开蓝牙":"请先去添加您的房间吧":"请先去授权登录吧"},errorButtonText:function(){return this.hasLogin?this.hasRoom?"":"去添加":"去登录"}},mounted:function(){var e=this;this.isLoading=!1,this.community=t.getStorageSync(this.$config.storageKeys.community),this.getFooterData(),this.hasBluetoothAccess=!0,this.logText="",this.user=t.getStorageSync(this.$config.storageKeys.user),this.errorText="";setTimeout((function(){o.getPrivacySetting&&o.getPrivacySetting({success:function(t){t.needAuthorization?(e.showPrivacy=!0,e.hasPrivacy=!1):(e.showPrivacy=!1,e.hasPrivacy=!0,e.open())},fail:function(){},complete:function(){}})}),200)},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.hasPrivacy=!0,this.open()},disagreePrivacy:function(){this.hasPrivacy=!1,this.showPrivacy=!1},addLog:function(t){console.log("【开门】"+t)},goToDescription:function(){t.navigateTo({url:"description/description"})},onButtonClick:function(){this.hasLogin?this.hasRoom||t.navigateTo({url:"../me/room/room"}):t.navigateTo({url:"../login/weixin/weixin"})},error:function(t){this.isLoading=!1,this.errorText=t},changeOpen:function(t){this.isOpen=t,this.$emit("change",!1)},open:function(){if(this.hasPrivacy){var t=this;t.isLoading=!0,t.errorText="",this.hasRoom&&(t.addLog("开始扫描"),c.default.scanDevices((function(e){if(t.addLog("扫描回调返回的参数: "+JSON.stringify(e)),!e.isBluetoothAvailable)return t.hasBluetoothAccess=!1,void t.addLog("蓝牙不可用");var n=e.scanList;if(t.addLog("蓝牙设备列表: "+JSON.stringify(n)),n&&n.length>0){var o=n[0].deviceId,i=n[0].name;t.addLog("取第一个设备的deviceId: "+o),t.addLog("取第一个设备的name: "+i),t.addLog("开始获取密码"),t.$httpVisitor.get("/openDoor/bluetooth",{devSn:i}).then((function(e){t.addLog("成功回调："+JSON.stringify(e)),e&&e.data&&e.data.miniEkey&&(t.addLog("开始开门"),c.default.openDoor(o,e.data.miniEkey,(function(e){t.addLog("成功回调："+JSON.stringify(e)),0===e.errCode||10008===e.errCode?(t.addLog("开门成功"),t.isOpen=!0):t.error("错误代码："+e.errCode)})))})).catch((function(e){t.addLog("失败回调："+JSON.stringify(e))}))}else t.error("没找到门禁设备")})))}else this.showPrivacy=!0},getFooterData:function(){var t=this;return(0,s.default)(r.default.mark((function e(){var n;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$footerConfig.get();case 2:n=e.sent,t.footerData=n;case 4:case"end":return e.stop()}}),e)})))()}}};e.default=a}).call(this,n("543d")["default"],n("bc2e")["default"])},eb51:function(t,e,n){"use strict";n.r(e);var o=n("12dd"),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=i.a},f1e0:function(t,e,n){"use strict";n.r(e);var o=n("0b29"),i=n("f95b8");for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);n("c89a");var s=n("f0c5"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=c.exports},f7fc:function(t,e,n){},f95b8:function(t,e,n){"use strict";n.r(e);var o=n("c9c4"),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=i.a}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/door/doorBluetooth-create-component',
    {
        'pages/door/doorBluetooth-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("f1e0"))
        })
    },
    [['pages/door/doorBluetooth-create-component']]
]);
