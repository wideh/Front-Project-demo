(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/door/open/apply/apply"],{"101a":function(t,e,n){"use strict";n.r(e);var o=n("cbec"),s=n("7856");for(var i in s)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(i);n("d429");var a=n("f0c5"),r=Object(a["a"])(s["default"],o["b"],o["c"],!1,null,"e5ab26c6",null,!1,o["a"],void 0);e["default"]=r.exports},"629f":function(t,e,n){},"75cf":function(t,e,n){"use strict";(function(t,o){var s=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(n("2eee")),a=s(n("c973")),r=s(n("7504")),c={components:{uniIcons:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(n("1533"))}.bind(null,n)).catch(n.oe)},uniNumberBox:function(){n.e("node-modules/@dcloudio/uni-ui/lib/uni-number-box/uni-number-box").then(function(){return resolve(n("ed58"))}.bind(null,n)).catch(n.oe)},customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)},userPrivacy:function(){n.e("components/userPrivacy/userPrivacy").then(function(){return resolve(n("594f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{name:"",textareaMaxLength:500,textareaWordCount:0,maxUploadImgLength:1,telephone:"",resource:{},roomId:"",count:1,reason:{},content:"",time:"",date:"",startDate:"",endDate:"",reasonList:[],footerData:null,show:!1,host:"",openId:"",isGate:1,pointName:"",pointId:"",regionId:"",roomList:[],room:null,buildingId:"",loadData:!1,manage:"",cardTypeId:"",cardTypeStr:"",cardTypeList:["居民身份证"],IDCardNo:"",isShowCompany:!0,companyId:"",companyStr:"",companyList:[],imgUrl:"",isCanApproval:!1,companyOrCustomerList:[],customerType:"",showPrivacy:!1}},onLoad:function(){var e=(0,a.default)(i.default.mark((function e(n){var s,a,r,c,u=this;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.onNeedPrivacyAuthorization&&t.onNeedPrivacyAuthorization((function(t,e){u.showPrivacy=!0,u.resolvePrivacyAuthorization=t})),o.removeStorageSync(this.$config.storageKeys.resource),s=this,s.startDate=s.getDate("start"),s.endDate=s.getDate("end"),a=o.getStorageSync(this.$config.storageKeys.token),a){e.next=19;break}return e.next=9,this.$token.getByService();case 9:if(r=e.sent,!r.success||!r.token){e.next=17;break}return a=r.token,e.next=14,this.$token.getOpenId(r.token);case 14:e.sent,e.next=19;break;case 17:return o.showToast({icon:"none",title:"获取token失败",duration:2500}),e.abrupt("return");case 19:c=o.getStorageSync(this.$config.storageKeys.openId),s.$httpVisitor.get("/visitation/should_approval").then((function(t){if(t&&t.success){var e=t.result;e&&e.newVisitor?s.isCanApproval=!0:(s.isCanApproval=!1,o.showModal({title:"审批禁用提醒",content:"本功能需要办公审批中的访客申请流程支持。当前此流程被禁用，请联系物业处理。",showCancel:!1,success:function(t){}}))}else s.isCanApproval=!1,o.showModal({title:"审批禁用提醒",content:"本功能需要办公审批中的访客申请流程支持。当前此流程被禁用，请联系物业处理。",showCancel:!1,success:function(t){}})})).catch((function(t){s.isCanApproval=!1,o.showModal({title:"审批禁用提醒",content:"本功能需要办公审批中的访客申请流程支持。当前此流程被禁用，请联系物业处理。",showCancel:!1,success:function(t){}}),console.log(t)})),s.$httpVisitor.get("/intelligentPoint/".concat(n.pointId)).then((function(t){s.pointName=t.result.pointName,s.pointId=t.result.id,s.regionId=t.result.regionId,s.buildingId=t.result.positionId,s.manage=t.result.regionName,o.setNavigationBarTitle({title:"申请开门"}),u.$httpVisitor.get("visitation/today_last_visitation?regionId=".concat(t.result.regionId,"&openId=").concat(c)).then((function(t){t&&t.success?(o.hideLoading(),t.result&&1==t.result.status?o.navigateTo({url:"./pass?visitorId=".concat(t.result.id)}):t.result&&2==t.result.status?o.navigateTo({url:"./fail?visitorId=".concat(t.result.id,"&pointId=").concat(s.pointId)}):t.result&&0==t.result.status?o.navigateTo({url:"./result?visitorId=".concat(t.result.id)}):o.setNavigationBarTitle({title:"申请开门"})):u.error(t.error)})).catch((function(t){console.log(t)}))})).catch((function(t){console.log(t)})),s.$http.get("/api/v2.0/wechat/enum-visit-causes").then((function(t){s.reasonList=t})).catch((function(t){console.log(t)}));case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),onShow:function(){var t=(0,a.default)(i.default.mark((function t(){var e,n,s,a=this;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=o.getStorageSync(this.$config.storageKeys.token),e){t.next=14;break}return t.next=4,this.$token.getByService();case 4:if(n=t.sent,!n.success||!n.token){t.next=12;break}return e=n.token,t.next=9,this.$token.getOpenId(n.token);case 9:t.sent,t.next=14;break;case 12:return o.showToast({icon:"none",title:"获取token失败",duration:2500}),t.abrupt("return");case 14:this.getFooterData(),s=o.getStorageSync(this.$config.storageKeys.openId),this.openId=s,s||o.showModal({title:"提示",content:"请先登录",showCancel:!1,success:function(t){o.switchTab({url:"../me"})}}),this.roomId&&this.$httpPmsBase.get("house_customer/currentListByHouse?houseId=".concat(this.roomId)).then((function(t){t&&t.success&&(a.companyOrCustomerList=t.result,t.result&&t.result.length>0&&(a.companyId=t.result[0].customerId,a.companyStr=t.result[0].customerName,a.customerType=t.result[0].customerType,"单位"!=t.result[0].customerType?a.host=t.result[0].customerName:a.host=""))}));case 19:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},error:function(t){o.hideLoading(),this.loadData=!0,o.showToast({icon:"none",title:t||"系统繁忙，请稍候重试",duration:2500})},descInput:function(){this.textareaWordCount=this.content.length},onRoomChange:function(t){o.navigateTo({url:"../../../select-room/select-point-building?&regionId=".concat(this.regionId,"&selectedAddress=").concat(this.manage,"&pointId={this.pointId}")})},uploadImg:function(){var t=this,e=["img","jpg","png","gif","jpeg","BMP","svg","TIFF","bmp","JPG","JPEG","GIF","PNG","IMG","SVG"];o.chooseImage({count:1,sizeType:["original","compressed"],success:function(n){var s;console.log("选取图片路径",n.tempFiles[0].path),console.log("选取图片大小",n.tempFiles[0].size);var i=n.tempFiles[0].path;if(-1!==e.indexOf(i.split(".")[(null===(s=i.split("."))||void 0===s?void 0:s.length)-1]))if(n.tempFiles[0].size>2097152)t.error("上传文件大小不得超过2M！");else{t.fileName=i.substring(i.lastIndexOf("/")+1);var a=o.getStorageSync(r.default.storageKeys.token);o.uploadFile({url:t.$config.apiBaseUrl+"/hfle/v1/files/multipart",filePath:n.tempFilePaths[0],name:"file",formData:{filename:t.fileName,bucketName:"public",directory:"hpfm05"},header:{"Content-Type":"multipart/form-data",Authorization:a.token_type+" "+a.access_token},success:function(e){console.log("上传图片",e.data),t.imgUrl=e.data},fail:function(e){return t.error("上传图片失败，请重新上传"),!1}})}else{var c="只能上传".concat(e.map((function(t){return".".concat(t)})).join(","),"类型图片!");t.error(c)}}})},actionSheetTap:function(t){o.previewImage({current:0,urls:[this.imgUrl]})},cardTypeChange:function(t){this.cardTypeId=t.target.value,this.cardTypeStr=this.cardTypeList[t.target.value],this.IDCardNo=""},deleteCardType:function(){this.cardTypeId="",this.cardTypeStr="",this.IDCardNo=""},companyChange:function(t){var e=this.companyOrCustomerList[t.target.value];this.companyId=e.customerId,this.companyStr=e.customerName,this.customerType=e.customerType,"单位"!=e.customerType?this.host=e.customerName:this.host=""},getDate:function(t){var e=new Date;return"end"===t&&e.setFullYear(e.getFullYear()+1),e.format("yyyy-MM-dd")},onCountNumBoxChange:function(t){this.count=t},bindDateChange:function(t){this.date=t.target.value,this.time="",this.startTime=this.getStartTime()},resetFileds:function(){var t=this;t.name="",t.roomId="",t.host="",t.telephone="",t.count=1,t.room=null,t.content="",t.buildingId="",t.cardTypeId="",t.cardTypeStr="",t.IDCardNo="",t.imgUrl="",t.companyStr="",t.textareaWordCount=0},validate:function(){var t=this;return t.name?t.telephone?isNaN(t.telephone)||t.telephone<1e10||t.telephone>19999999999?(t.error("手机号码格式错误"),!1):"单位"!=t.customerType||t.cardTypeStr?t.cardTypeStr&&!t.IDCardNo?(t.error("请输入访客证件号码"),!1):t.count?t.roomId?t.companyStr?t.host?(console.log(t.buildingId,t.resource.parentId,t.buildingId,t.resource.buildingId),!(!Number(t.isGate)&&t.buildingId!==t.resource.parentId&&t.buildingId!==t.resource.buildingId)||(t.error("该房间不在该门禁点所在楼栋"),!1)):(t.error("请输入房主姓名"),!1):(t.error("请选择被访客户/单位"),!1):(t.error("请选择到访房间号"),!1):(t.error("请输入来访人数"),!1):(t.error("请选择访客证件类型"),!1):(t.error("请输入访客联系电话"),!1):(t.error("请输入访客姓名"),!1)},toEnsureinvite:function(){var t=this,e=this;o.showLoading({mask:!0});var n=o.getStorageSync(this.$config.storageKeys.openId);e.validate()&&e.$httpVisitor.post("/visitation/save",{regionId:this.resource.regionId,type:0,customerId:this.companyId,resourceId:this.resource.resourceId,customerName:this.host,visitorName:this.name,visitorPhone:this.telephone,visitorNum:this.count,visitorReason:this.content,visitorIdType:""!==this.cardTypeId?this.cardTypeId:void 0,visitorIdNo:this.IDCardNo,visitorPhoto:this.imgUrl,openId:n}).then((function(n){n&&n.success?(o.hideLoading(),o.navigateTo({url:"./result?visitorId=".concat(n.result)}),t.resetFileds()):e.error(n.message||"申请失败")})).catch((function(t){e.error(t.message)}))},getFooterData:function(){var t=this;return(0,a.default)(i.default.mark((function e(){var n;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$footerConfig.get();case 2:n=e.sent,t.footerData=n;case 4:case"end":return e.stop()}}),e)})))()},getstaticOssUrl:function(t){return t?this.$tool.image.getstaticOssUrl(t):""}}};e.default=c}).call(this,n("bc2e")["default"],n("543d")["default"])},7856:function(t,e,n){"use strict";n.r(e);var o=n("75cf"),s=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=s.a},cbec:function(t,e,n){"use strict";n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))},userPrivacy:function(){return n.e("components/userPrivacy/userPrivacy").then(n.bind(null,"594f"))}},s=function(){var t=this,e=t.$createElement,n=(t._self._c,t.getstaticOssUrl("wechat-static/visitor/icon-position.png")),o=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/974fc9045af6423db3ec4764c240f555@new_icon-user.svg"),s=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/976cca9c83244df8a65720e4a0fbae12@new_icon-phone.svg"),i=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/976cca9c83244df8a65720e4a0fbae12@new_icon-phone.svg"),a=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/d76ca5972632483ba1bf1ad560d7c6a2@new_icon-list.svg"),r=t.cardTypeId?t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/1e1477c64c024aa0b9b3440f1cfb7e19@new_icon-card.svg"):null,c=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/9cbe256781644daf973db8a6f605a7ca@new_icon-users.svg"),u=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/3e172b4e793649e4b0f7412fb0af27d6@new_icon-reason.svg"),l=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/7b77b4e20b024965a0dfbfee0c99daa6@new_address.svg"),d=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/a269b149147a40eca21ea18ded3cfee4@new_icon-company.svg"),h=t.getstaticOssUrl("https://nova-pms-dianshang-public.oss-cn-beijing.aliyuncs.com/hpfm05/0/974fc9045af6423db3ec4764c240f555@new_icon-user.svg");t.$mp.data=Object.assign({},{$root:{m0:n,m1:o,m2:s,m3:i,m4:a,m5:r,m6:c,m7:u,m8:l,m9:d,m10:h}})},i=[]},d429:function(t,e,n){"use strict";var o=n("629f"),s=n.n(o);s.a},db78:function(t,e,n){"use strict";(function(t,e){var o=n("4ea4");n("895d");o(n("66fd"));var s=o(n("101a"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(s.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])}},[["db78","common/runtime","common/vendor"]]]);