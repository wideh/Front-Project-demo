(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{2046:function(e,t,n){"use strict";n.r(t);var i=n("9ce7"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=o.a},"3c20":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var i={pageStatusBar:function(){return n.e("components/page-status-bar/page-status-bar").then(n.bind(null,"9cf9"))},uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))},pageEmpty:function(){return n.e("components/page-empty/page-empty").then(n.bind(null,"1068"))},userPrivacy:function(){return n.e("components/userPrivacy/userPrivacy").then(n.bind(null,"594f"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.community?e.swiperList&&e.swiperList.length>0:null),i=e.community&&n?e.__map(e.swiperList,(function(t,n){var i=e.__get_orig(t),o=e.getHttpUrl(t.imageRelativePath);return{$orig:i,m0:o}})):null,o=e.community?e.filtergridList&&e.filtergridList.length>0:null,a=e.community&&e.isShowHousekeeperInformation&&e.staffManager.staffId>0?e.staffManager.headSculptureAttachments.length:null,r=e.community&&e.isShowHousekeeperInformation&&e.staffManager.staffId>0?e.staffManager.nickName.length:null,s=e.community&&e.isShowHousekeeperInformation&&e.staffManager.staffId>0&&r>12?e.staffManager.nickName.substring(0,11).concat("..."):null,c=e.community&&e.isShowHousekeeperInformation&&e.staffManager.staffId>0?e.staffManager.weChaQRCodeAttachments.length:null,u=e.community&&e.isShowNotice?e.noticeList&&e.noticeList.length>0:null,l=e.community&&e.isShowNotice&&u?e.__map(e.noticeList,(function(t,n){var i=e.__get_orig(t),o=e.displayTime(t.publishedOn),a=e.noticeList.length;return{$orig:i,m1:o,g7:a}})):null,p=e.community&&e.isShowActivities?e.activityList&&e.activityList.length>0:null,g=e.community&&e.isShowActivities&&p?e.__map(e.activityList,(function(t,n){var i=e.__get_orig(t),o=t.imgUrl?e.coverImage(t):null,a=e.displayApplyEndDate(t),r=e.couldBeJoin(t),s=e.displayButtonText(t);return{$orig:i,m2:o,m3:a,m4:r,m5:s}})):null;e.$mp.data=Object.assign({},{$root:{g0:n,l0:i,g1:o,g2:a,g3:r,g4:s,g5:c,g6:u,l1:l,g8:p,l2:g}})},a=[]},"72d9":function(e,t,n){"use strict";(function(e,t){var i=n("4ea4");n("895d");i(n("66fd"));var o=i(n("e887"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"8e7a":function(e,t,n){"use strict";var i=n("c788"),o=n.n(i);o.a},"9ce7":function(e,t,n){"use strict";(function(e,i){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("2eee")),r=o(n("9523")),s=o(n("c973")),c=o(n("7504")),u=o(n("0b6f")),l=(o(n("cb1a")),n("1612"));function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e){if(f&&f.options||(f.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}),!e)return"";var t=f.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),i={},o=14;while(o--)i[t.key[o]]=n[o]||"";return i[t.q.name]={},i[t.key[12]].replace(t.q.parser,(function(e,n,o){n&&(i[t.q.name][n]=o)})),i}function d(e){var t=[];return function e(n){for(var i=0;i<n.length;i++){var o=n[i];"A"===o.type&&t.push(o),o.children&&o.children.length>0&&e(o.children)}}(e),t}var h={components:{pageStatusBar:function(){n.e("components/page-status-bar/page-status-bar").then(function(){return resolve(n("9cf9"))}.bind(null,n)).catch(n.oe)},uniIcons:function(){Promise.all([n.e("common/vendor"),n.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(n("1533"))}.bind(null,n)).catch(n.oe)},pageEmpty:function(){n.e("components/page-empty/page-empty").then(function(){return resolve(n("1068"))}.bind(null,n)).catch(n.oe)},customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)},userPrivacy:function(){n.e("components/userPrivacy/userPrivacy").then(function(){return resolve(n("594f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{titleContainerHeight:0,statusBarHeight:0,swiperList:[],topMenuList:[{text:"物业缴费",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_icon-pay.png",code:"hzero.miniprogram.countercharge.propertypayment.ps.default"},{text:"客服热线",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_icon-service.png",code:""},{text:"报事报修",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_icon-repair.png",code:"hzero.miniprogram.repairs.customerservice.ps.default"},{text:"一键开门",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_icon-opendoor.png",code:"hzero.miniprogram.intelligentaccesscontrol.dooropening.ps.default"}],gridList:[{text:"投诉建议",icon:"https://nova-pms-test-public.oss-cn-shenzhen.aliyuncs.com/hpfm05/0/df91795321874b98b38d9e13d908f748@new_tousujianyi (2).png",code:"hzero.miniprogram.complaintsuggestions.complaint.ps.default",menuType:"物业服务"},{text:"装修申请",icon:"https://nova-pms-test-public.oss-cn-shenzhen.aliyuncs.com/hpfm05/0/de2797e80e9c4f8d839dc77d4219777c@new_bianminshangcheng.png",code:"hzero.miniprogram.decorationmanagement.decorationapplication.ps.default",menuType:"物业服务"},{text:"访客通行",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_icon-visitor.png",code:"hzero.miniprogram.intelligentaccesscontrol.visitoraccess.ps.default",menuType:"物业服务"},{text:"便民服务",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_convenience.png",code:"hzero.miniprogram.convenientserviceinformation.convenientservices.ps.default",menuType:"生活服务"},{text:"积分商城",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_sale-shop.png",code:"hzero.miniprogram.pointsmanagement.pointsmall.ps.default",menuType:"生活服务"},{text:"投票",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_toupiao.png",code:"hzero.miniprogram.vote.vote.ps.default",menuType:"生活服务"},{text:"房屋服务",icon:"https://nova-pms-test-public.oss-cn-shenzhen.aliyuncs.com/hpfm05/0/82ce6b19a7e6479e848bb3ed8a488c40@new_room-service.svg",code:"hzero.miniprogram.customerservice.customerhouseservices.ps.default",menuType:"生活服务"},{text:"生活缴费",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_shenghuojiaofei.png",code:"hzero.miniprogram.livingexpenses.paymententrance.ps.default",menuType:"生活服务"},{text:"论坛",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_forum.png",code:"hzero.miniprogram.forum.forumentrance.ps.default",menuType:"生活服务"},{text:"点餐",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_sale-server.png",code:"hzero.miniprogram.ordermanagement.order.ps.default",menuType:"生活服务"},{text:"我的快递",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_wodekuaidi.png",code:"hzero.miniprogram.parcelmanagement.myexpressdelivery.ps.default",menuType:"生活服务"},{text:"合同缴费",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_contractBill.png",code:"hzero.miniprogram.countercharge.contractpayment.ps.default",menuType:"租赁服务"},{text:"招商租赁",icon:this.$tool.image.staticOssHttp+"wechat_index/me/new_icon-house.png",code:"hzero.miniprogram.propertymanagement.investmentleasing.ps.default",menuType:"租赁服务"},{text:"租会议室",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_huiwu-zul.png",code:"hzero.miniprogram.meetingroomrental.rentalmeetingroom.ps.default",menuType:"租赁服务"},{text:"商家/单位管理",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_companyStaff.png"}],filtergridList:[],customFormList:[],noticeList:[],activityList:[],city:"",community:{},user:{},phone:"",footerData:null,isShowCompanyStaff:e.getStorageSync(this.$config.storageKeys.isCustomerStaff),isShowActivities:!1,isShowNotice:!1,isNewRepair:!1,isShowHousekeeperInformation:!1,enableHouseRepair:!1,permissionData:[],staffManager:{},isWeChaQRCodeHidden:!0,modalShow:!1,enableAnonymousRepair:!1,notWhiteBg:!0,showRegionDownIcon:!0,titlebarBgColor:"",scrollHalf:!1,showPrivacy:!1}},computed:{isLogin:function(){return!!this.user},footerFixBottom:function(){var e=this.swiperList&&this.swiperList.length>0||this.activityList&&this.activityList.length>0;return e},topTotalHeight:function(){return this.titleContainerHeight+this.statusBarHeight+4},cardWraperBoxShadow:function(){return!this.swiperList.length&&this.filtergridList.length<5?"0 20rpx 46rpx 0rpx #e3e3e3":""}},onPageScroll:function(e){e.scrollTop>100?(this.notWhiteBg=!1,this.titlebarBgColor="rgba(255, 255, 255, 1)"):(this.notWhiteBg=!0,this.titlebarBgColor="rgba(255, 255, 255,"+e.scrollTop/60+")"),e.scrollTop>40?this.scrollHalf=!0:this.scrollHalf=!1},onLoad:function(t){var n=this,o=i.getSystemInfoSync();o&&console.log("版本信息",null===o||void 0===o?void 0:o.SDKVersion),i.getPrivacySetting&&i.getPrivacySetting({success:function(e){console.log("是否有待同意的隐私政策信息",e),e.needAuthorization?n.showPrivacy=!0:n.showPrivacy=!1},fail:function(){},complete:function(){}}),e.showLoading({title:"加载中"});var a=e.getSystemInfoSync();if(this.statusBarHeight=a.statusBarHeight,"android"==a.platform?this.titleContainerHeight=48:this.titleContainerHeight=44,!c.default.tenantId)return this.loginAndGoto(!0),void e.hideLoading();var r=setInterval((function(){e.getStorageSync(n.$config.storageKeys.token)&&(clearInterval(r),n.onloadCheck())}),500),s=this.$config.isOpenSubscribedMsg;s&&this.getSubscribedMsg(),i.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onShow:function(){var t=(0,s.default)(a.default.mark((function t(){var n,i,o,r,c,u,p,f,d=this;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("function"===typeof this.$mp.page.getTabBar&&this.$mp.page.getTabBar()&&(this.$mp.page.getTabBar().updatePermissionData(),n=this.$mp.page.getTabBar().data.list,i=n.findIndex((function(e){return e.text===l.tabBarNameData.首页})),this.$mp.page.getTabBar().setData({selected:i})),this.city=e.getStorageSync(this.$config.storageKeys.city),o=e.getStorageSync(this.$config.storageKeys.token),o){t.next=12;break}return t.next=6,this.$token.getByService();case 6:if(r=t.sent,!r.success||!r.token){t.next=12;break}return o=r.token,t.next=11,this.$token.getOpenId(r.token);case 11:t.sent;case 12:if(c=e.getStorageSync(this.$config.storageKeys.community),c||!o){t.next=17;break}return t.next=16,this.$basicInfo.setCommunity(o);case 16:c=e.getStorageSync(this.$config.storageKeys.community);case 17:return this.community=c,this.user=e.getStorageSync(this.$config.storageKeys.user),this.community&&o&&(u=this,u.$http.get("/api/v2.0/wechat/announcements",{regionId:u.community.id,page:1,pageSize:3}).then(function(){var e=(0,s.default)(a.default.mark((function e(t){var n,i,o,r,s;return a.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.data){e.next=17;break}n=t.data.slice(0,2),i=0;case 3:if(!(i<n.length)){e.next=16;break}return o=n[i],e.next=7,u.getNotelistDetail(o.id);case 7:if(r=e.sent,!r){e.next=13;break}return e.next=11,u.checkImgExists(r);case 11:s=e.sent,s&&(o.imgSrc=r);case 13:i++,e.next=3;break;case 16:u.noticeList=n;case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u.$http.get("/api/v2.0/wechat/swipers/miniprogram",{regionId:u.community.id}).then((function(e){u.swiperList=e})).catch((function(e){console.log(e)})),u.$httpCommon.get("/nova-customer-service/v1/".concat(u.$config.tenantId,"/customer/activity/page"),{regionId:u.community.id,current:0,size:999,isMini:1}).then((function(e){var t=e.result.records,n=[],i=t.map((function(e){return g(g({},e),{},{coverImage:e.imgUrl,registrationEndTime:e.registerEndTime,registrationStartTime:e.registerStartTime,joinTotal:e.registerNum,haveIJoined:e.isRegister,address:e.activityLocation,receiverType:e.receiverType})}));n=d.isLogin&&d.user.customerId?i:i.filter((function(e){var t=e.receiverType.split(","),n=t.findIndex((function(e){return"1"==e}));return-1!==n})),u.activityList=n.splice(0,2)})).catch((function(e){console.log(e)})),u.$http.get("/api/v2.0/weChat/regions/".concat(u.community.id,"/phone")).then((function(e){u.phone=e})).catch((function(e){console.log(e)})),u.$httpCommon.get("/nova-customer-service/v1/".concat(this.$config.tenantId,"/repair/settings/isEnabledRepairFlow")).then((function(e){console.log("新版报修是否启用",e),null!==e&&void 0!==e&&e.success&&(u.isNewRepair=e.result)})).catch((function(e){console.log(e)})),u.$http.request("/api/v1.0/app/CommonApi/regions").then((function(e){e&&(d.regionList=e,Array.isArray(e)&&(null===e||void 0===e?void 0:e.length)<2&&(u.showRegionDownIcon=!1))})).catch((function(e){console.log(e)}))),p=this,f=setInterval((function(){null!=e.getStorageSync(p.$config.storageKeys.isCustomerStaff)&&(clearInterval(f),p.isShowCompanyStaff=e.getStorageSync(p.$config.storageKeys.isCustomerStaff))}),500),setTimeout((0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!=e.getStorageSync(p.$config.storageKeys.isCustomerStaff)){t.next=3;break}return t.next=3,p.$token.getIsCustomerStaff();case 3:case"end":return t.stop()}}),t)}))),2e3),this.getRepairSetting(),this.getFooterData(),this.getBasicResourceManager(),t.next=28,this.getcustomFormList();case 28:return t.next=30,this.setPermissions().then((function(e){p.showFunctionByPermission()}));case 30:this.$httpHd.get("/nova-mall-api/p/shopDetail/getSaasShopId").then((function(t){e.setStorageSync(d.$config.storageKeys.shopId,t)}));case 31:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),onShareAppMessage:function(e){if("menu"===e.from)return{title:"".concat(this.$config.appName),path:"/pages/index/index",imageUrl:""}},onShareTimeline:function(){return{title:"".concat(this.$config.appName),path:"/pages/index/index",imageUrl:""}},methods:{getFooterData:function(){var e=this;return(0,s.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$footerConfig.get();case 2:n=t.sent,e.footerData=n;case 4:case"end":return t.stop()}}),t)})))()},setPermissions:function(){var t=(0,s.default)(a.default.mark((function t(n){var i=this;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var o=i,a=e.getStorageSync(o.$config.storageKeys.token),r=(e.getStorageSync(o.$config.storageKeys.openId),l.permissionDataCode);e.request({url:o.$config.apiIamBaseUrl+"/menus/check-permissions",method:"POST",header:{Authorization:a.token_type+" "+a.access_token},data:r,success:function(n){200==n.statusCode&&n.data&&n.data&&(e.setStorageSync(o.$config.storageKeys.permissionDatasId,n.data),o.permissionData=n.data,t(!0))},fail:function(){e.setStorageSync(o.$config.storageKeys.permissionDatasId,[]),o.permissionData=[],n(!1)}})})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),getcustomFormList:function(){var e=this;return new Promise((function(t,n){var i=e;i.$httpWorkflow.get("/approval_custom_type/list?customApprovalPermissionType=2").then((function(n){if(n&&n.success){if(n.result&&n.result.length>0){var i=n.result;e.customFormList=i}else e.customFormList=[];t(!0)}else t(!1)})).catch((function(e){console.log(e),t(!1)}))}))},showFunctionByPermission:function(){var t=this.permissionData;t=""===t?[]:t;var n=this.gridList,i=n.filter((function(e){return""===e.code||t.some((function(t){return t.code===e.code&&!0===t.approve}))}));this.gridList=i;var o=[],a=this.customFormList,r=e.getStorageSync("filterGridList");if(r&&r.length>=0)for(var s=function(e){var t=r[e];if("customForm"===t.menuType&&t.id){var n=a.find((function(e){return e.id===t.id}));if(n){var s={id:n.id,text:n.typeName,icon:n.icon};o.push(s)}return"continue"}var c=i.find((function(e){return e.text===t.text}));c&&o.push(t)},c=0;c<r.length;c++)s(c);else o=this.gridList.slice(0,7);o.push({text:"全部",icon:this.$tool.image.staticOssHttp+"wechat_index/index/new_all.png",code:""}),this.filtergridList=o;var u=t.find((function(e){return e.code==l.permissionData.社区活动}));this.isShowActivities=u.approve;var p=t.find((function(e){return e.code==l.permissionData.公告}));this.isShowNotice=p.approve;var g=t.find((function(e){return e.code==l.permissionData.管家信息}));this.isShowHousekeeperInformation=g.approve},onloadCheck:function(){var t=this;t.$datas.user.syncData().then((function(n){e.hideLoading(),t.user=n})).catch((function(t){e.hideLoading(),console.log(t)}))},checkIsLogin:function(){return console.log(this.isLogin),!!this.isLogin||(e.showToast({icon:"none",title:"还没登录"}),!1)},checkBindTelephone:function(){if(this.checkIsLogin()){if(this.user.phoneNumber)return!0;e.showModal({title:"需要完善您的个人信息",confirmText:"去完善",success:function(t){t.confirm&&e.navigateTo({url:"../login/check/check"})}})}return!1},checkHasRoom:function(){if(this.checkBindTelephone()){if(this.user.defaultHouseResourceId)return!0;e.showModal({title:"还没有添加任何房间",confirmText:"去添加",success:function(t){t.confirm&&e.navigateTo({url:"../me/room/room"})}})}return!1},checkHasResouce:function(){if(this.checkBindTelephone()){if(this.user.defaultResourceId)return!0;e.showModal({title:"还没有添加任何房间车位",confirmText:"去添加",success:function(t){t.confirm&&e.navigateTo({url:"../me/room/room"})}})}return!1},getHttpUrl:function(e){return this.$tool.image.getHttpUrl(e)},goToNotice:function(){e.navigateTo({url:"/packageNotice/notice/list/list"})},goToActivityDetail:function(t){e.navigateTo({url:"/packageNotice/notice/item/item?id="+t})},goToActivities:function(){e.navigateTo({url:"../activity/activity"})},goToActivity:function(t){e.navigateTo({url:"../activity/item/item?id="+t})},goToChooseLocation:function(){e.navigateTo({url:"../position/position?targetKey="+this.$config.positionKeys.community})},onSwiperItemClick:function(t){switch(t.targetType){case 0:e.navigateTo({url:"/packageNotice/notice/item/item?id="+t.targetId});break;case 1:e.navigateTo({url:"../activity/item/item?id="+t.targetId});break;case 3:var n=t.targetSubject;if(n){var i=f(n);if(i){if("miniprogram"==i.protocol)return void e.navigateToMiniProgram({appId:i.host,path:i.path,extraData:i.queryKey});if("https"==i.protocol)return void e.navigateTo({url:"../web/web?url="+encodeURI(n)})}e.navigateTo({url:n})}}},checkTopMenuAuth:function(e){if(!e)return!0;var t=this.permissionData;return t=""===t?[]:t,t.findIndex((function(t){return t.code===e&&!0===t.approve}))>-1},onTopMenuItemClick:function(t,n){var i=this;return(0,s.default)(a.default.mark((function o(){var r;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:o.t0=t,o.next=o.t0===l.indexGridListName.物业缴费?3:o.t0===l.indexGridListName.客服热线?8:o.t0===l.indexGridListName.报事报修?20:o.t0===l.indexGridListName.一键开门?33:38;break;case 3:if(i.checkTopMenuAuth(n)){o.next=6;break}return e.showToast({icon:"none",title:"该项目暂未开放此功能"}),o.abrupt("break",38);case 6:return i.checkHasResouce()&&e.navigateTo({url:"../me/select/room-and-parking/room-and-parking?selectType=both&returnUrl=/packageBill/bill/bill"}),o.abrupt("break",38);case 8:if(i.checkTopMenuAuth(n)){o.next=11;break}return e.showToast({icon:"none",title:"该项目暂未开放此功能"}),o.abrupt("break",38);case 11:if(!i.phone){o.next=18;break}return o.next=14,i.callPhone(i.phone);case 14:if(!o.sent){o.next=16;break}e.makePhoneCall({phoneNumber:i.phone});case 16:o.next=19;break;case 18:e.showToast({icon:"none",title:"亲爱的业主：电话号码修改中，暂时无法显示，请耐心等待",duration:2e3});case 19:return o.abrupt("break",38);case 20:if(i.checkTopMenuAuth(n)){o.next=23;break}return e.showToast({icon:"none",title:"该项目暂未开放此功能"}),o.abrupt("break",38);case 23:if(!i.isNewRepair){o.next=31;break}if(r="/packageRepair/flowRepair/new/new?enableHouseRepair=".concat(i.enableHouseRepair,"&enableAnonymousRepair=").concat(i.enableAnonymousRepair),i.enableAnonymousRepair){o.next=28;break}if(i.checkHasResouce()){o.next=28;break}return o.abrupt("break",38);case 28:e.navigateTo({url:r}),o.next=32;break;case 31:e.navigateTo({url:"/packageRepair/repair/new/new"});case 32:return o.abrupt("break",38);case 33:if(i.checkTopMenuAuth(n)){o.next=36;break}return e.showToast({icon:"none",title:"该项目暂未开放此功能"}),o.abrupt("break",38);case 36:return e.navigateTo({url:"/pages/door/opendoor"}),o.abrupt("break",38);case 38:case"end":return o.stop()}}),o)})))()},onGridItemClick:function(t,n){var o=this;return(0,s.default)(a.default.mark((function r(){return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!n){a.next=3;break}return o.onCunstomFormItemClick(n),a.abrupt("return");case 3:a.t0=t,a.next=a.t0===l.indexGridListName.投诉建议?6:a.t0===l.indexGridListName.我的快递?8:a.t0===l.indexGridListName.生活缴费?10:a.t0===l.indexGridListName.点餐?12:a.t0===l.indexGridListName.租会议室?14:a.t0===l.indexGridListName.招商租赁?16:a.t0===l.indexGridListName.积分商城?18:a.t0===l.indexGridListName.投票?22:a.t0===l.indexGridListName.便民服务?24:a.t0===l.indexGridListName.合同缴费?26:a.t0===l.indexGridListName.商家单位管理?28:a.t0===l.indexGridListName.论坛?31:a.t0===l.indexGridListName.房屋服务?34:a.t0===l.indexGridListName.装修申请?37:a.t0===l.indexGridListName.访客通行?39:"全部"===a.t0?41:43;break;case 6:return e.navigateTo({url:"/pages/complaints/complaints"}),a.abrupt("break",45);case 8:return e.navigateTo({url:"/packageKD/parcel/parcel"}),a.abrupt("break",45);case 10:return i.navigateToMiniProgram({appId:"wxd2ade0f25a874ee2",path:"",success:function(e){}}),a.abrupt("break",45);case 12:return e.navigateTo({url:"/packageWM/sale-activity/sale-activity"}),a.abrupt("break",45);case 14:return e.navigateTo({url:"/packageMeet/meet-lease"}),a.abrupt("break",45);case 16:return e.navigateTo({url:"/packageZS/house-resource"}),a.abrupt("break",45);case 18:if(o.checkTelephoneAndSavaShopId()){a.next=20;break}return a.abrupt("break",45);case 20:return o.checkIsLogin()&&o.checkBindTelephone()&&e.navigateTo({url:"/pages/nova-mall/pointWeb"}),a.abrupt("break",45);case 22:return e.navigateTo({url:"/packageVote/voteList/voteList"}),a.abrupt("break",45);case 24:return e.navigateTo({url:"/packageConvenience/conveniencelist/conveniencelist"}),a.abrupt("break",45);case 26:return o.checkHasResouce()&&e.navigateTo({url:"/packageBill/contractBill/selectContract/selectContract"}),a.abrupt("break",45);case 28:return console.log("触发商家小程序"),o.goToMerchantProgram(),a.abrupt("break",45);case 31:return console.log("论坛"),e.navigateTo({url:"/pages/forum/forum"}),a.abrupt("break",45);case 34:return o.checkHasResouce()&&e.navigateTo({url:"/packageroomService/serviceType"}),a.abrupt("break",45);case 37:return o.checkIsLogin()&&e.navigateTo({url:"/packageDecoration/history/history?userId="+o.user.userId}),a.abrupt("break",45);case 39:return o.checkHasRoom()&&e.navigateTo({url:"/packageVisitor/visitor/add/add"}),a.abrupt("break",45);case 41:return e.navigateTo({url:"/pages/all-menus/all-menus?isLogin="+o.isLogin+"&phoneNumber="+o.user.phoneNumber+"&defaultHouseResourceId="+o.user.defaultHouseResourceId}),a.abrupt("break",45);case 43:return e.showToast({icon:"none",title:"敬请期待，稍后上线"}),a.abrupt("break",45);case 45:case"end":return a.stop()}}),r)})))()},goToFormList:function(){e.navigateTo({url:"/packageForm/list/list?isLogin="+this.isLogin+"&phoneNumber="+this.user.phoneNumber+"&defaultHouseResourceId="+this.user.defaultHouseResourceId+"&isNewRepair="+this.isNewRepair+"&enableHouseRepair="+this.enableHouseRepair+"&enableAnonymousRepair="+this.enableAnonymousRepair})},onCunstomFormItemClick:function(t){e.navigateTo({url:"/packageForm/new/new?id=".concat(t)})},callPhone:function(t){return new Promise((function(n,i){e.showModal({title:"确认拨打该电话吗?",content:t,success:function(e){e.confirm?n(!0):n(!1)}})}))},goToMerchantProgram:function(){e.navigateToMiniProgram({appId:this.$config.merchantProgramAppId,path:"pages/merchant/merchant",extraData:{},success:function(e){}})},getRepairSetting:function(){var e=this;this.$httpCommon.get("/nova-customer-service/v1/".concat(this.$config.tenantId,"/repair/settings/isEnableHouseRepair")).then((function(t){t&&t.success&&(console.log("获取是否户内",t),e.enableHouseRepair=t.result)})).catch((function(e){console.log(e)})),this.$httpCommon.get("/nova-customer-service/v1/".concat(this.$config.tenantId,"/repair/settings/isEnableAnonymousRepair")).then((function(t){t&&t.success&&(console.log("是否可以未认证用户报修",t),e.enableAnonymousRepair=t.result)})).catch((function(e){console.log(e)}))},getBasicResourceManager:function(){var e=this;this.$httpCommon.get("/wy/api/v2.0/wechat/basicResourceManager/staff").then((function(t){t&&t.success&&t.result.staffId>0?e.staffManager=t.result:e.staffManager={}})).catch((function(e){console.log(e)}))},getSubscribedMsg:function(){var t=this.$config.subscribedMsgId;i.getSetting({withSubscriptions:!0,success:function(n){if(n.subscriptionsSetting.mainSwitch)if(null!=n.subscriptionsSetting.itemSettings){var o=n.subscriptionsSetting.itemSettings[t];"accept"===o?console.log("接受了消息推送"):"reject"===o?console.log("拒绝消息推送"):"ban"===o&&console.log("已被后台封禁")}else i.showModal({title:"提示",content:"请授权开通服务通知",showCancel:!0,success:function(n){n.confirm?i.requestSubscribeMessage({tmplIds:[t],success:function(n){console.log("订阅消息 成功 ",n),"accept"==n[t]?e.showToast({icon:"none",title:"订阅消息 成功"}):"reject"==n[t]&&e.showToast({icon:"none",title:"拒绝订阅消息"})},fail:function(t){console.log("订阅消息 失败 "),console.log(t),e.showToast({icon:"none",title:"订阅消息 失败"})}}):n.cancel&&console.log("用户点击取消")}});else console.log("订阅消息未开启"),e.showToast({icon:"none",title:"订阅消息未开启"})},fail:function(e){console.log(e)}})},callButler:function(){var t=this;return(0,s.default)(a.default.mark((function n(){var i,o;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=t,o=i.staffManager.workPhone,!o){n.next=7;break}return n.next=5,t.callPhone(o);case 5:if(!n.sent){n.next=7;break}e.makePhoneCall({phoneNumber:o});case 7:case"end":return n.stop()}}),n)})))()},openModal:function(){this.modalShow=!0},closeModal:function(){this.modalShow=!1},getstaticOssUrl:function(e){return e?this.$tool.image.getstaticOssUrl(e):""},displayTime:function(e){return this.$tool.date.format(e,"yyyy.MM.dd")},getImageHttpUrl:function(e){return e?this.$tool.image.getHttpUrl(e):""},coverImage:function(e){return e&&e.imgUrl?this.getImageHttpUrl(e.imgUrl):""},displayButtonText:function(e){if(e){if(e.haveIJoined)return"已报名";if(3===e.status)return"进行中";if(2===e.status)return"未开始";if(4===e.status)return"已过期"}return"去参与"},couldBeJoin:function(e){return!!e&&(!e.haveIJoined&&(2!==e.status&&4!==e.status))},displayApplyEndDate:function(e){if(e.registrationEndTime&&e.registerStartTime){var t=this.$tool.date.format(e.registerStartTime,"yyyy.MM.dd"),n=this.$tool.date.format(e.registrationEndTime,"yyyy.MM.dd");return t+" - "+n}return""},getNotelistDetail:function(t){var n=this;return new Promise((function(i,o){n.$http.get("/api/v2.0/wechat/announcements/".concat(t)).then((function(t){var o=e.getStorageSync(n.$config.storageKeys.token),a=t.content,r="",s=a.replace(/<img\s+[^>]*src="([^"]*)"[^>]*>/g,(function(e,t){return r||(r="".concat(t,"?access_token=").concat(o.access_token)),'<img src="'.concat(t,"?access_token=").concat(o.access_token,'">')}));n.content=s,i(r)})).catch((function(e){console.log(e),o(e)}))}))},checkImgExists:function(e){return new Promise((function(t,n){i.getImageInfo({src:e,success:function(e){t(!0)},fail:function(e){t(!1)}})}))},checkTelephoneAndSavaShopId:function(){if(this.checkBindTelephone()){var t=this;return this.$httpHd.get("/nova-mall-api/p/shopDetail/getSaasShopId").then((function(n){e.setStorageSync(t.$config.storageKeys.shopId,n)})),!0}return!1},checkLogin:function(){var t=(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){e.login({success:function(i){var o=c.default.apiBaseUrl+"/oauth/mini-program/wechat",a=i.code,r={success:!1,token:null},s={grant_type:"implicit",response_type:"token",client_id:c.default.clientId,client_secret:c.default.clientSecret,miniProgramCode:c.default.miniProgramCode,tenantId:-1,jsCode:a};e.request({url:o,method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:s,success:function(n){console.log("res>>>>",n);var i=n.data;if(i&&i.success&&i.data.access_token){var o={token_type:"bearer",access_token:i.data.access_token,expires_in:i.data.expires_in,refresh_token:i.data.refresh_token};e.setStorageSync(c.default.storageKeys.token,o);var a=new Date;a.setDate(a.getDate()+6),e.setStorageSync(c.default.storageKeys.expires,a.getTime()),r.success=!0,r.token=o,t(r)}else t(i)},fail:function(){n(r),console.log("fail 获取token失败")}})}})})));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),loginAndGoto:function(){var t=(0,s.default)(a.default.mark((function t(){var n,i,o,r,l,p,g=arguments;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=g.length>0&&void 0!==g[0]&&g[0],i=this,t.next=4,i.checkLogin();case 4:if(o=t.sent,!o.success){t.next=14;break}if(!o.token){t.next=12;break}return t.next=9,u.default.getOpenId(o.token);case 9:r=t.sent,l=o.token,r&&(p=e.getStorageSync(this.$config.storageKeys.uniqueId),e.request({url:this.$config.apiBaseUrl+"/iam/v1/tenants/paging-tenant/mini-program?tenantNum=&tenantName=&uniqueId=".concat(p),method:"POST",header:{Authorization:l.token_type+" "+l.access_token},success:function(){var t=(0,s.default)(a.default.mark((function t(n){var o,r,s,l,p;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("租户信息",n),200!==n.statusCode){t.next=17;break}return l=null!==(o=null===n||void 0===n||null===(r=n.data)||void 0===r||null===(s=r.content)||void 0===s?void 0:s[0])&&void 0!==o?o:{},c.default.tenantId=null===l||void 0===l?void 0:l.tenantId,e.setStorageSync("tenantId",null===l||void 0===l?void 0:l.tenantId),t.next=7,u.default.getByService();case 7:if(p=t.sent,!p.success||!p.token){t.next=16;break}return t.next=11,u.default.getOpenId(p.token);case 11:t.sent,u.default.getUser(),u.default.getIsCustomerStaff(),u.default.getCurrentCustomerId(),u.default.setPermissions();case 16:i.$httpCommon.get("/iam/hzero/v1/".concat(c.default.tenantId,"/organizations")).then((function(t){var n,o=[];if(Array.isArray(t)&&(o=d(t)),(null===(n=o)||void 0===n?void 0:n.length)>1){var a=o[0].uuid;i.$httpCommon.get("/hpfm/v1/nova/units/".concat(c.default.tenantId,"/region/info?uuid=").concat(a)).then((function(t){e.setStorageSync("city",null!==t&&void 0!==t&&t.city?null===t||void 0===t?void 0:t.city:"其他");var n={id:a,itemType:null,itemTypeStr:"",tel:"",text:o[0].name};e.setStorageSync("community",n),e.reLaunch({url:"/pages/index/index"})})).catch((function(e){console.log(e)}))}else e.navigateTo({url:"../position/saas-region/saas-region"})})).catch((function(e){console.log(e),i.isLoading=!1}));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),fail:function(e){console.log("登录错误",e)}}));case 12:t.next=15;break;case 14:n&&e.reLaunch({url:"../position/pms-company/pms-company"});case 15:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),agreePrivacy:function(){this.showPrivacy=!1},disagreePrivacy:function(){this.showPrivacy=!1},gotoTestSplitPackage:function(){e.navigateTo({url:"/uniSubpackage/pages/index/index"})}}};t.default=h}).call(this,n("543d")["default"],n("bc2e")["default"])},c788:function(e,t,n){},e887:function(e,t,n){"use strict";n.r(t);var i=n("3c20"),o=n("2046");for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("8e7a");var r=n("f0c5"),s=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);t["default"]=s.exports}},[["72d9","common/runtime","common/vendor"]]]);