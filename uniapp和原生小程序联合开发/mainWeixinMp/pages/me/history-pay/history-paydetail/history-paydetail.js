(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/me/history-pay/history-paydetail/history-paydetail"],{"0d65":function(t,e,n){},"51ee":function(t,e,n){"use strict";n.r(e);var i=n("e9d9"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},"5a28":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));var i={sudaLoading:function(){return n.e("components/suda-loading/suda-loading").then(n.bind(null,"09dd"))},uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"cff5"))},userPrivacy:function(){return n.e("components/userPrivacy/userPrivacy").then(n.bind(null,"594f"))}},a=function(){var t=this,e=t.$createElement,n=(t._self._c,t.isLoading?null:t.formatnum(t.detailData.amount)),i=t.isLoading?null:t.formatDate(t.detailData.paidDate),a=t.isLoading?null:t.__map(t.detailData.paidItems,(function(e,n){var i=t.__get_orig(e),a=t.__map(e.billItems,(function(e,n){var i=t.__get_orig(e),a=t.formatDateNoTime(e.startDate),o=t.formatDateNoTime(e.endDate),c=t.formatnum(e.paidAmount);return{$orig:i,m2:a,m3:o,m4:c}}));return{$orig:i,l0:a}}));t.$mp.data=Object.assign({},{$root:{m0:n,m1:i,l1:a}})},o=[]},"71e0":function(t,e,n){"use strict";n.r(e);var i=n("5a28"),a=n("51ee");for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);n("7996");var c=n("f0c5"),s=Object(c["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=s.exports},7996:function(t,e,n){"use strict";var i=n("0d65"),a=n.n(i);a.a},cead:function(t,e,n){"use strict";(function(t,e){var i=n("4ea4");n("895d");i(n("66fd"));var a=i(n("71e0"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},e9d9:function(t,e,n){"use strict";(function(t,i){var a=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(n("2eee")),c=a(n("c973")),s={"未开票":0,"开票失败":3,"开票成功":2},r={components:{customFooter:function(){n.e("components/custom-footer/custom-footer").then(function(){return resolve(n("7d39"))}.bind(null,n)).catch(n.oe)},userPrivacy:function(){n.e("components/userPrivacy/userPrivacy").then(function(){return resolve(n("594f"))}.bind(null,n)).catch(n.oe)}},data:function(){return{id:0,isLoading:!0,detailData:{},invoiceStatusClass:"",hasViewInvoice:!1,emailAddress:"",isShowMore:!1,footerData:null,useInvoice:!1,useTicket:!1,showPrivacy:!1}},onLoad:function(e){var n=this;t.onNeedPrivacyAuthorization&&t.onNeedPrivacyAuthorization((function(t,e){n.showPrivacy=!0,n.resolvePrivacyAuthorization=t}));this.id=e.id},onShow:function(){this.init(),this.getInvoiceSetting(),this.getFooterData()},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},getFooterData:function(){var t=this;return(0,c.default)(o.default.mark((function e(){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$footerConfig.get();case 2:n=e.sent,t.footerData=n;case 4:case"end":return e.stop()}}),e)})))()},init:function(){var t=this;t.$http.get("/api/v2.0/weChat/payment-histories/detail?paymentId="+t.id).then((function(e){t.detailData=e,t.isLoading=!1;var n=null;if(t.detailData.isOpenInvoice=!0,t.detailData.invoices.length>0)switch(n=t.detailData.invoices[0],t.detailData.type=n.type,t.detailData.typeStr=n.typeStr,t.detailData.pdfUrl=n.pdfUrl,t.detailData.paymentTicketId=n.paymentTicketId,t.detailData.invoiceStatus=n.invoiceStatus,t.detailData.invoiceStatusStr=n.invoiceStatusStr,t.detailData.remark=n.remark,n&&n.invoiceStatus){case 0:t.invoiceStatusClass="invoiceStatus-blue";break;case 1:t.invoiceStatusClass="invoiceStatus-org";break;case 2:t.invoiceStatusClass="invoiceStatus-green";break;default:t.invoiceStatusClass="invoiceStatus-red";break}else t.detailData.type=0,t.detailData.typeStr="",t.detailData.paymentTicketId=0,t.detailData.invoiceStatus=0,t.detailData.invoiceStatusStr="待申请",t.invoiceStatusClass="invoiceStatus-blue"})).catch((function(e){t.isLoading=!1,console.log("catch:"+e)}))},getInvoiceSetting:function(){var t=this;t.$http.get("/api/v1.0/invoice-setting/type-setting").then((function(e){e&&(t.useInvoice=e.useInvoice,t.useTicket=e.useTicket)})).catch((function(t){console.log("catch:"+t)}))},requestInvoice:function(e,n){var a=this.detailData.typeStr,o=this.detailData.invoiceStatusStr;"增值税普通发票"!==a&&"增值税专用发票"!==a?n==s.未开票||n==s.开票失败?i.navigateTo({url:"../request_invoices/request_wyinvoices?id="+e}):"开票中"===o?i.navigateTo({url:"../request_success/request_success?sendMail="+!0}):n===s.开票成功&&this.gotoViewInvoice():t.showModal({title:"",content:"".concat(a,"为纸质发票, 无电子版供预览。"),confirmColor:"#0bc183",confirmText:"知道了",showCancel:!1})},viewmore:function(){var t=this.isShowMore;this.isShowMore=!t},viewInvoice:function(){i.downloadFile({url:this.detailData.pdfUrl,success:function(t){var e=t.tempFilePath;i.openDocument({filePath:e,showMenu:!0,success:function(t){console.log("打开文档成功")},fail:function(t){console.log(t)}})}})},gotoViewInvoice:function(){i.navigateTo({url:"/packageBill/view-invoice/view-invoice?paymentId="+this.id})},downLoadInvoice:function(){var e=this;t.getSetting({success:function(n){n.authSetting["scope.writePhotosAlbum"]?(console.log("已获取授权"),e.saveInvoice()):(console.log("没有获取授权"),t.authorize({scope:"scope.writePhotosAlbum",success:function(t){e.saveInvoice()}}))}})},saveInvoice:function(){var e=this;t.downloadFile({url:e.detailData.pdfUrl,success:function(n){console.log(n);var i=t.env.USER_DATA_PATH+"/"+(new Date).getTime()+".pdf.png";t.getFileSystemManager().saveFile({tempFilePath:n.tempFilePath,filePath:i,success:function(n){t.saveImageToPhotosAlbum({filePath:i,success:function(n){e.isShowMore=!1,t.showModal({title:"文件已保存到手机相册",content:"请进入手机文件管理 \r\n将保存的文件重命名改为[ .pdf ]后缀即可",confirmColor:"#0bc183",confirmText:"知道了",showCancel:!1})},fail:function(t){console.log(t)}})},fail:function(t){console.log(t)}})},fail:function(t){console.log(t)}})},sendInvoice:function(t){i.navigateTo({url:"../send_invoices/send_invoices?id="+t})},formatDate:function(t){var e=new Date(t),n=e.getFullYear(e)>9?e.getFullYear(e):"0"+e.getFullYear(e),i=e.getMonth(e)+1>9?e.getMonth(e)+1:"0"+(e.getMonth(e)+1),a=e.getDate(e)>9?e.getDate(e):"0"+e.getDate(e),o=e.getHours(e)>9?e.getHours(e):"0"+e.getHours(e),c=e.getMinutes(e)>9?e.getMinutes(e):"0"+e.getMinutes(e);e.getSeconds(e),e.getSeconds(e);return"".concat(n,"-").concat(i,"-").concat(a," ").concat(o,":").concat(c)},formatDateNoTime:function(t){var e=new Date(t),n=(e.getFullYear(e)>9?e.getFullYear(e):e.getFullYear(e),e.getMonth(e)+1>9?e.getMonth(e)+1:"0"+(e.getMonth(e)+1)),i=e.getDate(e)>9?e.getDate(e):"0"+e.getDate(e);e.getHours(e),e.getHours(e),e.getMinutes(e),e.getMinutes(e),e.getSeconds(e),e.getSeconds(e);return"".concat(n,".").concat(i)},formatnum:function(t){return t?t.toFixed(2):"0.00"},goToViewReceipt:function(){var e=this.detailData.typeStr;"增值税普通发票"!==e&&"增值税专用发票"!==e?i.navigateTo({url:"/packageBill/view-receipt/view-receipt?paymentId="+this.id}):t.showModal({title:"",content:"未能找到付款票据(您已开具纸质发票, 不能再申请收据)",confirmColor:"#0bc183",confirmText:"知道了",showCancel:!1})}}};e.default=r}).call(this,n("bc2e")["default"],n("543d")["default"])}},[["cead","common/runtime","common/vendor"]]]);