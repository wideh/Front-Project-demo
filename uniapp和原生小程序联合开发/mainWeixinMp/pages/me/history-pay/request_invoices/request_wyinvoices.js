(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/me/history-pay/request_invoices/request_wyinvoices"],{"12b4":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){}));var n=function(){var e=this.$createElement;this._self._c},o=[]},"2bfd":function(e,t,i){"use strict";i.r(t);var n=i("9532"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=o.a},"83c0":function(e,t,i){},9532:function(e,t,i){"use strict";(function(e){var n=i("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(i("2eee")),a=n(i("c973")),s={data:function(){return{id:0,isCompany:!1,invoiceType:0,companyName:"",taxNo:"",submitBtnDisabled:!0,showOpenMail:!0,emailNo:"",codeNo:"",timeId:null,delayTimeId:null,afterTime:0,showGetCodeBtn:!1}},onLoad:function(e){this.id=e.id,this.outTradeNo=e.outTradeNo},onShow:function(){this.getInvoiceSetting()},methods:{errTost:function(t){e.showToast({title:t,icon:"none"})},errModal:function(t,i){e.showModal({title:t,content:i,showCancel:!1,confirmText:"确定",success:function(e){}})},getInvoiceSetting:function(){var e=this;e.$http.get("/api/v1.0/invoice-setting/type-setting").then((function(t){t&&(e.showOpenMail=t.emailVerification,t.emailVerification||(e.submitBtnDisabled=!1))})).catch((function(t){e.submitBtnDisabled=!1,console.log("catch:"+t)}))},onInputChnge:function(e,t){if("emailNo"===t){var i=e.detail.value;/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(i)?this.showGetCodeBtn=!0:this.showGetCodeBtn=!1}this.validate(!1)?this.submitBtnDisabled=!1:this.submitBtnDisabled=!0},debounceFn:function(e){this.timeId&&clearTimeout(this.timeId),this.timeId=setTimeout(e,500)},onChangeInvoiceType:function(e){this.invoiceType=e,this.isCompany=1==e,this.validate(!1)?this.submitBtnDisabled=!1:this.submitBtnDisabled=!0},validate:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this;if(t.errorText="",t.isCompany){if(!t.companyName)return e&&t.errTost("公司名称不能为空"),!1;if(!t.taxNo)return e&&t.errTost("税务识别号不能为空"),!1}if(!t.isCompany&&t.showOpenMail){if(!t.emailNo)return e&&t.errTost("邮箱地址不能为空"),!1;if(!t.codeNo)return e&&t.errTost("验证码不能为空"),!1}return!0},check:function(){var t=this;return(0,a.default)(o.default.mark((function i(){var n;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:n=t,n.validate()&&(n.submitBtnDisabled=!0,e.showLoading({title:"开票申请中",mask:!0}),e.hideLoading(),n.submitBtnDisabled=!1,n.$http.request("/api/v2.0/weChat/invoices/easy-invoice-v2",{paymentId:n.id,outTradeNo:n.outTradeNo,ticketType:3,ticketTitleType:n.isCompany?2:1,companyTaxIdentification:n.taxNo,companyName:n.companyName,email:n.emailNo?n.emailNo:void 0,checkCode:n.codeNo?n.codeNo:void 0},{headers:{"Content-Type":"application/json"},method:"POST"}).then((function(t){if(e.hideLoading(),n.submitBtnDisabled=!1,console.log("申请开票",t),t.success){var i=!n.isCompany&&n.showOpenMail;e.navigateTo({url:"../request_success/request_success?delta=2&sendMail="+i})}else e.showModal({title:"开票失败",content:t.msg,confirmText:"确定",showCancel:!1,success:function(t){t.confirm&&e.navigateBack()}})})).catch((function(i){e.hideLoading(),n.submitBtnDisabled=!1,console.log(i),n.errorText=i.message,"验证码有误"===i.message?t.errModal("验证码错误","您输入的验证码不正确, 请重新输入"):e.showToast({title:i.message,icon:"none"})})));case 2:case"end":return i.stop()}}),i)})))()},delay:function(){var e=this;this.delayTimeId&&clearInterval(this.delayTimeId);var t=60;this.delayTimeId=setInterval((function(){t--,e.afterTime=t,t<=0&&clearInterval(e.delayTimeId)}),1e3)},getVerificationCode:function(){var e=this;this.debounceFn((function(){if(e.emailNo){/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(e.emailNo)?(e.delay(),e.$httpCommon.post("/wy/api/v2.0/weChat/invoices/send-email-check-code",{email:e.emailNo}).then((function(t){var i;null!==t&&void 0!==t&&t.success||e.errTost((null===t||void 0===t||null===(i=t.error)||void 0===i?void 0:i.message)||"获取邮箱验证码失败")})).catch((function(e){console.log("获取邮箱验证码错误",e)}))):e.errTost("输入邮箱的格式不正确")}else e.errTost("请输入邮箱")}))}}};t.default=s}).call(this,i("543d")["default"])},b824:function(e,t,i){"use strict";var n=i("83c0"),o=i.n(n);o.a},cbd9:function(e,t,i){"use strict";(function(e,t){var n=i("4ea4");i("895d");n(i("66fd"));var o=n(i("dddf"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(o.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},dddf:function(e,t,i){"use strict";i.r(t);var n=i("12b4"),o=i("2bfd");for(var a in o)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(a);i("b824");var s=i("f0c5"),c=Object(s["a"])(o["default"],n["b"],n["c"],!1,null,"71ffa198",null,!1,n["a"],void 0);t["default"]=c.exports}},[["cbd9","common/runtime","common/vendor"]]]);