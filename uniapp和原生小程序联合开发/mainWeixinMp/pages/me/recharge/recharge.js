(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/me/recharge/recharge"],{"0be5":function(e,n,t){"use strict";t.r(n);var o=t("9eba"),c=t("8bd9");for(var a in c)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return c[e]}))}(a);t("f001");var u=t("f0c5"),r=Object(u["a"])(c["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=r.exports},"73d6":function(e,n,t){"use strict";(function(e,n){var o=t("4ea4");t("895d");o(t("66fd"));var c=o(t("0be5"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(c.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},"8bd9":function(e,n,t){"use strict";t.r(n);var o=t("c922"),c=t.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=c.a},"9eba":function(e,n,t){"use strict";t.d(n,"b",(function(){return c})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return o}));var o={uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,"cff5"))},sudaPopup:function(){return t.e("components/suda-popup/suda-popup").then(t.bind(null,"7271"))}},c=function(){var e=this,n=e.$createElement,t=(e._self._c,e.accounts.length>0&&e.chargeInfo.fnAccountIcon),o=t?e.displayIcon(e.chargeInfo.fnAccountIcon):null,c=e.accounts.length,a=e.accounts.length,u=e.accounts.length,r=e.accounts.length,i=r>0?e.__map(e.accounts,(function(n,t){var o=e.__get_orig(n),c=e.displayIcon(n.icon);return{$orig:o,m1:c}})):null;e.$mp.data=Object.assign({},{$root:{g0:t,m0:o,g1:c,g2:a,g3:u,g4:r,l0:i}})},a=[]},c922:function(e,n,t){"use strict";(function(e){var o=t("4ea4");Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var c=o(t("2eee")),a=o(t("c973")),u=o(t("f7fe")),r={components:{sudaPopup:function(){t.e("components/suda-popup/suda-popup").then(function(){return resolve(t("7271"))}.bind(null,t)).catch(t.oe)},uniIcons:function(){Promise.all([t.e("common/vendor"),t.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(t("1533"))}.bind(null,t)).catch(t.oe)},customFooter:function(){t.e("components/custom-footer/custom-footer").then(function(){return resolve(t("7d39"))}.bind(null,t)).catch(t.oe)}},computed:{balance:function(){return""!==this.chargeInfo.balance?"¥ ".concat(this.chargeInfo.balance):"-"}},data:function(){return{accounts:[],amountIndex:0,isFocus:!1,chargeInfo:{fnAccountId:"",fnAccountName:"",fnAccountIcon:"",balance:"",organizationItemOwner:"",regionName:"",buildingName:"",organizationItemCode:"",isSetMinAmount:!1,minAmount:null,recommendedAmountSetting:{isSetRecommendedAmount:!1,recommendedAmounts:[50,100,150]}},chargeAmount:50,inputAmount:"",resourceId:"",resourceAddress:"",errText:"",needSelectResource:!0,canChangeResource:!0,needShowPopup:!0,footerData:null,isContactBill:!1}},onLoad:function(n){var t=this;t.resourceId=n.resourceId,t.resourceId&&(t.needSelectResource=!1,t.canChangeResource=!1),"true"==n.isContactBill&&(this.isContactBill=!0);var o=e.getStorageSync(t.$config.storageKeys.user);o?t.needSelectResource&&t.goToSelectResource():e.showModal({title:"提示",content:"请先登录",showCancel:!1,success:function(n){e.switchTab({url:"../me"})}})},onShow:function(){var n=this;if(!n.needSelectResource){var t=e.getStorageSync("resource");t&&t.resourceId&&(n.resourceId=t.resourceId,n.resourceAddress=t.text),n.init()}this.getFooterData(),n.chargeInfo.isSetMinAmount=!1,n.chargeInfominAmount=null,n.chargeInfo.recommendedAmountSetting={isSetRecommendedAmount:!1,recommendedAmounts:[50,100,150]}},onHide:function(){var e=this;setTimeout((function(){e.needSelectResource=!1,e.amountIndex=0,e.chargeAmount=50,e.inputAmount="",e.clearChargeInfo()}),400)},methods:{getFooterData:function(){var e=this;return(0,a.default)(c.default.mark((function n(){var t;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$footerConfig.get();case 2:t=n.sent,e.footerData=t;case 4:case"end":return n.stop()}}),n)})))()},init:function(){this.getAccountData()},getAccountData:function(){var e=this;e.resourceId?e.$http.get("/api/v2.0/wechat/pre-deposit-accounts/me?resourceId=".concat(e.resourceId)).then((function(n){n.length>0?(e.accounts=n,e.needShowPopup&&setTimeout((function(){1==e.accounts.length?e.selectAccount(e.accounts[0]):e.open()}),300)):(e.accounts=[],e.errText="房产资源没有绑定冲抵的收费标准，请先绑定预缴的收费标准")})).catch((function(n){e.accounts=[],e.errText=n.message,console.log(n)})):e.errText="请去选择需要预缴充值的房间"},getAccountDetail:function(e,n){var t=this;t.$http.get("/api/v2.0/wechat/user-accounts",{userResourceId:e,fnAccountId:n}).then((function(e){t.chargeInfo=e,t.chargeAmount=e.recommendedAmountSetting.recommendedAmounts[0],t.amountIndex=0})).catch((function(e){console.log(e)}))},clearChargeInfo:function(){this.chargeInfo={fnAccountId:"",fnAccountName:"",fnAccountIcon:"",balance:"",organizationItemOwner:"",regionName:"",buildingName:"",organizationItemCode:""}},displayAddress:function(e){return(e.regionName||"")+(e.buildingName||"")+(e.organizationItemCode||"")||(this.canChangeResource?"请选择其他房间":"")},displayIcon:function(e){return e?"https://pms-statics.oss-cn-shenzhen.aliyuncs.com/wechat-static/chargeItemType/".concat(e):""},open:function(){this.accounts.length>0&&this.$refs["select-account"].open()},cancel:function(){this.$refs["select-account"].close()},selectAccount:function(e){this.getAccountDetail(e.userResourceId,e.id),this.cancel()},goToSelectResource:function(){this.canChangeResource&&(this.needShowPopup=!0,e.navigateTo({url:"../select/room-and-parking/room-and-parking?selectType=both&isTenant=true"}))},selectAmount:function(e){var n=this;n.amountIndex=e,n.chargeAmount=n.chargeInfo.recommendedAmountSetting.recommendedAmounts[e],n.inputAmount="",setTimeout((function(){n.inputAmount=""}),500),n.changeFocus(!1)},changeFocus:function(e){this.isFocus=e,e&&(this.amountIndex=null,this.chargeAmount=this.inputAmount)},onKey_Input:(0,u.default)((function(e){var n=this;n.inputAmount="";var t=e.detail.value;t=t.replace(/[^\d.]/g,""),t=t.replace(".","$#$").replace(/\./g,"").replace("$#$","."),t=t.replace(/^\./,"0."),t=t.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),t.indexOf(".")<0&&""!=t&&(t=parseFloat(t)),setTimeout((function(){n.inputAmount=t}),0),n.chargeAmount=parseFloat(t)}),500),onKey_Input2:function(e){var n=e.detail.value;return n=n.replace(/[^\d.]/g,""),n=n.replace(".","$#$").replace(/\./g,"").replace("$#$","."),n=n.replace(/^\./,"0."),n=n.replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),n.indexOf(".")<0&&""!=n&&(n=parseFloat(n)),this.inputAmount=n,console.log(this.inputAmount),this.chargeAmount=parseFloat(n),console.log(this.chargeAmount),n},validate:function(){var n=this;return n.chargeAmount?n.chargeInfo.fnAccountId?!(n.chargeInfo.isSetMinAmount&&n.chargeInfo.minAmount>n.chargeAmount)||(e.showToast({title:"单笔充值最低金额为".concat(n.chargeInfo.minAmount,"元"),icon:"none"}),!1):(n.accounts.length>0?n.open():e.showToast({title:"该房间或车位未绑定预缴账户",icon:"none"}),!1):(e.showToast({title:"请填入充值金额",icon:"none"}),!1)},recharge:function(){var n=this;n.validate()&&(e.showLoading({title:"支付中...",mask:!0}),this.$http.post("/api/v2.0/wechat/unified-orders/pre-paid",{houseId:n.chargeInfo.organizationItemId,payClassId:n.chargeInfo.fnAccountId,amount:n.chargeAmount,paidType:7,remark:"小程序预缴充值".concat(n.chargeAmount,"元")}).then((function(n){console.log(n);var t=JSON.parse(n);e.requestPayment({provider:"wxpay",timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,success:function(n){e.navigateTo({url:"success/success"})},fail:function(e){},complete:function(n){e.hideLoading()}})})).catch((function(n){e.hideLoading(),e.showModal({title:"提示",content:n.message})})))},goToChargeLog:function(){var n=this,t=n.displayAddress(n.chargeInfo);n.chargeInfo.fnAccountId?(e.navigateTo({url:"log/log?fnAccountId=".concat(n.chargeInfo.fnAccountId,"&organizationItemId=").concat(n.resourceId,"&fnAccountName=").concat(n.chargeInfo.fnAccountName,"&address=").concat(t)}),n.needShowPopup=!1):n.open()}}};n.default=r}).call(this,t("543d")["default"])},dc1d:function(e,n,t){},f001:function(e,n,t){"use strict";var o=t("dc1d"),c=t.n(o);c.a}},[["73d6","common/runtime","common/vendor"]]]);