(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/me/room/tenant/edit/edit"],{1423:function(e,t,o){"use strict";(function(e,n){var a=o("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(o("2eee")),s=a(o("c973")),i={components:{uniIcons:function(){Promise.all([o.e("common/vendor"),o.e("node-modules/@dcloudio/uni-ui/lib/uni-icons/uni-icons")]).then(function(){return resolve(o("1533"))}.bind(null,o)).catch(o.oe)},customFooter:function(){o.e("components/custom-footer/custom-footer").then(function(){return resolve(o("7d39"))}.bind(null,o)).catch(o.oe)},userPrivacy:function(){o.e("components/userPrivacy/userPrivacy").then(function(){return resolve(o("594f"))}.bind(null,o)).catch(o.oe)}},data:function(){return{resourceId:0,houseMemberId:0,houseCustomerId:0,regionId:0,name:"",phone:"",photoImg:"https://pms-statics.oss-cn-shenzhen.aliyuncs.com/wechat-static/me/photo.png",isChangeImg:!1,errorText:"",footerData:null,showPrivacy:!1}},onLoad:function(t){var o=this;e.onNeedPrivacyAuthorization&&e.onNeedPrivacyAuthorization((function(e,t){o.showPrivacy=!0,o.resolvePrivacyAuthorization=e}));var a=this;a.resourceId=t.resourceId,a.houseMemberId=t.houseMemberId,a.houseCustomerId=t.houseCustomerId,a.type=t.type,"add"==a.type?n.setNavigationBarTitle({title:"新增租户"}):(n.setNavigationBarTitle({title:"编辑租户"}),a.init())},onShow:function(){this.getFooterData()},methods:{agreePrivacy:function(){this.showPrivacy=!1,this.resolvePrivacyAuthorization({buttonId:"agree-btn",event:"agree"})},disagreePrivacy:function(){this.showPrivacy=!1},getFooterData:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var o;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$footerConfig.get();case 2:o=t.sent,e.footerData=o;case 4:case"end":return t.stop()}}),t)})))()},init:function(){var e=this;e.$http.get("/api/v2.0/weChat/house-tenants/".concat(e.houseMemberId)).then((function(t){e.name=t.name,e.phone=t.phone,e.regionId=t.regionId,t.faceImageRelativePath&&(e.photoImg=e.$tool.image.getHttpUrl(t.faceImageRelativePath))})).catch((function(e){console.log(e)}))},validatePhone:function(){var e=1*this.phone;return!(e<1e10||e>19999999999)||(n.showToast({title:"手机号不符合要求",duration:2e3,icon:"none"}),!1)},validate:function(){return this.errorText="",this.name?!!this.validatePhone():(n.showToast({title:"请输入姓名",icon:"none"}),!1)},goNext:function(){var e=this;if(e.validate()){var t=n.getStorageSync(e.$config.storageKeys.token);if(n.showLoading({title:"保存中"}),"add"==e.type){var o={ResourceId:e.resourceId,Name:e.name,Phone:e.phone,HouseCustomerId:e.houseCustomerId};e.isChangeImg?n.uploadFile({url:e.$config.apiWYBaseUrl+"/api/v2.0/weChat/house-tenants",filePath:e.photoImg,name:"FaceImage",formData:o,header:{Authorization:t.token_type+" "+t.access_token},success:function(t){n.hideLoading();var o=JSON.parse(t.data);o.success?n.navigateTo({url:"../success/success?type=add"}):e.errorText=o.error.message},fail:function(t){n.hideLoading(),e.errorText=t.message,console.log("2:"+t)}}):n.request({url:e.$config.apiWYBaseUrl+"/api/v2.0/weChat/house-tenants",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",Authorization:t.token_type+" "+t.access_token},data:o,success:function(e){if(n.hideLoading(),200===e.statusCode&&e.data){var t=e.data;t.success?n.navigateTo({url:"../success/success?type=add"}):n.showToast({title:t.error.message,icon:"none"})}else console.log("系统繁忙")},fail:function(t){n.hideLoading(),e.errorText=t,console.log("1:"+t)}})}else if("edit"==e.type){var a={Name:e.name,Phone:e.phone,HouseCustomerId:e.houseCustomerId,Id:e.houseMemberId,ResourceId:e.resourceId,RegionId:e.regionId};e.isChangeImg?n.uploadFile({url:e.$config.apiWYBaseUrl+"/api/v2.0/weChat/house-tenants/".concat(a.Id),filePath:e.photoImg,name:"FaceImage",formData:a,header:{"Content-Type":"multipart/form-data",Authorization:t.token_type+" "+t.access_token},success:function(t){n.hideLoading();var o=JSON.parse(t.data);o.success?n.navigateTo({url:"../success/success?type=edit"}):e.errorText=o.error.message},fail:function(t){n.hideLoading(),e.errorText=t,console.log("4:"+t)}}):n.request({url:e.$config.apiWYBaseUrl+"/api/v2.0/weChat/house-tenants/".concat(a.Id),method:"PUT",header:{"Content-Type":"application/x-www-form-urlencoded",Authorization:t.token_type+" "+t.access_token},data:a,success:function(e){if(n.hideLoading(),200===e.statusCode&&e.data){var t=e.data;t.success?n.navigateTo({url:"../success/success?type=edit"}):n.showToast({title:t.error.message,icon:"none"})}else console.log("系统繁忙")},fail:function(t){n.hideLoading(),console.log("3:"+t),e.errorText=t.message}})}}},goToPhoto:function(){var e=this;n.getStorageSync("user").defaultResourceName;n.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["camera"],success:function(t){e.photoImg=t.tempFilePaths[0],e.isChangeImg=!0}})}}};t.default=i}).call(this,o("bc2e")["default"],o("543d")["default"])},"4c18":function(e,t,o){"use strict";(function(e,t){var n=o("4ea4");o("895d");n(o("66fd"));var a=n(o("8292"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(a.default)}).call(this,o("bc2e")["default"],o("543d")["createPage"])},"60ae":function(e,t,o){"use strict";var n=o("a80b"),a=o.n(n);a.a},8292:function(e,t,o){"use strict";o.r(t);var n=o("9edc"),a=o("a59c");for(var r in a)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return a[e]}))}(r);o("60ae");var s=o("f0c5"),i=Object(s["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=i.exports},"9edc":function(e,t,o){"use strict";o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return r})),o.d(t,"a",(function(){return n}));var n={userPrivacy:function(){return o.e("components/userPrivacy/userPrivacy").then(o.bind(null,"594f"))}},a=function(){var e=this.$createElement;this._self._c},r=[]},a59c:function(e,t,o){"use strict";o.r(t);var n=o("1423"),a=o.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(r);t["default"]=a.a},a80b:function(e,t,o){}},[["4c18","common/runtime","common/vendor"]]]);